<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="MRSea">
<title>Getting Started with MRSea: One dimensional smoothing • MRSea</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.3/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.3/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Getting Started with MRSea: One dimensional smoothing">
<meta property="og:description" content="MRSea">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">MRSea</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.3.3</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <h6 class="dropdown-header" data-toc-skip>Basic examples</h6>
    <a class="dropdown-item" href="../articles/web/GettingStarted_1Dsmoothing.html">One-dimensional smooths</a>
    <a class="dropdown-item" href="../articles/web/GettingStarted_2Dsmoothing.html">Two-dimensional smooths</a>
    <div class="dropdown-divider"></div>
    <a class="dropdown-item" href="../articles/web/FittingDifferentSplines_MRSea_v1.3.Rmd.html">Using Different Splines</a>
    <a class="dropdown-item" href="../articles/web/Interactions_salsa2d_MRSea_v1.3">Interactions for 2D smooths</a>
    <a class="dropdown-item" href="../articles/web/publications.html">Publications</a>
    <div class="dropdown-divider"></div>
    <a class="dropdown-item" href="../articles/web/RenewablesCaseStudy_MRSea_v1.3.html">Renewables Case Study</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>More advanced Usage</h6>
    <a class="dropdown-item" href="../articles/web/Geodesic_2dsmoothing_MRSea_v1.3.html">Geodesic smoothing</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/lindesaysh/MRSea/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Getting Started with MRSea: One dimensional smoothing</h1>
                        <h4 data-toc-skip class="author">LAS
Scott-Hayward</h4>
            
            <h4 data-toc-skip class="date">2023-01-27</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/lindesaysh/MRSea/blob/HEAD/vignettes/GettingStarted_1Dsmoothing.Rmd" class="external-link"><code>vignettes/GettingStarted_1Dsmoothing.Rmd</code></a></small>
      <div class="d-none name"><code>GettingStarted_1Dsmoothing.Rmd</code></div>
    </div>

    
    
<!-- **Please reference this document as:** -->
<!-- Scott-Hayward, L.A.S., Mackenzie, M.L. and Walker, C.G. (2021). Vignette for the MRSea Package v1.3: Statistical Modelling of bird and cetacean distributions in offshore renewables development areas. Centre for Research into Ecological and Environmental Modelling, University of St Andrews. -->
<!-- ******* -->
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>The <code>MRSea</code> package was developed for analysing data that
was collected for assessing potential impacts of renewable developments
on marine wildlife, although the methods are applicable to many other
studies as well. For example, these methods have been used for more
general spatial distribution modelling and to analyse GPS tagging data
for home ranges.</p>
<p>The <code>MRSea</code> package primarily fits Generalised Additive
Models (GAMs) using a spatially adaptive model selection framework for
both one and two dimensional covariates using the functions
<code>runSALSA1D</code> and <code>runSALSA2D</code>. These functions
implement the methods of implement the methods of <span class="citation">Walker et al. (2010)</span>, <span class="citation">Scott-Hayward et al. (2013)</span> and <span class="citation">Scott-Hayward et al. (2022)</span>. In addition,
options are available for a variety of different splines and the
estimation of robust standard errors if residual correlation is
present.</p>
<p>A class of model <code>gamMRSea</code> is created when running either
SALSA 1D or 2D. This retains within the model object information
regarding fitting, such as the <code>splineParam</code> object and the
panel structure (if present). The use of the <code>summary</code>
function on these models returns both raw and robust standard errors,
with the <em>p</em>-values from the models hypothesis test using the
robust standard errors. The robust standard errors are obtained using
the panel structure given (independence is one panel per data point and
is the default if no structure is given).</p>
<p>In addition to the functions required to run the models (which we
shall go through below) there are also a variety of associated functions
for:</p>
<p><strong>Covariate Checking/Selection:</strong></p>
<ul>
<li>
<code>summary.gamMRSea</code> (summary function for models)</li>
<li>
<code>runPartialPlots</code> (to plot 1D partial smooth
relationships),</li>
<li>
<code>anova.gamMRSea</code> (for model selection; (ANOVA) for robust
standard errors) and</li>
</ul>
<p><strong>Diagnostics:</strong></p>
<ul>
<li>
<code>runACF</code> (to assess residual correlation),</li>
<li>
<code>runsTest</code> (to assess residual correlation)</li>
<li>
<code>runDiagnostics</code> (plots of observed vs fitted and fitted
vs scaled Pearsons residuals),</li>
<li>
<code>timeInfluenceCheck</code>/<code>runInfluence</code> (assessing
the influence of data on precision and predictions),</li>
<li>
<code>plotCumRes</code> (plots of cumulative residuals)</li>
</ul>
<p><strong>Inference:</strong></p>
<ul>
<li>
<code>do.bootstrap.cress.robust</code> (percentile based confidence
intervals).</li>
<li>
<code>getDifferences</code> (identifying differences between two
prediction surfaces)</li>
</ul>
</div>
<div class="section level2">
<h2 id="fitting-a-simple-model">Fitting a Simple Model<a class="anchor" aria-label="anchor" href="#fitting-a-simple-model"></a>
</h2>
<p>The data we shall use for this example is from a Danish offshore
windfarm and is part of the MRSea package. The data are counts of birds
collected along transects over a number of surveys and years. In this
first example, we will use all of the data together and assess if there
is a relationship between number of birds and sea depth.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://creem2.st-and.ac.uk/software.aspx" class="external-link">MRSea</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># load the data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"nysted.analysisdata"</span><span class="op">)</span></span>
<span><span class="va">wfdata</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">nysted.analysisdata</span>, <span class="va">impact</span><span class="op">==</span><span class="fl">0</span>, <span class="va">season</span><span class="op">==</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="co"># load the prediction grid</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"nysted.predictdata"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">wfdata</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">depth</span>, y<span class="op">=</span><span class="va">response</span><span class="op">)</span>, alpha<span class="op">=</span><span class="fl">1</span><span class="op">/</span><span class="fl">5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Sea Depth (m)"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Number of Birds"</span><span class="op">)</span></span></code></pre></div>
<p><img src="GettingStarted_1Dsmoothing_files/figure-html/unnamed-chunk-4-1.png" width="700"></p>
<div class="section level3">
<h3 id="fitting-a-1d-smooth">Fitting a 1D smooth<a class="anchor" aria-label="anchor" href="#fitting-a-1d-smooth"></a>
</h3>
<p>Set up the initial model with the offset term (if required) and
specify the parameters required. Here we add an offset to be the size of
the segment associated with the bird counts. In reality, our bird counts
are over a particular area so we have counts per unit area.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">initialModel</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">response</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/offset.html" class="external-link">offset</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">area</span><span class="op">)</span><span class="op">)</span>, family <span class="op">=</span> <span class="st">"quasipoisson"</span>, </span>
<span>                    data <span class="op">=</span> <span class="va">wfdata</span><span class="op">)</span></span></code></pre></div>
<p>The fitness measure can be one of several options (AIC, BIC, QAIC,
QBIC, CV). Here we use QBIC as we have a quasi model and information
criterion fitting is faster than cross-validation. The default smooth is
a B-spline with degree specified as a parameter.</p>
<ul>
<li>
<code>minKnots_1d</code> specifies the minimum number of internal
knots to be selected.</li>
<li>
<code>maxKnots_1d</code> specifies the maximum number of internal
knots to be selected. Three is usually a good amount of flexibility and
a good start point.</li>
<li>
<code>startKnots_1d</code> specifies the number of internal knots
the SALSA algorithm uses to initialise the process. Usually good to
start at 1 knot (this puts one knot at the mean initially)</li>
<li>
<code>degree</code> specifies the degree of the B-spline. Two is a
quadratic. Three is cubic.</li>
<li>
<code>gaps</code> specifies the minimum gap between knots. Usually
this is fine to be set at zero but occasionally there can be estimation
problems and so a gap can be set (in the units of the covariate).</li>
</ul>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">salsa1dlist</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>fitnessMeasure <span class="op">=</span> <span class="st">"QBIC"</span>, </span>
<span>                    minKnots_1d <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                    maxKnots_1d <span class="op">=</span> <span class="fl">3</span>, </span>
<span>                    startKnots_1d <span class="op">=</span> <span class="fl">1</span>, </span>
<span>                    degree <span class="op">=</span> <span class="fl">2</span>,</span>
<span>                    gaps <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>If you wish to make predictions once the model is fitted, then a
prediction grid should be specified in the <code>runSALSA1D</code>
statement. This is because the default splines fitted here (B-splines)
are unable to make predictions outside of the range they were created.
For example, if the data range for depth is smaller than the range of
depths in the prediction data, predictions cannot be made. Here the
range of the predictions is slightly wider than the range of the data,
so we will specify <code>nysted.predictdata</code> when running
SALSA.</p>
<p>Run SALSA:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">salsa1dOutput</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/runSALSA1D.html">runSALSA1D</a></span><span class="op">(</span>initialModel <span class="op">=</span> <span class="va">initialModel</span>, </span>
<span>                            salsa1dlist <span class="op">=</span> <span class="va">salsa1dlist</span>,</span>
<span>                            varlist <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"depth"</span><span class="op">)</span>,</span>
<span>                            predictionData <span class="op">=</span> <span class="va">nysted.predictdata</span>, </span>
<span>                            datain <span class="op">=</span> <span class="va">wfdata</span>,</span>
<span>                            suppress.printout <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>Note that <code>suppress.printout</code> will not print the progress
of <code>runSALSA1D</code> into your workspace but will save the output
to a log file (<em>salsa1d.log</em>) in your working directory. You may
find it helpful to not suppress the print out to begin with so you can
see what is happening.</p>
<p>Use the built in summary function (<code>summary.gamMRSea</code>) to
look at the summary of the model. Note that robust standard errors are
given alongside the raw standard errors and information regarding panels
is at the bottom of the output. If each data point is a panel, then
independence is assumed and the two standard error columns will be
identical.</p>
</div>
<div class="section level3">
<h3 id="model-summary">Model Summary<a class="anchor" aria-label="anchor" href="#model-summary"></a>
</h3>
<p>The object <code>salsa1doutput</code> has four components:</p>
<ul>
<li>
<code>bestModel</code>: the final model</li>
<li>
<code>modelFits1D</code>: a list object with an element for each
term fitted to the model. The list includes information on whether the
covariate was kept in the model (more on model selection later) and if
so the knot locations selected and fitness measure.</li>
<li>
<code>fitStat</code>: The fitness measure of the best model using
the fitness measure specified, the cross-validation score of the model
(if model selection undertaken) and the dispersion parameter estimate if
a quasi model is specified.</li>
<li>
<code>keptvarlist</code>: the list of variables retained in the
model (same as input if no model selection)</li>
</ul>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">salsa1dOutput</span><span class="op">$</span><span class="va">bestModel</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; gamMRSea(formula = round(response) ~ bs(depth, knots = splineParams[[2]]$knots, </span></span>
<span><span class="co">#&gt;     degree = splineParams[[2]]$degree, Boundary.knots = splineParams[[2]]$bd) + </span></span>
<span><span class="co">#&gt;     offset(log(area)), family = quasipoisson(link = log), data = wfdata, </span></span>
<span><span class="co">#&gt;     splineParams = splineParams)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Deviance Residuals: </span></span>
<span><span class="co">#&gt;     Min       1Q   Median       3Q      Max  </span></span>
<span><span class="co">#&gt; -2.3781  -1.5364  -0.3489  -0.1543  13.4906  </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients:</span></span>
<span><span class="co">#&gt;             Estimate Std. Error Robust S.E. t value Pr(&gt;|t|)   </span></span>
<span><span class="co">#&gt; (Intercept)  -0.6628     2.2101      2.2101  -0.300  0.76431   </span></span>
<span><span class="co">#&gt; s(depth)1    -5.3659     2.6965      2.6965  -1.990  0.04683 * </span></span>
<span><span class="co">#&gt; s(depth)2     5.9957     2.1440      2.1440   2.796  0.00525 **</span></span>
<span><span class="co">#&gt; s(depth)3    -0.4373     2.3330      2.3330  -0.187  0.85136   </span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; (Dispersion parameter for quasipoisson family taken to be 6.282296)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     Null deviance: 4987.6  on 1153  degrees of freedom</span></span>
<span><span class="co">#&gt; Residual deviance: 3482.4  on 1150  degrees of freedom</span></span>
<span><span class="co">#&gt; AIC:  NA</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Max Panel Size = 1 (independence assumed); Number of panels = 1154</span></span>
<span><span class="co">#&gt; Number of Fisher Scoring iterations: 6</span></span></code></pre></div>
<p>You can find the number of knots chosen for a variable by looking at
the <code>modelFits1D</code> output within <code>salsa1dOutput</code> or
by querying the spline parameters list in the model object. In this
case, one knot has been selected.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># How many knots were chosen for depth?</span></span>
<span><span class="va">salsa1dOutput</span><span class="op">$</span><span class="va">bestModel</span><span class="op">$</span><span class="va">splineParams</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">knots</span></span>
<span><span class="co">#&gt; [1] -13.462</span></span></code></pre></div>
<p>Assessing model fit using a partial plot. These can be on the link
scale:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/runPartialPlots.html">runPartialPlots</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">salsa1dOutput</span><span class="op">$</span><span class="va">bestModel</span>, data <span class="op">=</span> <span class="va">wfdata</span>, </span>
<span>                varlist <span class="op">=</span> <span class="st">'depth'</span>, </span>
<span>                showKnots <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>                type<span class="op">=</span><span class="st">'link'</span>, </span>
<span>                includeB0 <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Making partial plots"</span></span></code></pre></div>
<p><img src="GettingStarted_1Dsmoothing_files/figure-html/unnamed-chunk-10-1.png" width="576" style="display: block; margin: auto;"></p>
<p>or the response scale</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/runPartialPlots.html">runPartialPlots</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">salsa1dOutput</span><span class="op">$</span><span class="va">bestModel</span>, data <span class="op">=</span> <span class="va">wfdata</span>, </span>
<span>                varlist <span class="op">=</span> <span class="st">'depth'</span>, </span>
<span>                showKnots <span class="op">=</span> <span class="cn">TRUE</span>, type<span class="op">=</span><span class="st">'response'</span>, </span>
<span>                includeB0 <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Making partial plots"</span></span></code></pre></div>
<p><img src="GettingStarted_1Dsmoothing_files/figure-html/unnamed-chunk-11-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="adding-a-factor-variable">Adding a factor variable<a class="anchor" aria-label="anchor" href="#adding-a-factor-variable"></a>
</h3>
<p>The process is the same as above but you specify the factor variable
in the initial Model. Here we add a season variable. For this we need to
use the full data set <code>nysted.analysisdata</code>.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">initialModel</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">response</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">season</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/offset.html" class="external-link">offset</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">area</span><span class="op">)</span><span class="op">)</span>, family <span class="op">=</span> <span class="st">"quasipoisson"</span>, </span>
<span>                    data <span class="op">=</span> <span class="va">nysted.analysisdata</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">salsa1dlist</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>fitnessMeasure <span class="op">=</span> <span class="st">"QBIC"</span>, </span>
<span>                    minKnots_1d <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                    maxKnots_1d <span class="op">=</span> <span class="fl">3</span>, </span>
<span>                    startKnots_1d <span class="op">=</span> <span class="fl">1</span>, </span>
<span>                    degree <span class="op">=</span> <span class="fl">2</span>,</span>
<span>                    gaps <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">salsa1dOutput.f</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/runSALSA1D.html">runSALSA1D</a></span><span class="op">(</span>initialModel <span class="op">=</span> <span class="va">initialModel</span>, </span>
<span>                            salsa1dlist <span class="op">=</span> <span class="va">salsa1dlist</span>,</span>
<span>                            varlist <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"depth"</span><span class="op">)</span>,</span>
<span>                            predictionData <span class="op">=</span> <span class="va">nysted.predictdata</span>, </span>
<span>                            datain <span class="op">=</span> <span class="va">nysted.analysisdata</span>,</span>
<span>                            suppress.printout <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/runPartialPlots.html">runPartialPlots</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">salsa1dOutput.f</span><span class="op">$</span><span class="va">bestModel</span>, </span>
<span>                data <span class="op">=</span> <span class="va">nysted.analysisdata</span>, </span>
<span>                varlist.in <span class="op">=</span> <span class="st">'depth'</span>, </span>
<span>                factorlist.in <span class="op">=</span> <span class="st">"season"</span>,</span>
<span>                showKnots <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>                type<span class="op">=</span><span class="st">'link'</span>, </span>
<span>                includeB0 <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Making partial plots"</span></span></code></pre></div>
<p><img src="GettingStarted_1Dsmoothing_files/figure-html/unnamed-chunk-14-1.png" width="576" style="display: block; margin: auto;"><img src="GettingStarted_1Dsmoothing_files/figure-html/unnamed-chunk-14-2.png" width="576" style="display: block; margin: auto;"></p>
</div>
</div>
<div class="section level2">
<h2 id="multiple-smooth-covariates">Multiple smooth covariates<a class="anchor" aria-label="anchor" href="#multiple-smooth-covariates"></a>
</h2>
<p>For this section we will use another renewables data set which is
simulated from a vantage point survey of an area used for testing of
wave energy devices.</p>
<p>The data are locations on a grid that are observed for birds at a
variety of tide states (Flood, Slack, Ebb), times of day, months and
over two years. The first year was baseline data and the second after
the installation of a testing device. For this example, we will just
look at the baseline data (before impact).</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">ns.data.re</span><span class="op">)</span></span>
<span><span class="va">vpdata</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">ns.data.re</span>, <span class="va">impact</span><span class="op">==</span><span class="fl">0</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>response <span class="op">=</span> <span class="va">birds</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">vpdata</span><span class="op">)</span></span>
<span><span class="co">#&gt;   x.pos y.pos     area floodebb observationhour GridCode Year DayOfMonth</span></span>
<span><span class="co">#&gt; 1  1500 -4500 0.385253      EBB              12      a11    9         13</span></span>
<span><span class="co">#&gt; 2  1500 -4500 0.385253    FLOOD               8      a11    9         16</span></span>
<span><span class="co">#&gt; 3  1500 -4500 0.385253    FLOOD               9      a11    9         16</span></span>
<span><span class="co">#&gt; 4  1500 -4500 0.385253    FLOOD              10      a11    9         16</span></span>
<span><span class="co">#&gt; 5  1500 -4500 0.385253    FLOOD              11      a11    9         16</span></span>
<span><span class="co">#&gt; 6  1500 -4500 0.385253    FLOOD              12      a11    9         16</span></span>
<span><span class="co">#&gt;   MonthOfYear impact birds cellid response</span></span>
<span><span class="co">#&gt; 1           3      0     0      1        0</span></span>
<span><span class="co">#&gt; 2           3      0     0      2        0</span></span>
<span><span class="co">#&gt; 3           3      0     0      3        0</span></span>
<span><span class="co">#&gt; 4           3      0     0      4        0</span></span>
<span><span class="co">#&gt; 5           3      0     0      5        0</span></span>
<span><span class="co">#&gt; 6           3      0     0      6        0</span></span></code></pre></div>
<p>For the initial model, we include the factor variable for tide state
(<code>flood ebb</code>) and an offset for the area of a grid cell.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">initialModel</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">response</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">floodebb</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/offset.html" class="external-link">offset</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">area</span><span class="op">)</span><span class="op">)</span>, family <span class="op">=</span> <span class="st">"quasipoisson"</span>, </span>
<span>                    data <span class="op">=</span> <span class="va">vpdata</span><span class="op">)</span></span></code></pre></div>
<p>We have picked two variables for inclusion as smooth terms,
observation hour and x-coordinate.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">varlist</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"observationhour"</span>, <span class="st">"x.pos"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">salsa1dlist</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>fitnessMeasure <span class="op">=</span> <span class="st">"QBIC"</span>, </span>
<span>                    minKnots_1d <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">varlist</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                    maxKnots_1d <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">varlist</span><span class="op">)</span><span class="op">)</span>, </span>
<span>                    startKnots_1d <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">varlist</span><span class="op">)</span><span class="op">)</span>, </span>
<span>                    degree <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">varlist</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                    gaps <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">varlist</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">salsa1dOutput.multi</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/runSALSA1D.html">runSALSA1D</a></span><span class="op">(</span>initialModel <span class="op">=</span> <span class="va">initialModel</span>, </span>
<span>                            salsa1dlist <span class="op">=</span> <span class="va">salsa1dlist</span>,</span>
<span>                            varlist <span class="op">=</span> <span class="va">varlist</span>, </span>
<span>                            datain <span class="op">=</span> <span class="va">vpdata</span>,</span>
<span>                            suppress.printout <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/runPartialPlots.html">runPartialPlots</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">salsa1dOutput.multi</span><span class="op">$</span><span class="va">bestModel</span>, </span>
<span>                data <span class="op">=</span> <span class="va">vpdata</span>, </span>
<span>                varlist.in <span class="op">=</span> <span class="va">varlist</span>,</span>
<span>                factorlist.in <span class="op">=</span> <span class="st">"floodebb"</span>,</span>
<span>                showKnots <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>                type<span class="op">=</span><span class="st">'link'</span>, </span>
<span>                includeB0 <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Making partial plots"</span></span></code></pre></div>
<p><img src="GettingStarted_1Dsmoothing_files/figure-html/unnamed-chunk-18-1.png" width="576" style="display: block; margin: auto;"><img src="GettingStarted_1Dsmoothing_files/figure-html/unnamed-chunk-18-2.png" width="576" style="display: block; margin: auto;"><img src="GettingStarted_1Dsmoothing_files/figure-html/unnamed-chunk-18-3.png" width="576" style="display: block; margin: auto;"></p>
<p>The default is to include these covariates as B-splines. You might
consider that observation hour should be a cyclic spline and there is
information <a href="https://lindesaysh.github.io/MRSea/article/FittingDifferentSplines_MRSea_v1.3" class="external-link">here</a>
on how to use cyclic or natural splines.</p>
<p>To include a two dimensional smooth, e.g. a smooth of coordinate
space, see the vignette <a href="https://lindesaysh.github.io/MRSea/article/GettingStarted_2Dsmoothing" class="external-link">here</a></p>
<div class="section level3">
<h3 id="model-selection">Model selection<a class="anchor" aria-label="anchor" href="#model-selection"></a>
</h3>
<p>Fitting the models as described above will always return the
non-factor covariates as smooth terms regardless of whether this is
sensible or not. There is an optional parameter in
<code>runSALSA1D</code> which allows selection for each smooth term
(smooth, linear or removed) using, by default, 10-fold cross-validation
(regardless of fitness measure chosen). To implement this, set the
paramater <code>removal</code> to be <code>TRUE</code>.</p>
<p>Using the same model above with some more covariates added:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">initialModel</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">response</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">+</span> <span class="va">floodebb</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/offset.html" class="external-link">offset</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">area</span><span class="op">)</span><span class="op">)</span>, family <span class="op">=</span> <span class="st">"quasipoisson"</span>, </span>
<span>                    data <span class="op">=</span> <span class="va">vpdata</span><span class="op">)</span></span>
<span></span>
<span><span class="va">varlist</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"observationhour"</span>, <span class="st">"x.pos"</span>, <span class="st">"y.pos"</span>, <span class="st">"MonthOfYear"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">salsa1dlist</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>fitnessMeasure <span class="op">=</span> <span class="st">"QBIC"</span>, </span>
<span>                    minKnots_1d <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">varlist</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                    maxKnots_1d <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">varlist</span><span class="op">)</span><span class="op">)</span>, </span>
<span>                    startKnots_1d <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">varlist</span><span class="op">)</span><span class="op">)</span>, </span>
<span>                    degree <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">varlist</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                    gaps <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">varlist</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">salsa1dOutput.multi.rm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/runSALSA1D.html">runSALSA1D</a></span><span class="op">(</span>initialModel <span class="op">=</span> <span class="va">initialModel</span>, </span>
<span>                            salsa1dlist <span class="op">=</span> <span class="va">salsa1dlist</span>,</span>
<span>                            varlist <span class="op">=</span> <span class="va">varlist</span>, </span>
<span>                            datain <span class="op">=</span> <span class="va">vpdata</span>,</span>
<span>                            removal <span class="op">=</span> <span class="cn">TRUE</span>, <span class="co">##</span></span>
<span>                            suppress.printout <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>In this case we can see that <code>MonthOfYear</code> was removed
from the model altogether. You can see this from the summary of the
model or the <code>modelFits</code> output:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">salsa1dOutput.multi.rm</span><span class="op">$</span><span class="va">modelFits</span><span class="op">[[</span><span class="fl">5</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="co">#&gt; $term</span></span>
<span><span class="co">#&gt; [1] "bs(MonthOfYear, knots = splineParams[[5]]$knots, degree=splineParams[[5]]$degree, Boundary.knots=splineParams[[5]]$bd)"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $kept</span></span>
<span><span class="co">#&gt; [1] "YES - initial"</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $basemodelformula</span></span>
<span><span class="co">#&gt; gamMRSea(formula = round(response) ~ floodebb + bs(observationhour, </span></span>
<span><span class="co">#&gt;     knots = splineParams[[2]]$knots, degree = splineParams[[2]]$degree, </span></span>
<span><span class="co">#&gt;     Boundary.knots = splineParams[[2]]$bd) + bs(x.pos, knots = splineParams[[3]]$knots, </span></span>
<span><span class="co">#&gt;     degree = splineParams[[3]]$degree, Boundary.knots = splineParams[[3]]$bd) + </span></span>
<span><span class="co">#&gt;     bs(y.pos, knots = splineParams[[4]]$knots, degree = splineParams[[4]]$degree, </span></span>
<span><span class="co">#&gt;         Boundary.knots = splineParams[[4]]$bd) + bs(MonthOfYear, </span></span>
<span><span class="co">#&gt;     knots = splineParams[[5]]$knots, degree = splineParams[[5]]$degree, </span></span>
<span><span class="co">#&gt;     Boundary.knots = splineParams[[5]]$bd) + offset(log(area)), </span></span>
<span><span class="co">#&gt;     family = poisson(link = log), data = data)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $knotsSelected</span></span>
<span><span class="co">#&gt; [1] 6.5</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $baseModelFits</span></span>
<span><span class="co">#&gt;         CV    fitStat </span></span>
<span><span class="co">#&gt;   33.21156 3428.81680 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $modelfits</span></span>
<span><span class="co">#&gt;         CV    fitStat </span></span>
<span><span class="co">#&gt;   33.31378 3409.50256</span></span></code></pre></div>
<p>You can see from this output that the model fit (CV score) increased
from the baseModel to the one with the Month term included ad that the
term was not kept (and therefore also had no knots selected).</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/runPartialPlots.html">runPartialPlots</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">salsa1dOutput.multi.rm</span><span class="op">$</span><span class="va">bestModel</span>, </span>
<span>                data <span class="op">=</span> <span class="va">vpdata</span>, </span>
<span>                varlist.in <span class="op">=</span> <span class="va">salsa1dOutput.multi.rm</span><span class="op">$</span><span class="va">keptvarlist</span>,  <span class="co">##</span></span>
<span>                factorlist.in <span class="op">=</span> <span class="st">"floodebb"</span>,</span>
<span>                showKnots <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>                type<span class="op">=</span><span class="st">'link'</span>, </span>
<span>                includeB0 <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Making partial plots"</span></span></code></pre></div>
<p><img src="GettingStarted_1Dsmoothing_files/figure-html/unnamed-chunk-21-1.png" width="576" style="display: block; margin: auto;"><img src="GettingStarted_1Dsmoothing_files/figure-html/unnamed-chunk-21-2.png" width="576" style="display: block; margin: auto;"><img src="GettingStarted_1Dsmoothing_files/figure-html/unnamed-chunk-21-3.png" width="576" style="display: block; margin: auto;"><img src="GettingStarted_1Dsmoothing_files/figure-html/unnamed-chunk-21-4.png" width="576" style="display: block; margin: auto;"><img src="GettingStarted_1Dsmoothing_files/figure-html/unnamed-chunk-21-5.png" width="576" style="display: block; margin: auto;"></p>
<p>In an ideal world you should use cross-validation for both the
flexibility selection and model term selection. However, using CV can be
computationally expensive and so using an information criterion for
flexibility selection and then CV for variable selection can be more
efficient.</p>
<p>What about the factor variable? Factor variable selection is not
currently included as part of the SALSA1D variable selection procedure.
To check this you can manually assess a model with this term
removed.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit_rmfloodeb</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/update.html" class="external-link">update</a></span><span class="op">(</span><span class="va">salsa1dOutput.multi.rm</span><span class="op">$</span><span class="va">bestModel</span>, <span class="va">.</span> <span class="op">~</span> <span class="va">.</span> <span class="op">-</span> <span class="va">floodebb</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/cv.gamMRSea.html">cv.gamMRSea</a></span><span class="op">(</span>modelobject <span class="op">=</span> <span class="va">salsa1dOutput.multi.rm</span><span class="op">$</span><span class="va">bestModel</span>, </span>
<span>            data <span class="op">=</span> <span class="va">vpdata</span>, </span>
<span>            K <span class="op">=</span> <span class="fl">10</span><span class="op">)</span><span class="op">$</span><span class="va">delta</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span>
<span><span class="co">#&gt; [1] 33.30091</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/cv.gamMRSea.html">cv.gamMRSea</a></span><span class="op">(</span>modelobject <span class="op">=</span> <span class="va">fit_rmfloodeb</span>, </span>
<span>            data <span class="op">=</span> <span class="va">vpdata</span>, </span>
<span>            K <span class="op">=</span> <span class="fl">10</span><span class="op">)</span><span class="op">$</span><span class="va">delta</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span>
<span><span class="co">#&gt; [1] 33.50027</span></span></code></pre></div>
<p>The CV score increases when the tide state variable is removed so we
choose to retain it in the model.</p>
<div class="section level4">
<h4 id="other-options">Other options<a class="anchor" aria-label="anchor" href="#other-options"></a>
</h4>
<p>Alternatively, you can use <span class="math inline">\(p\)</span>-value selection via an F-test
ANOVA.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/anova.html" class="external-link">anova</a></span><span class="op">(</span><span class="va">salsa1dOutput.multi.rm</span><span class="op">$</span><span class="va">bestModel</span><span class="op">)</span></span>
<span><span class="co">#&gt; Analysis of 'Wald statistic' Table</span></span>
<span><span class="co">#&gt; Model: quasipoisson, link: log</span></span>
<span><span class="co">#&gt; Response: round(response)</span></span>
<span><span class="co">#&gt; Marginal Testing</span></span>
<span><span class="co">#&gt; Max Panel Size = 1 (independence assumed); Number of panels = 13899</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;                    Df     X2 P(&gt;|Chi|)    </span></span>
<span><span class="co">#&gt; floodebb            2  26.28 1.968e-06 ***</span></span>
<span><span class="co">#&gt; s(observationhour)  3 139.82 &lt; 2.2e-16 ***</span></span>
<span><span class="co">#&gt; s(x.pos)            3 387.66 &lt; 2.2e-16 ***</span></span>
<span><span class="co">#&gt; s(y.pos)            3 251.18 &lt; 2.2e-16 ***</span></span>
<span><span class="co">#&gt; s(MonthOfYear)      3   5.91    0.1163    </span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span></code></pre></div>
<p>By specifying <code>anova</code> it is using the
<code>anova.gamMRSea</code> function (as the class of the model is a
<code>gamMRSea</code> model) which uses marginal testing and, if
available, will use a robust variance-covariance matrix for testing.</p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="further-information">Further information:<a class="anchor" aria-label="anchor" href="#further-information"></a>
</h2>
<p>For information on:</p>
<ol style="list-style-type: decimal">
<li><a href="https://lindesaysh.github.io/MRSea/article/FittingDifferentSplines_MRSea_v1.3" class="external-link">Other
types of 1D spline</a></li>
<li><a href="https://lindesaysh.github.io/MRSea/article/GettingStarted_2Dsmoothing" class="external-link">Two
dimensional smoothing</a></li>
<li>
<a href="https://lindesaysh.github.io/MRSea/article/RenewablesCaseStudy_MRSea_v1.3" class="external-link">Full
Case Study</a> including information on distance sampling,
<code>gamMRSea</code> model diagnostics and using robust standard errors
to deal with residual correlation.</li>
</ol>
</div>
<div class="section level2">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-ScottH2013" class="csl-entry">
Scott-Hayward, L. A. S., M. L. Mackenzie, C. R. Donovan, C. G. Walker,
and E. Ashe. 2013. <span>“Complex Region Spatial Smoother
(CReSS).”</span> <em>Journal of Computational and Graphical
Statistics</em>. <a href="https://doi.org/10.1080/10618600.2012.762920" class="external-link">https://doi.org/10.1080/10618600.2012.762920</a>.
</div>
<div id="ref-ScottH2022" class="csl-entry">
Scott-Hayward, L. A. S., M. L. Mackenzie, C. G. Walker, G. Shatumbu, W.
Kilian, and P. du Preez. 2022. <span>“Automated Surface Feature
Selection Using SALSA2D: An Illustration Using Elephant Mortality Data
in Etosha National Park.”</span> <em>arXiv e-Prints</em>,
arXiv:2202.07977. <a href="https://doi.org/10.48550/arXiv.2202.07977" class="external-link">https://doi.org/10.48550/arXiv.2202.07977</a>.
</div>
<div id="ref-Walker2010" class="csl-entry">
Walker, C. G., M. L. Mackenzie, C. R. Donovan, and M. J. O’Sullivan.
2010. <span>“SALSA - a Spatially Adaptive Local Smoothing
Algorithm.”</span> <em>Journal of Statistical Computation and
Simulation</em> 81 (2): 179–91.
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Lindesay Scott-Hayward, Cameron Walker, Monique Mackenzie.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
