<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="MRSea">
<title>User specified range parameters • MRSea</title>
<script src="../../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../../pkgdown.js"></script><meta property="og:title" content="User specified range parameters">
<meta property="og:description" content="MRSea">
<meta name="google-site-verification" content="dUtyCOSNh9HYALyeXliAlT0ZBt-A4tor8kaiLgS3DRc">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../../index.html">MRSea</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.6</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../../articles/web/IntroductiontoMRSea.html">Introduction to the package</a>
    <h6 class="dropdown-header" data-toc-skip>Basic examples</h6>
    <a class="dropdown-item" href="../../articles/GettingStarted_1Dsmoothing.html">One-dimensional smooths</a>
    <a class="dropdown-item" href="../../articles/GettingStarted_2Dsmoothing.html">Two-dimensional smooths</a>
    <div class="dropdown-divider"></div>
    <a class="dropdown-item" href="../../articles/web/FittingDifferentSplines_MRSea.html">Using Different Splines</a>
    <a class="dropdown-item" href="../../articles/web/Interactions_salsa2d_MRSea.html">Interactions for 2D smooths</a>
    <a class="dropdown-item" href="../../articles/web/ModelDiagnostics_MRSea.html">Model Diagnostics</a>
    <a class="dropdown-item" href="../../articles/web/TheTweedieDistribution_MRSea.html">Using the Tweedie Distribution</a>
    <div class="dropdown-divider"></div>
    <a class="dropdown-item" href="../../articles/web/Publications.html">Publications</a>
    <div class="dropdown-divider"></div>
    <a class="dropdown-item" href="../../articles/web/DistanceSampling.html">Brief Intro to Distance Sampling</a>
    <a class="dropdown-item" href="../../articles/web/RenewablesCaseStudy_MRSea.html">Renewables Case Study</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>More advanced Usage</h6>
    <a class="dropdown-item" href="../../articles/web/Geodesic_2dsmoothing_MRSea.html">Geodesic smoothing</a>
    <a class="dropdown-item" href="../../articles/web/UserRadiiChoice_MRSea.html">Basis radii selection</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/lindesaysh/MRSea/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>User specified range parameters</h1>
                        <h4 data-toc-skip class="author">Lindesay
Scott-Hayward</h4>
            
            <h4 data-toc-skip class="date">2024-05-08</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/lindesaysh/MRSea/blob/HEAD/vignettes/web/UserRadiiChoice_MRSea.Rmd" class="external-link"><code>vignettes/web/UserRadiiChoice_MRSea.Rmd</code></a></small>
      <div class="d-none name"><code>UserRadiiChoice_MRSea.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>This vignette describes how the user may specify their own choices or
choices driven by a variogram for the range parameter. This may be
necessary on occasions where the data is very patchy.</p>
<div class="callout-important">
<p>Note that this page shows an example of the use of the variogram
method for choosing a sequence of <span class="math inline">\(r\)</span>
parameters. No effort has been made to model this data in the best way
possible.</p>
</div>
</div>
<div class="section level2">
<h2 id="fitting-a-model">Fitting a model<a class="anchor" aria-label="anchor" href="#fitting-a-model"></a>
</h2>
<p>The data we shall use for this example is from a Danish offshore
windfarm and is part of the <code>MRSea</code> package. The data are
counts of birds collected along transects over a number of surveys and
years. In this first example, we will use all of the data together and
assess if there is a relationship between number of birds and sea
depth.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://creem2.st-and.ac.uk/software.aspx" class="external-link">MRSea</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># load the data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"nysted.analysisdata"</span><span class="op">)</span></span>
<span><span class="va">wfdata</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">nysted.analysisdata</span>, <span class="va">impact</span><span class="op">==</span><span class="fl">0</span>, <span class="va">season</span><span class="op">==</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="co"># load the prediction grid</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"nysted.predictdata"</span><span class="op">)</span></span>
<span><span class="va">preddata</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">nysted.predictdata</span>, <span class="va">impact</span><span class="op">==</span><span class="fl">0</span>, <span class="va">season</span><span class="op">==</span><span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">preddata</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_tile</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">x.pos</span>, y<span class="op">=</span><span class="va">y.pos</span>, fill<span class="op">=</span><span class="va">truth.re</span>, height<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">area</span><span class="op">)</span>, width<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">area</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html" class="external-link">scale_fill_distiller</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Spectral"</span>,name<span class="op">=</span><span class="st">"No. Birds"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Easting (km)"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Northing (km)"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"The true surface"</span><span class="op">)</span></span></code></pre></div>
<p><img src="UserRadiiChoice_MRSea_files/figure-html/unnamed-chunk-4-1.png" width="700"></p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">wfdata</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_tile</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">x.pos</span>, y<span class="op">=</span><span class="va">y.pos</span>, fill<span class="op">=</span><span class="va">response</span>, height<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">area</span><span class="op">)</span>, width<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">area</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html" class="external-link">scale_fill_distiller</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Spectral"</span>,name<span class="op">=</span><span class="st">"No. Birds"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Easting (km)"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Northing (km)"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Simulated Data"</span><span class="op">)</span></span></code></pre></div>
<p><img src="UserRadiiChoice_MRSea_files/figure-html/unnamed-chunk-5-1.png" width="700"></p>
<div class="section level3">
<h3 id="fitting-a-2d-smooth">Fitting a 2D smooth<a class="anchor" aria-label="anchor" href="#fitting-a-2d-smooth"></a>
</h3>
<p>Set up the initial model with the offset term (if required) and
specify the parameters required. Here we add an offset to be the size of
the segment associated with the bird counts. In reality, our bird counts
are over a particular area so we have counts per unit area. The initial
model contains the offset information, and specifies the family of
model.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">initialModel</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">response</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/offset.html" class="external-link">offset</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">area</span><span class="op">)</span><span class="op">)</span>, </span>
<span>                    family <span class="op">=</span> <span class="st">"quasipoisson"</span>, </span>
<span>                    data <span class="op">=</span> <span class="va">wfdata</span><span class="op">)</span></span></code></pre></div>
<div class="section level4">
<h4 id="set-up-for-the-2d-smooth">Set up for the 2D smooth:<a class="anchor" aria-label="anchor" href="#set-up-for-the-2d-smooth"></a>
</h4>
<ol style="list-style-type: decimal">
<li>Create the knot grid. Here we select 300 space-filled locations from
our data.</li>
</ol>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">knotgrid</span><span class="op">&lt;-</span> <span class="fu"><a href="../../reference/getKnotgrid.html">getKnotgrid</a></span><span class="op">(</span>coordData <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">wfdata</span><span class="op">$</span><span class="va">x.pos</span>, <span class="va">wfdata</span><span class="op">$</span><span class="va">y.pos</span><span class="op">)</span>,</span>
<span>                       numKnots <span class="op">=</span> <span class="fl">300</span>,</span>
<span>                       plot <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>Calculate the distances between the knot points and all data points
and also the distances between all the knots.</li>
</ol>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">distMats</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/makeDists.html">makeDists</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">wfdata</span><span class="op">$</span><span class="va">x.pos</span>, <span class="va">wfdata</span><span class="op">$</span><span class="va">y.pos</span><span class="op">)</span>, <span class="va">knotgrid</span><span class="op">)</span></span></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li>Next we specify some additional parameters needed to run the SALSA2D
algorithm:</li>
</ol>
<ul>
<li>a fit statistic</li>
<li>min, max and start knots.</li>
<li>gap</li>
<li>In addition we can (optionally) add a parameter <code>r_seq</code>
which is a sequence of range/radii values determining the influence of
each basis function. This is the <span class="math inline">\(r\)</span>
parameter in the basis function.</li>
</ul>
<p>The model initialises with the central value of this <span class="math inline">\(r\)</span> sequence. If <code>r_seq</code> is not
specified then the model will choose the range parameters using the
existing <code><a href="../../reference/getRadiiChoices.html">getRadiiChoices()</a></code> function. Using this function
with 10 choices selected and specifying it in <code>salsa2dlist</code>
is the equivalent of not specifying it at all and letting
<code>runSALSA2D</code> calculate them.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">(</span><span class="va">rs.orig</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/getRadiiSequence.html">getRadiiSequence</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"original"</span>,</span>
<span>                             numberofradii <span class="op">=</span> <span class="fl">10</span>, </span>
<span>                             distMatrix <span class="op">=</span> <span class="va">distMats</span><span class="op">$</span><span class="va">dataDist</span>, </span>
<span>                             basis <span class="op">=</span> <span class="st">"gaussian"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;  [1] 0.13494303 0.11445820 0.09708303 0.08234548 0.06984514 0.05924239</span></span>
<span><span class="co">#&gt;  [7] 0.05024919 0.04262118 0.03615113 0.03066326</span></span>
<span><span class="co">#&gt; attr(,"Method")</span></span>
<span><span class="co">#&gt; [1] "Original"</span></span></code></pre></div>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># make parameter set for running salsa2d</span></span>
<span><span class="va">salsa2dlist</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>fitnessMeasure <span class="op">=</span> <span class="st">'QBIC'</span>,</span>
<span>                  knotgrid <span class="op">=</span> <span class="va">knotgrid</span>,</span>
<span>                  startKnots <span class="op">=</span> <span class="fl">10</span>,</span>
<span>                  minKnots <span class="op">=</span> <span class="fl">4</span>,</span>
<span>                  maxKnots <span class="op">=</span> <span class="fl">15</span>,</span>
<span>                  gap <span class="op">=</span> <span class="fl">0</span>,</span>
<span>                  r_seq <span class="op">=</span> <span class="va">rs.orig</span><span class="op">)</span> <span class="co">##</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="alternatively-using-a-variogram-to-choose-radii">Alternatively using a variogram to choose radii<a class="anchor" aria-label="anchor" href="#alternatively-using-a-variogram-to-choose-radii"></a>
</h4>
<ol style="list-style-type: decimal">
<li>Fit a variogram to the location and response data using the
<code>gstat</code> package for <code>R</code> <span class="citation">(Pebesma 2004)</span>.</li>
<li>Use a spherical model to find the range parameter (the distance
where response values are considered no longer correlated)</li>
<li>Use this as the central value for the sequence (the value the
<code>gamMRSea</code> model will initialise on)</li>
<li>Create a sequence of values to allow for more local and more global
bases. This is based on the lags chosen by the function
<code><a href="https://rdrr.io/pkg/gstat/man/variogram.html" class="external-link">gstat::variogram</a></code>.</li>
</ol>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/getRadiiSequence.html">getRadiiSequence</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"variogram"</span>,</span>
<span>                      numberofradii <span class="op">=</span> <span class="fl">10</span>,</span>
<span>                      xydata <span class="op">=</span> <span class="va">wfdata</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x.pos"</span>, <span class="st">"y.pos"</span><span class="op">)</span><span class="op">]</span>,</span>
<span>                      response <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">wfdata</span><span class="op">$</span><span class="va">NHAT</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span>, </span>
<span>                      basis <span class="op">=</span> <span class="st">"gaussian"</span>,</span>
<span>                      distMatrix <span class="op">=</span> <span class="va">distMats</span><span class="op">$</span><span class="va">dataDist</span><span class="op">)</span></span>
<span><span class="va">rs</span></span>
<span><span class="co">#&gt; [1] 0.21110373 0.14048068 0.10526509 0.08416634 0.07011323 0.06008152 0.05256114</span></span>
<span><span class="co">#&gt; [8] 0.04671397 0.04203751</span></span>
<span><span class="co">#&gt; attr(,"Method")</span></span>
<span><span class="co">#&gt; [1] "Variogram"</span></span>
<span><span class="co">#&gt; attr(,"vg.fit")</span></span>
<span><span class="co">#&gt;   model     psill    range</span></span>
<span><span class="co">#&gt; 1   Nug 0.2903582  0.00000</span></span>
<span><span class="co">#&gt; 2   Sph 0.2298275 10.08521</span></span></code></pre></div>
<p>The sequence of <span class="math inline">\(r\)</span>’s in the
<code>rs</code> object also contains a table as part of the attributes.
This shows the variogram model fit and the range parameter used as the
central point of the sequence. In this case, the range parameter is
10.09 which suggests on average, the spatial correlation decays after
approximately 10km.</p>
<p><strong>Visualising the bases:</strong></p>
<p>To have a look at the two methods (the default vs the variogram) we
can look at how the min, max and middle bases of the sequence appear.
Note that the variogram method will always have an odd length sequence
owing to the sequence being based on the middle value.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">b1</span> <span class="op">&lt;-</span><span class="fu"><a href="../../reference/LRF.g.html">LRF.g</a></span><span class="op">(</span>radiusIndices <span class="op">=</span> <span class="fl">1</span>, dists <span class="op">=</span> <span class="va">distMats</span><span class="op">$</span><span class="va">dataDist</span>, radii <span class="op">=</span> <span class="va">rs</span>, aR <span class="op">=</span>  <span class="fl">149</span><span class="op">)</span></span>
<span><span class="fu">fields</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/fields/man/quilt.plot.html" class="external-link">quilt.plot</a></span><span class="op">(</span><span class="va">wfdata</span><span class="op">$</span><span class="va">x.pos</span>, <span class="va">wfdata</span><span class="op">$</span><span class="va">y.pos</span>, <span class="va">b1</span>, zlim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>, main<span class="op">=</span><span class="st">"r1 variogram"</span><span class="op">)</span></span>
<span><span class="va">b1.orig</span> <span class="op">&lt;-</span><span class="fu"><a href="../../reference/LRF.g.html">LRF.g</a></span><span class="op">(</span>radiusIndices <span class="op">=</span> <span class="fl">1</span>, dists <span class="op">=</span> <span class="va">distMats</span><span class="op">$</span><span class="va">dataDist</span>, radii <span class="op">=</span> <span class="va">rs.orig</span>, aR <span class="op">=</span>  <span class="fl">149</span><span class="op">)</span></span>
<span><span class="fu">fields</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/fields/man/quilt.plot.html" class="external-link">quilt.plot</a></span><span class="op">(</span><span class="va">wfdata</span><span class="op">$</span><span class="va">x.pos</span>, <span class="va">wfdata</span><span class="op">$</span><span class="va">y.pos</span>, <span class="va">b1.orig</span>, zlim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>, main<span class="op">=</span><span class="st">"r1 original"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">b5</span> <span class="op">&lt;-</span><span class="fu"><a href="../../reference/LRF.g.html">LRF.g</a></span><span class="op">(</span>radiusIndices <span class="op">=</span> <span class="fl">5</span>, dists <span class="op">=</span> <span class="va">distMats</span><span class="op">$</span><span class="va">dataDist</span>, radii <span class="op">=</span> <span class="va">rs</span>, aR <span class="op">=</span>  <span class="fl">149</span><span class="op">)</span></span>
<span><span class="fu">fields</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/fields/man/quilt.plot.html" class="external-link">quilt.plot</a></span><span class="op">(</span><span class="va">wfdata</span><span class="op">$</span><span class="va">x.pos</span>, <span class="va">wfdata</span><span class="op">$</span><span class="va">y.pos</span>, <span class="va">b5</span>, zlim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>, main<span class="op">=</span><span class="st">"r5 variogram"</span><span class="op">)</span></span>
<span><span class="va">b5.orig</span> <span class="op">&lt;-</span><span class="fu"><a href="../../reference/LRF.g.html">LRF.g</a></span><span class="op">(</span>radiusIndices <span class="op">=</span> <span class="fl">5</span>, dists <span class="op">=</span> <span class="va">distMats</span><span class="op">$</span><span class="va">dataDist</span>, radii <span class="op">=</span> <span class="va">rs.orig</span>, aR <span class="op">=</span>  <span class="fl">149</span><span class="op">)</span></span>
<span><span class="fu">fields</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/fields/man/quilt.plot.html" class="external-link">quilt.plot</a></span><span class="op">(</span><span class="va">wfdata</span><span class="op">$</span><span class="va">x.pos</span>, <span class="va">wfdata</span><span class="op">$</span><span class="va">y.pos</span>, <span class="va">b5.orig</span>, zlim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>, main<span class="op">=</span><span class="st">"r5 original"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">b9</span> <span class="op">&lt;-</span><span class="fu"><a href="../../reference/LRF.g.html">LRF.g</a></span><span class="op">(</span>radiusIndices <span class="op">=</span> <span class="fl">9</span>, dists <span class="op">=</span> <span class="va">distMats</span><span class="op">$</span><span class="va">dataDist</span>, radii <span class="op">=</span> <span class="va">rs</span>, aR <span class="op">=</span>  <span class="fl">149</span><span class="op">)</span></span>
<span><span class="fu">fields</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/fields/man/quilt.plot.html" class="external-link">quilt.plot</a></span><span class="op">(</span><span class="va">wfdata</span><span class="op">$</span><span class="va">x.pos</span>, <span class="va">wfdata</span><span class="op">$</span><span class="va">y.pos</span>, <span class="va">b9</span>, zlim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>, main<span class="op">=</span><span class="st">"r9 variogram"</span><span class="op">)</span></span>
<span><span class="va">b10.orig</span> <span class="op">&lt;-</span><span class="fu"><a href="../../reference/LRF.g.html">LRF.g</a></span><span class="op">(</span>radiusIndices <span class="op">=</span> <span class="fl">10</span>, dists <span class="op">=</span> <span class="va">distMats</span><span class="op">$</span><span class="va">dataDist</span>, radii <span class="op">=</span> <span class="va">rs.orig</span>, aR <span class="op">=</span>  <span class="fl">149</span><span class="op">)</span></span>
<span><span class="fu">fields</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/fields/man/quilt.plot.html" class="external-link">quilt.plot</a></span><span class="op">(</span><span class="va">wfdata</span><span class="op">$</span><span class="va">x.pos</span>, <span class="va">wfdata</span><span class="op">$</span><span class="va">y.pos</span>, <span class="va">b10.orig</span>, zlim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>, main<span class="op">=</span><span class="st">"r10 original"</span><span class="op">)</span></span></code></pre></div>
<p><img src="UserRadiiChoice_MRSea_files/figure-html/unnamed-chunk-11-1.png" width="576" style="display: block; margin: auto;"></p>
<p>There is not a huge difference with the original here but the
variogram method suggests slightly smaller bases in general.</p>
<div class="callout-important">
<p>Note that if the variogram method selects a small range compared with
the size of the distances available in your surface then the model may
support many more knots. In this case you might consider starting with a
larger number.</p>
</div>
</div>
<div class="section level4">
<h4 id="fitting-the-models">Fitting the models:<a class="anchor" aria-label="anchor" href="#fitting-the-models"></a>
</h4>
<p>Let’s have a look at the modelling differences. First the original
parametrisation.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># make parameter set for running salsa2d</span></span>
<span><span class="va">salsa2dlist</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>fitnessMeasure <span class="op">=</span> <span class="st">'QBIC'</span>,</span>
<span>                  knotgrid <span class="op">=</span> <span class="va">knotgrid</span>,</span>
<span>                  startKnots <span class="op">=</span> <span class="fl">10</span>,</span>
<span>                  minKnots <span class="op">=</span> <span class="fl">4</span>,</span>
<span>                  maxKnots <span class="op">=</span> <span class="fl">15</span>,</span>
<span>                  gap <span class="op">=</span> <span class="fl">0</span>,</span>
<span>                  r_seq <span class="op">=</span> <span class="va">rs.orig</span><span class="op">)</span> <span class="co">##</span></span></code></pre></div>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">salsa2dOutput.origr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/runSALSA2D.html">runSALSA2D</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">initialModel</span>,</span>
<span>                          salsa2dlist <span class="op">=</span> <span class="va">salsa2dlist</span>,</span>
<span>                          d2k<span class="op">=</span><span class="va">distMats</span><span class="op">$</span><span class="va">dataDist</span>,</span>
<span>                          k2k<span class="op">=</span><span class="va">distMats</span><span class="op">$</span><span class="va">knotDist</span>,</span>
<span>                          suppress.printout <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">salsa2dOutput.origr</span> <span class="op">&lt;-</span> <span class="va">salsa2dOutput.origr</span><span class="op">$</span><span class="va">bestModel</span></span></code></pre></div>
<ul>
<li>Change out the <span class="math inline">\(r\)</span> sequence for
the variogram method.</li>
</ul>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">salsa2dlist</span><span class="op">$</span><span class="va">r_seq</span> <span class="op">&lt;-</span> <span class="va">rs</span></span>
<span></span>
<span><span class="va">salsa2dOutput.vario</span> <span class="op">&lt;-</span><span class="fu"><a href="../../reference/runSALSA2D.html">runSALSA2D</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">initialModel</span>,</span>
<span>                          salsa2dlist <span class="op">=</span> <span class="va">salsa2dlist</span>,</span>
<span>                          d2k<span class="op">=</span><span class="va">distMats</span><span class="op">$</span><span class="va">dataDist</span>,</span>
<span>                          k2k<span class="op">=</span><span class="va">distMats</span><span class="op">$</span><span class="va">knotDist</span>,</span>
<span>                          suppress.printout <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">salsa2dOutput.vario</span> <span class="op">&lt;-</span> <span class="va">salsa2dOutput.vario</span><span class="op">$</span><span class="va">bestModel</span></span></code></pre></div>
</div>
</div>
</div>
<div class="section level2">
<h2 id="assessment-of-outputs">Assessment of outputs<a class="anchor" aria-label="anchor" href="#assessment-of-outputs"></a>
</h2>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># radius indices</span></span>
<span><span class="va">salsa2dOutput.origr</span><span class="op">$</span><span class="va">splineParams</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">radiusIndices</span></span>
<span><span class="co">#&gt; [1] 4 5 5 5 5 5</span></span>
<span><span class="va">salsa2dOutput.vario</span><span class="op">$</span><span class="va">splineParams</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">radiusIndices</span></span>
<span><span class="co">#&gt; [1] 4 4 4 4 4 4 4</span></span></code></pre></div>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># CV scores</span></span>
<span><span class="fu"><a href="../../reference/cv.gamMRSea.html">cv.gamMRSea</a></span><span class="op">(</span><span class="va">wfdata</span>, <span class="va">salsa2dOutput.origr</span>, K<span class="op">=</span><span class="fl">10</span>, s.eed<span class="op">=</span><span class="fl">154</span><span class="op">)</span><span class="op">$</span><span class="va">delta</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span>
<span><span class="co">#&gt; [1] 10.05107</span></span>
<span><span class="fu"><a href="../../reference/cv.gamMRSea.html">cv.gamMRSea</a></span><span class="op">(</span><span class="va">wfdata</span>, <span class="va">salsa2dOutput.vario</span>, K<span class="op">=</span><span class="fl">10</span>, s.eed<span class="op">=</span><span class="fl">154</span><span class="op">)</span><span class="op">$</span><span class="va">delta</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span>
<span><span class="co">#&gt; [1] 10.03927</span></span></code></pre></div>
<p>The variogram method</p>
<ul>
<li>chose one more knot and similar indexes (smaller radii than the
equivalent index from the default method)</li>
<li>has a lower, and therefore better, CV score than the default.</li>
</ul>
<div class="section level3">
<h3 id="predictions">Predictions<a class="anchor" aria-label="anchor" href="#predictions"></a>
</h3>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">preddist</span><span class="op">&lt;-</span><span class="fu"><a href="../../reference/makeDists.html">makeDists</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">preddata</span><span class="op">$</span><span class="va">x.pos</span>, <span class="va">preddata</span><span class="op">$</span><span class="va">y.pos</span><span class="op">)</span>,</span>
<span>                 <span class="va">knotgrid</span>, knotmat<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span><span class="op">$</span><span class="va">dataDist</span></span>
<span></span>
<span><span class="co"># make predictions on response scale</span></span>
<span><span class="va">preds.orig</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span>newdata <span class="op">=</span> <span class="va">preddata</span>,</span>
<span>               g2k <span class="op">=</span> <span class="va">preddist</span>,</span>
<span>               object <span class="op">=</span> <span class="va">salsa2dOutput.origr</span><span class="op">)</span></span>
<span></span>
<span><span class="va">preds.vario</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span>newdata <span class="op">=</span> <span class="va">preddata</span>,</span>
<span>               g2k <span class="op">=</span> <span class="va">preddist</span>,</span>
<span>               object <span class="op">=</span> <span class="va">salsa2dOutput.vario</span><span class="op">)</span></span></code></pre></div>
<ul>
<li>Predictions from both models. The following plots show the model
predictions and the locations of each of the knots.</li>
</ul>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">a</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">preddata</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_tile</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">x.pos</span>, y<span class="op">=</span><span class="va">y.pos</span>, fill<span class="op">=</span><span class="va">preds.orig</span>, height<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">area</span><span class="op">)</span>, width<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">area</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html" class="external-link">scale_fill_distiller</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Spectral"</span>,name<span class="op">=</span><span class="st">"No. Birds"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Easting (km)"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Northing (km)"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html" class="external-link">coord_equal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">knotgrid</span><span class="op">[</span><span class="va">salsa2dOutput.origr</span><span class="op">$</span><span class="va">splineParams</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">knotPos</span>,<span class="op">]</span><span class="op">)</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">X1</span>, <span class="va">X2</span><span class="op">)</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Default r"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">b</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">preddata</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_tile</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">x.pos</span>, y<span class="op">=</span><span class="va">y.pos</span>, fill<span class="op">=</span><span class="va">preds.vario</span>, height<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">area</span><span class="op">)</span>, width<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">area</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html" class="external-link">scale_fill_distiller</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Spectral"</span>,name<span class="op">=</span><span class="st">"No. Birds"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Easting (km)"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Northing (km)"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html" class="external-link">coord_equal</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">knotgrid</span><span class="op">[</span><span class="va">salsa2dOutput.vario</span><span class="op">$</span><span class="va">splineParams</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">knotPos</span>,<span class="op">]</span><span class="op">)</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">X1</span>, <span class="va">X2</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Variogram based r"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">ggpubr</span><span class="fu">::</span><span class="fu"><a href="https://rpkgs.datanovia.com/ggpubr/reference/ggarrange.html" class="external-link">ggarrange</a></span><span class="op">(</span><span class="va">a</span>,<span class="va">b</span>, common.legend <span class="op">=</span> <span class="cn">TRUE</span>, ncol <span class="op">=</span> <span class="fl">1</span>, legend <span class="op">=</span> <span class="st">"right"</span><span class="op">)</span></span></code></pre></div>
<p><img src="UserRadiiChoice_MRSea_files/figure-html/unnamed-chunk-18-1.png" width="700"></p>
<!-- - Comparison to the true surface. -->
<!-- - Mean Variance relationship -->
<!-- ```{r fig.keep=FALSE} -->
<!-- p1 <- plotMeanVar(salsa2dOutput.origr,) + ggtitle("Default r") -->
<!-- p2 <- plotMeanVar(salsa2dOutput.vario) + ggtitle("Variogram based r") -->
<!-- ``` -->
<!-- ```{r} -->
<!-- ggpubr::ggarrange(p1, p2, ncol=2, common.legend = TRUE) -->
<!-- ``` -->
<!-- The mean variance relationships are similar for the two methods but slightly steeper and  -->
<!-- ```{r} -->
<!-- boots.orig <- do.bootstrap.cress.robust(salsa2dOutput.origr, preddata, g2k=preddist, B = 500, cat.message = FALSE) -->
<!-- cis.orig <- makeBootCIs(boots.orig) -->
<!-- ``` -->
<!-- ```{r} -->
<!-- boots.vario <- do.bootstrap.cress.robust(salsa2dOutput.vario, preddata, g2k=preddist, B = 500, cat.message = FALSE) -->
<!-- cis.vario <- makeBootCIs(boots.vario) -->
<!-- ``` -->
<!-- ```{r} -->
<!-- apply(cis.orig, 2, sum) -->
<!-- apply(cis.vario, 2, sum) -->
<!-- ``` -->
<!-- ```{r message=FALSE, warning=FALSE} -->
<!-- preddata %>%  -->
<!--   mutate(preds = preds.orig,  -->
<!--          lowerci = cis.orig[,1],  -->
<!--          upperci=cis.orig[,2]) %>% -->
<!--   tidyr::pivot_longer(cols = c(preds, lowerci, upperci), names_to = "type", values_to = "EstCount") %>% -->
<!--   ggplot() +  -->
<!--   geom_tile(aes(x=x.pos, y=y.pos, fill=EstCount, height=sqrt(area), width=sqrt(area))) + -->
<!--   scale_fill_distiller(palette = "Spectral",name="No. Birds") + -->
<!--   xlab("Easting (km)") + ylab("Northing (km)") + theme_bw() + -->
<!--   coord_equal() + facet_wrap(~type) +  -->
<!--   ggtitle("Original r") -->
<!-- ``` -->
<!-- ```{r message=FALSE, warning=FALSE} -->
<!-- preddata %>%  -->
<!--   mutate(preds = preds.vario,  -->
<!--          lowerci = cis.vario[,1],  -->
<!--          upperci=cis.vario[,2]) %>% -->
<!--   tidyr::pivot_longer(cols = c(preds, lowerci, upperci), names_to = "type", values_to = "EstCount") %>% -->
<!--   ggplot() +  -->
<!--   geom_tile(aes(x=x.pos, y=y.pos, fill=EstCount, height=sqrt(area), width=sqrt(area))) + -->
<!--   scale_fill_distiller(palette = "Spectral",name="No. Birds") + -->
<!--   xlab("Easting (km)") + ylab("Northing (km)") + theme_bw() + -->
<!--   coord_equal() + facet_wrap(~type) +  -->
<!--   ggtitle("Variogram r") -->
<!-- ``` -->
<!-- ```{r} -->
<!-- salsa2dOutput.vario.chooser <-runSALSA2D(model = initialModel, -->
<!--                           salsa2dlist = salsa2dlist, -->
<!--                           d2k=distMats$dataDist, -->
<!--                           k2k=distMats$knotDist, -->
<!--                           suppress.printout = TRUE, -->
<!--                           chooserad = TRUE) -->
<!-- ``` -->
<!-- ```{r} -->
<!-- set.seed(154) -->
<!-- cv.gamMRSea(wfdata, salsa2dOutput.vario.chooser$bestModel, K=10)$delta[2] -->
<!-- ``` -->
<!-- ```{r} -->
<!-- preds.vario.cr<-predict(newdata = preddata, -->
<!--                g2k = preddist, -->
<!--                object = salsa2dOutput.vario.chooser$bestModel) -->
<!-- ggplot(preddata) + -->
<!--   geom_tile(aes(x=x.pos, y=y.pos, fill=preds.vario.cr, height=sqrt(area), width=sqrt(area))) + -->
<!--   scale_fill_distiller(palette = "Spectral",name="No. Birds") + -->
<!--   xlab("Easting (km)") + ylab("Northing (km)") + theme_bw() + -->
<!--   coord_equal()+ -->
<!--   geom_point(data=data.frame(knotgrid[salsa2dOutput.vario.chooser$bestModel$splineParams[[1]]$knotPos,]), aes(X1, X2)) -->
<!-- ``` -->
<!-- ```{r} -->
<!-- boots.vario.cr <- do.bootstrap.cress.robust(salsa2dOutput.vario.chooser$bestModel, preddata, g2k=preddist, B = 500, cat.message = FALSE) -->
<!-- cis.vario.cr <- makeBootCIs(boots.vario.cr) -->
<!-- ``` -->
<!-- ```{r} -->
<!-- apply(cis.orig, 2, sum) -->
<!-- apply(cis.vario, 2, sum) -->
<!-- apply(cis.vario.cr, 2, sum) -->
<!-- ``` -->
<!-- ```{r message=FALSE, warning=FALSE} -->
<!-- preddata %>%  -->
<!--   mutate(preds = preds.vario.cr,  -->
<!--          lowerci = cis.vario.cr[,1],  -->
<!--          upperci=cis.vario.cr[,2]) %>% -->
<!--   tidyr::pivot_longer(cols = c(preds, lowerci, upperci), names_to = "type", values_to = "EstCount") %>% -->
<!--   ggplot() +  -->
<!--   geom_tile(aes(x=x.pos, y=y.pos, fill=EstCount, height=sqrt(area), width=sqrt(area))) + -->
<!--   scale_fill_distiller(palette = "Spectral",name="No. Birds") + -->
<!--   xlab("Easting (km)") + ylab("Northing (km)") + theme_bw() + -->
<!--   coord_equal() + facet_wrap(~type) +  -->
<!--   ggtitle("Vario r") -->
<!-- ``` -->
</div>
</div>
<div class="section level2">
<h2 id="links-between-the-range-from-the-variogram-and-the-range-parameter-in-the-rbfs">Links between the range from the variogram and the range parameter
in the RBF’s:<a class="anchor" aria-label="anchor" href="#links-between-the-range-from-the-variogram-and-the-range-parameter-in-the-rbfs"></a>
</h2>
<ol style="list-style-type: decimal">
<li>The Gaussian RBF is defined in <span class="citation">(Scott-Hayward
et al. 2022)</span> as:</li>
</ol>
<p><span class="math display">\[e^{-(d*r)^2}\]</span></p>
<p>but may equally be presented as: <span class="math display">\[e^{-(d⁄(2\sigma^2))}\]</span> In this latter
equation, σ represents the range parameter and so the link to the <span class="math inline">\(r\)</span> parameter is: <span class="math inline">\(r= \sqrt{2}\sigma\)</span></p>
<ol start="2" style="list-style-type: decimal">
<li>The exponential RBF is defined in <span class="citation">(Scott-Hayward et al. 2015)</span> as: <span class="math display">\[e^{(d⁄r^2)}\]</span> It may also be presented as
<span class="math display">\[e^{(d⁄V)}\]</span>
</li>
</ol>
<p>In this case, <span class="math inline">\(V\)</span> represents the
range parameter and so the link to the <span class="math inline">\(r\)</span> parameter is <span class="math inline">\(r=\sqrt{V}\)</span></p>
<p>In the models fitted here, the range parameter was found to be 10
indicating that on average there ceased to be spatial correlation after
approximately 10 km.</p>
</div>
<div class="section level2">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-pebesma2004" class="csl-entry">
Pebesma, Edzer J. 2004. <span>“Multivariable Geostatistics in S: The
Gstat Package.”</span> <em>Computers &amp; Geosciences</em> 30 (7):
683–91. <a href="https://doi.org/10.1016/j.cageo.2004.03.012" class="external-link">https://doi.org/10.1016/j.cageo.2004.03.012</a>.
</div>
<div id="ref-scott-hayward2022" class="csl-entry">
Scott-Hayward, L. A. S., M. L. Mackenzie, C. G. Walker, G. Shatumbu, W.
Kilian, and P. du Preez. 2022. <span>“Automated Surface Feature
Selection Using SALSA2D: An Illustration Using Elephant Mortality Data
in Etosha National Park.”</span> <a href="https://doi.org/10.48550/ARXIV.2202.07977" class="external-link">https://doi.org/10.48550/ARXIV.2202.07977</a>.
</div>
<div id="ref-scott-hayward2015" class="csl-entry">
Scott-Hayward, L. A. S., Monique L. Mackenzie, Erin Ashe, and Rob
Williams. 2015. <span>“Modelling Killer Whale Feeding Behaviour Using a
Spatially Adaptive Complex Region Spatial Smoother (CReSS) and
Generalised Estimating Equations (GEEs).”</span> <em>Journal of
Agricultural, Biological, and Environmental Statistics</em> 20 (3):
305–22. <a href="https://doi.org/10.1007/s13253-015-0209-2" class="external-link">https://doi.org/10.1007/s13253-015-0209-2</a>.
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Lindesay Scott-Hayward, Cameron Walker, Monique Mackenzie.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.9000.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
