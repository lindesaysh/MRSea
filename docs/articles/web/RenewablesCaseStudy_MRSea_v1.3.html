<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="MRSea">
<title>Statistical Modelling of bird and cetacean distributions in offshore renewables development areas • MRSea</title>
<script src="../../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../../deps/bootstrap-5.1.3/bootstrap.min.css" rel="stylesheet">
<script src="../../deps/bootstrap-5.1.3/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../../pkgdown.js"></script><meta property="og:title" content="Statistical Modelling of bird and cetacean distributions in offshore renewables development areas">
<meta property="og:description" content="MRSea">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../../index.html">MRSea</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.3.3</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <h6 class="dropdown-header" data-toc-skip>Basic examples</h6>
    <a class="dropdown-item" href="../../articles/web/GettingStarted_1Dsmoothing.html">One-dimensional smooths</a>
    <a class="dropdown-item" href="../../articles/web/GettingStarted_2Dsmoothing.html">Two-dimensional smooths</a>
    <div class="dropdown-divider"></div>
    <a class="dropdown-item" href="../../articles/web/FittingDifferentSplines_MRSea_v1.3.Rmd.html">Using Different Splines</a>
    <a class="dropdown-item" href="../../articles/web/Interactions_salsa2d_MRSea_v1.3">Interactions for 2D smooths</a>
    <a class="dropdown-item" href="../../articles/web/publications.html">Publications</a>
    <div class="dropdown-divider"></div>
    <a class="dropdown-item" href="../../articles/web/RenewablesCaseStudy_MRSea_v1.3.html">Renewables Case Study</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>More advanced Usage</h6>
    <a class="dropdown-item" href="../../articles/web/Geodesic_2dsmoothing_MRSea_v1.3.html">Geodesic smoothing</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/lindesaysh/MRSea/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Statistical Modelling of bird and cetacean distributions in offshore renewables development areas</h1>
                        <h4 data-toc-skip class="author">LAS
Scott-Hayward, CG Walker and ML Mackenzie</h4>
            
            <h4 data-toc-skip class="date">2023-01-30</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/lindesaysh/MRSea/blob/HEAD/vignettes/web/RenewablesCaseStudy_MRSea_v1.3.Rmd" class="external-link"><code>vignettes/web/RenewablesCaseStudy_MRSea_v1.3.Rmd</code></a></small>
      <div class="d-none name"><code>RenewablesCaseStudy_MRSea_v1.3.Rmd</code></div>
    </div>

    
    
<hr>
<div class="section level4">
<h4 id="this-vignette-constitutes-work-carried-out-at-the-centre-for-research-into-ecological-and-environmental-modelling-creem-at-the-university-of-st--andrews-">This vignette constitutes work carried out at the Centre for
Research into Ecological and Environmental Modelling (CREEM) at the
University of St. Andrews.<a class="anchor" aria-label="anchor" href="#this-vignette-constitutes-work-carried-out-at-the-centre-for-research-into-ecological-and-environmental-modelling-creem-at-the-university-of-st--andrews-"></a>
</h4>
<p><strong>Please reference this document as:</strong> Scott-Hayward,
L.A.S., Mackenzie, M.L. and Walker, C.G. (2021). Vignette for the MRSea
Package v1.3: Statistical Modelling of bird and cetacean distributions
in offshore renewables development areas. Centre for Research into
Ecological and Environmental Modelling, University of St Andrews.</p>
<hr>
</div>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>The <code>MRSea</code> package was developed for analysing data that
was collected for assessing potential impacts of renewable developments
on marine wildlife, although the methods are applicable to other studies
as well. This vignette gives an updated example of the code for version
1.3. For additional information regarding methods, see <span class="citation">Mackenzie et al. (2013)</span> and <span class="citation">Scott-Hayward, Oedekoven, et al. (2013)</span>. The
user should be familiar with generalised linear models and their
assumptions and model selection. The <code>MRSea</code> package
primarily allows spatially adaptive model selection for both one and two
dimensional covariates using the functions <code>runSALSA1D</code> and
<code>runSALSA2D</code>, which implement the methods of <span class="citation">Walker et al. (2010)</span>, <span class="citation">Scott-Hayward, Mackenzie, et al. (2013)</span> and
<span class="citation">Scott-Hayward et al. (2022)</span>.</p>
<p>The major update to this package (from version 0 to version 1)is that
a class of model <code>gamMRSea</code> is created when running either
SALSA 1D or 2D. This retains within the model object information
regarding fitting, such as the <code>splineParam</code> object and the
panel structure (if present). The use of the <code>summary</code>
function on these models returns both raw and robust standard errors,
with the <em>p</em>-values from the models hypothesis test using the
robust standard errors. The robust standard errors are obtained using
the panel structure given (independence is one panel per data point and
is the default if no structure is given).</p>
<p>Other functions include diagnostics (to assess residual correlation:
<code>runACF</code>, smooth relationships: <code>runPartialPlots</code>
and model selection (ANOVA) for robust standard errors:
<code>anova.gamMRSea</code>) and inference
(<code>do.bootstrap.cress</code>).</p>
<p><img src="images/MRSea_workflow.png" alt="alt text"> Example of the
modelling process using MRSea. Packages with functions to run certain
parts are given in oval boxes. To complete the modelling process, other
packages may be used at certain stages. These are coded light blue,
whilst MRSea functions are in red.</p>
</div>
<div class="section level2">
<h2 id="distance-sampling-using-the-mrds-library">Distance sampling using the <code>mrds</code> library<a class="anchor" aria-label="anchor" href="#distance-sampling-using-the-mrds-library"></a>
</h2>
<ol style="list-style-type: decimal">
<li>Load data and fit detection function (Distance Sampling)</li>
</ol>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#devtools::load_all(path='../../MRSea/')</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="va"><a href="http://creem2.st-and.ac.uk/software.aspx" class="external-link">MRSea</a></span><span class="op">)</span></span>
<span><span class="co"># we will use the dataset with a known re-distribution of animals</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">dis.data.re</span><span class="op">)</span></span>
<span><span class="va">dis.data</span><span class="op">&lt;-</span><span class="va">dis.data.re</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="va"><a href="https://github.com/DistanceDevelopment/mrds/" class="external-link">mrds</a></span><span class="op">)</span> <span class="co"># distance sampling package</span></span>
<span><span class="va">result</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/mrds/man/ddf.html" class="external-link">ddf</a></span><span class="op">(</span>dsmodel<span class="op">=</span><span class="op">~</span><span class="fu">mcds</span><span class="op">(</span>key<span class="op">=</span><span class="st">"hn"</span>, formula<span class="op">=</span><span class="op">~</span><span class="fl">1</span><span class="op">)</span>,</span>
<span>              data <span class="op">=</span> <span class="va">dis.data</span>, method<span class="op">=</span><span class="st">"ds"</span>, </span>
<span>              meta.data<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>width<span class="op">=</span><span class="fl">250</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">result</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Distance sampling analysis object</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Summary for ds object</span></span>
<span><span class="co">#&gt; Number of observations :  2373 </span></span>
<span><span class="co">#&gt; Distance range         :  0  -  250 </span></span>
<span><span class="co">#&gt; AIC                    :  25446.68 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Detection function:</span></span>
<span><span class="co">#&gt;  Half-normal key function </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Detection function parameters </span></span>
<span><span class="co">#&gt; Scale coefficient(s): </span></span>
<span><span class="co">#&gt;             estimate         se</span></span>
<span><span class="co">#&gt; (Intercept) 4.754715 0.02068035</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;                         Estimate           SE         CV</span></span>
<span><span class="co">#&gt; Average p              0.5639473  0.009624525 0.01706636</span></span>
<span><span class="co">#&gt; N in covered region 4207.8400478 91.709328911 0.02179487</span></span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">result</span><span class="op">)</span></span></code></pre></div>
<p><img src="RenewablesCaseStudy_MRSea_v1.3_files/figure-html/unnamed-chunk-5-1.png" width="700"></p>
<ol start="2" style="list-style-type: decimal">
<li>Adjust sightings for detectability</li>
</ol>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># create.NHAT and create.count.data are MRSea functions to adjust the </span></span>
<span><span class="co"># sightings for the detection function estimated above.</span></span>
<span><span class="va">dis.data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/create.NHAT.html">create.NHAT</a></span><span class="op">(</span><span class="va">dis.data</span>,<span class="va">result</span><span class="op">)</span></span>
<span><span class="va">count.data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/create.count.data.html">create.count.data</a></span><span class="op">(</span><span class="va">dis.data</span><span class="op">)</span></span></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li>Try a simple model</li>
</ol>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">count.data</span><span class="op">$</span><span class="va">response</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">count.data</span><span class="op">$</span><span class="va">NHAT</span><span class="op">)</span></span>
<span><span class="va">fullModel</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">response</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">season</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">impact</span><span class="op">)</span> <span class="op">+</span></span>
<span>                   <span class="va">depth</span> <span class="op">+</span> <span class="va">x.pos</span> <span class="op">+</span> <span class="va">y.pos</span>, family <span class="op">=</span> <span class="va">poisson</span>, data <span class="op">=</span> <span class="va">count.data</span><span class="op">)</span></span></code></pre></div>
<ol start="4" style="list-style-type: decimal">
<li>Try a model with a smooth term for depth</li>
</ol>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="va">splines</span><span class="op">)</span></span>
<span><span class="va">fullModel</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">response</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">season</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">impact</span><span class="op">)</span> <span class="op">+</span></span>
<span>                   <span class="fu"><a href="https://rdrr.io/r/splines/bs.html" class="external-link">bs</a></span><span class="op">(</span><span class="va">depth</span>, knots <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">depth</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="va">x.pos</span> <span class="op">+</span> <span class="va">y.pos</span>, </span>
<span>                 family <span class="op">=</span> <span class="va">poisson</span>,data <span class="op">=</span> <span class="va">count.data</span><span class="op">)</span></span></code></pre></div>
<ol start="5" style="list-style-type: decimal">
<li>If the data are correlated then you may wish to specify a blocking
structure in your dataset.</li>
</ol>
<p>For correlated data:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">count.data</span><span class="op">$</span><span class="va">blockid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">count.data</span><span class="op">$</span><span class="va">transect.id</span>, </span>
<span>                            <span class="va">count.data</span><span class="op">$</span><span class="va">season</span>, </span>
<span>                            <span class="va">count.data</span><span class="op">$</span><span class="va">impact</span>,sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="selection-of-1d-covariates">Selection of 1D Covariates<a class="anchor" aria-label="anchor" href="#selection-of-1d-covariates"></a>
</h2>
<p>Run SALSA1D to select what covariates are included and whether or not
they are smooth. SALSA selects the smoothness of each term (number and
location of knots) and 10-fold CV is used to choose between the best
smooth term, a linear term or no term at all. To not allow the removal
process the user may set <code>removal = FALSE</code> as a parameter in
the function <code>runSALSA1D</code>.</p>
<ol start="6" style="list-style-type: decimal">
<li>If you wish to make predictions once the model is fitted, then a
prediction grid should be created and specified. This is because the
splines fitted here (B-splines) are unable to make predictions outside
of the range they were created. For example, if the data range for depth
is smaller than the range of depths in the prediction data, predictions
cannot be made.</li>
</ol>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"nysted.predictdata"</span><span class="op">)</span>  <span class="co"># contains predict.data</span></span>
<span><span class="co"># This is a spatial grid for making predictions.  All covariates in </span></span>
<span><span class="co"># final model must be in this data frame and the naming must be the </span></span>
<span><span class="co"># same as for the data</span></span>
<span><span class="va">predictData</span> <span class="op">&lt;-</span> <span class="va">nysted.predictdata</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="va">count.data</span><span class="op">$</span><span class="va">depth</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] -28.608  -0.411</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="va">predictData</span><span class="op">$</span><span class="va">depth</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] -28.608  -0.200</span></span></code></pre></div>
<p>Here the range of the predictions is slightly wider than the range of
the data, so we will specify <code>predictData</code> when running
SALSA.</p>
<ol start="7" style="list-style-type: decimal">
<li>Set up the initial model with factor covariates and the offset term
(if required) and specify the parameters required:</li>
</ol>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">initialModel</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">response</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">season</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">impact</span><span class="op">)</span> </span>
<span>                    <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/offset.html" class="external-link">offset</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">area</span><span class="op">)</span><span class="op">)</span>, family <span class="op">=</span> <span class="st">"quasipoisson"</span>, </span>
<span>                    data <span class="op">=</span> <span class="va">count.data</span><span class="op">)</span></span></code></pre></div>
<p>The fitness measure can be one of several options (AIC, BIC, QAIC,
QBIC, CV). Here we use QBIC.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">salsa1dlist</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>fitnessMeasure <span class="op">=</span> <span class="st">"QBIC"</span>, </span>
<span>                    minKnots_1d <span class="op">=</span> <span class="fl">2</span>,</span>
<span>                    maxKnots_1d <span class="op">=</span> <span class="fl">5</span>, </span>
<span>                    startKnots_1d <span class="op">=</span> <span class="fl">1</span>, </span>
<span>                    degree <span class="op">=</span> <span class="fl">2</span>,</span>
<span>                    gaps <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>If you want to use CV, you will need an additional parameter in the
list; <code>cv.opts</code></p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">salsa1dlist</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>fitnessMeasure <span class="op">=</span> <span class="st">"cv.gamMRSea"</span>, </span>
<span>                    minKnots_1d <span class="op">=</span> <span class="fl">2</span>,</span>
<span>                    maxKnots_1d <span class="op">=</span> <span class="fl">3</span>, </span>
<span>                    startKnots_1d <span class="op">=</span> <span class="fl">1</span>, </span>
<span>                    degree <span class="op">=</span> <span class="fl">2</span>,</span>
<span>                    gaps <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span>, </span>
<span>                    cv.opts<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>cv.gamMRSea.seed<span class="op">=</span><span class="fl">1</span>, K<span class="op">=</span><span class="fl">10</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<ol start="8" style="list-style-type: decimal">
<li>Run SALSA;</li>
</ol>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># run SALSA</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="va">MuMIn</span><span class="op">)</span></span>
<span><span class="va">salsa1dOutput</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/runSALSA1D.html">runSALSA1D</a></span><span class="op">(</span><span class="va">initialModel</span>, <span class="va">salsa1dlist</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"depth"</span><span class="op">)</span>,</span>
<span>                      predictionData<span class="op">=</span><span class="va">predictData</span>, datain<span class="op">=</span><span class="va">count.data</span>, removal<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>Use the built in summary function (<code>summary.gamMRSea</code>) to
look at the summary of the model. Note that robust standard errors are
given alongside the raw standard errors and information regarding panels
is at the bottom of the output. If each data point is a panel, then
independence is assumed.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">salsa1dOutput</span><span class="op">$</span><span class="va">bestModel</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; gamMRSea(formula = response ~ as.factor(season) + as.factor(impact) + </span></span>
<span><span class="co">#&gt;     bs(depth, knots = splineParams[[2]]$knots, degree = splineParams[[2]]$degree, </span></span>
<span><span class="co">#&gt;         Boundary.knots = splineParams[[2]]$bd) + offset(log(area)), </span></span>
<span><span class="co">#&gt;     family = quasipoisson(link = log), data = count.data, splineParams = splineParams)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Deviance Residuals: </span></span>
<span><span class="co">#&gt;     Min       1Q   Median       3Q      Max  </span></span>
<span><span class="co">#&gt; -2.3225  -1.1095  -0.4331  -0.1030  19.3191  </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients:</span></span>
<span><span class="co">#&gt;                    Estimate Std. Error Robust S.E. t value Pr(&gt;|t|)    </span></span>
<span><span class="co">#&gt; (Intercept)        -5.13066    3.68069     3.68069  -1.394  0.16337    </span></span>
<span><span class="co">#&gt; as.factor(season)2 -1.23880    0.13894     0.13894  -8.916  &lt; 2e-16 ***</span></span>
<span><span class="co">#&gt; as.factor(season)3 -1.20226    0.13699     0.13699  -8.776  &lt; 2e-16 ***</span></span>
<span><span class="co">#&gt; as.factor(season)4 -0.85625    0.12060     0.12060  -7.100 1.34e-12 ***</span></span>
<span><span class="co">#&gt; as.factor(impact)1 -0.07542    0.09285     0.09285  -0.812  0.41663    </span></span>
<span><span class="co">#&gt; s(depth)1           0.86857    3.91831     3.91831   0.222  0.82458    </span></span>
<span><span class="co">#&gt; s(depth)2           9.95179    3.61327     3.61327   2.754  0.00589 ** </span></span>
<span><span class="co">#&gt; s(depth)3           4.65379    3.73616     3.73616   1.246  0.21294    </span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; (Dispersion parameter for quasipoisson family taken to be 9.249465)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     Null deviance: 26054  on 9231  degrees of freedom</span></span>
<span><span class="co">#&gt; Residual deviance: 19372  on 9224  degrees of freedom</span></span>
<span><span class="co">#&gt; AIC:  NA</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Max Panel Size = 1 (independence assumed); Number of panels = 9232</span></span>
<span><span class="co">#&gt; Number of Fisher Scoring iterations: 7</span></span></code></pre></div>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># How many knots were chosen for depth?</span></span>
<span><span class="va">salsa1dOutput</span><span class="op">$</span><span class="va">splineParams</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">knots</span></span>
<span><span class="co">#&gt; NULL</span></span>
<span><span class="co"># ~~~~~~~~~~~~~~~~~~~~~~~</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="selection-of-flexibility-for-2d-smooth-term">Selection of flexibility for 2D smooth term<a class="anchor" aria-label="anchor" href="#selection-of-flexibility-for-2d-smooth-term"></a>
</h2>
<ol start="9" style="list-style-type: decimal">
<li>Create a grid of knots that will be used as possible knot locations.
This may take while and could be different every time you run it so I
suggest saving the knotgrid as a file.</li>
</ol>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">knotgrid</span><span class="op">&lt;-</span> <span class="fu"><a href="../../reference/getKnotgrid.html">getKnotgrid</a></span><span class="op">(</span>coordData <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">count.data</span><span class="op">$</span><span class="va">x.pos</span>, <span class="va">count.data</span><span class="op">$</span><span class="va">y.pos</span><span class="op">)</span>, </span>
<span>                       numKnots <span class="op">=</span> <span class="fl">300</span>,</span>
<span>                       plot <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#</span></span>
<span><span class="co"># write.csv(knotgrid, file='knotgrid_fullanalysis.csv', row.names=F)</span></span>
<span><span class="co"># ~~~~~~~~~~~~~~~~~~~~~~~</span></span></code></pre></div>
<ol start="10" style="list-style-type: decimal">
<li>Set up parameters for SALSA2D. Distance matrices (data to knots and
knot to knots), a fit statistic and min, max and start knots.</li>
</ol>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># make distance matrices for datatoknots and knottoknots</span></span>
<span><span class="va">distMats</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/makeDists.html">makeDists</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">count.data</span><span class="op">$</span><span class="va">x.pos</span>, <span class="va">count.data</span><span class="op">$</span><span class="va">y.pos</span><span class="op">)</span>, <span class="va">knotgrid</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># ~~~~~~~~~~~~~~~~~~~~~~~</span></span>
<span></span>
<span><span class="co"># make parameter set for running salsa2d</span></span>
<span><span class="va">salsa2dlist</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>fitnessMeasure <span class="op">=</span> <span class="st">'QBIC'</span>, </span>
<span>                  knotgrid <span class="op">=</span> <span class="va">knotgrid</span>,</span>
<span>                  startKnots<span class="op">=</span><span class="fl">10</span>, </span>
<span>                  minKnots<span class="op">=</span><span class="fl">4</span>, </span>
<span>                  maxKnots<span class="op">=</span><span class="fl">15</span>, </span>
<span>                  gap<span class="op">=</span><span class="fl">0</span>, </span>
<span>                  interactionTerm<span class="op">=</span><span class="st">"as.factor(impact)"</span><span class="op">)</span></span></code></pre></div>
<ol start="11" style="list-style-type: decimal">
<li>Run SALSA2D to find the appropriate number and location of knots for
the 2D smooth term of <code>x.pos</code> and <code>y.pos</code>. The
model inputted to the SALSA algorithm is the model output from the 1D
SALSA run. If you have no univariate smooth terms, you can put in the
initial model in this step.</li>
</ol>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">salsa2dOutput</span><span class="op">&lt;-</span><span class="fu"><a href="../../reference/runSALSA2D.html">runSALSA2D</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">salsa1dOutput</span><span class="op">$</span><span class="va">bestModel</span>, </span>
<span>                          salsa2dlist <span class="op">=</span> <span class="va">salsa2dlist</span>, </span>
<span>                          d2k<span class="op">=</span><span class="va">distMats</span><span class="op">$</span><span class="va">dataDist</span>,</span>
<span>                          k2k<span class="op">=</span><span class="va">distMats</span><span class="op">$</span><span class="va">knotDist</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">count.data</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">x.pos</span>, y<span class="op">=</span><span class="va">y.pos</span><span class="op">)</span>, colour<span class="op">=</span><span class="st">'grey'</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">knotgrid</span><span class="op">)</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">X1</span>, <span class="va">X2</span><span class="op">)</span>, col<span class="op">=</span><span class="st">'blue'</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">knotgrid</span><span class="op">)</span><span class="op">[</span><span class="va">salsa2dOutput</span><span class="op">$</span><span class="va">aR</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>,<span class="op">]</span>, </span>
<span>             <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">X1</span>, <span class="va">X2</span><span class="op">)</span>, col<span class="op">=</span><span class="st">'darkgreen'</span>, size<span class="op">=</span><span class="fl">4</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html" class="external-link">coord_equal</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="RenewablesCaseStudy_MRSea_v1.3_files/figure-html/unnamed-chunk-18-1.png" width="700"></p>
<ol start="12" style="list-style-type: decimal">
<li>Are the residuals correlated? Make a suitable blocking structure,
within which residuals are expected to be correlated but between which
they are independent. Use <code>runACF</code> to assess the blocking
structure.</li>
</ol>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../../reference/runACF.html">runACF</a></span><span class="op">(</span>block <span class="op">=</span> <span class="va">count.data</span><span class="op">$</span><span class="va">blockid</span>, model <span class="op">=</span> <span class="va">salsa2dOutput</span><span class="op">$</span><span class="va">bestModel</span>,</span>
<span>       suppress.printout<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="RenewablesCaseStudy_MRSea_v1.3_files/figure-html/acfplot-1.png" alt="ACF plot showing correlation in each block (grey lines), and the mean correlation by lag across blocks (red line)." width="700"><p class="caption">
ACF plot showing correlation in each block (grey lines), and the mean
correlation by lag across blocks (red line).
</p>
</div>
<p>Here we also do a runs test to assess for correlation in the model
residuals. Since our data are over-dispersed, we must use the empirical
distribution for assessment:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">simData</span><span class="op">&lt;-</span><span class="fu"><a href="../../reference/generateNoise.html">generateNoise</a></span><span class="op">(</span>n<span class="op">=</span><span class="fl">500</span>, response<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/fitted.values.html" class="external-link">fitted</a></span><span class="op">(</span><span class="va">salsa2dOutput</span><span class="op">$</span><span class="va">bestModel</span><span class="op">)</span>, family<span class="op">=</span><span class="st">'poisson'</span>, d<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">salsa2dOutput</span><span class="op">$</span><span class="va">bestModel</span><span class="op">)</span><span class="op">$</span><span class="va">dispersion</span><span class="op">)</span></span>
<span><span class="va">empdist</span><span class="op">&lt;-</span><span class="fu"><a href="../../reference/getEmpDistribution.html">getEmpDistribution</a></span><span class="op">(</span><span class="fl">500</span>, <span class="va">simData</span>, <span class="va">salsa2dOutput</span><span class="op">$</span><span class="va">bestModel</span>, data<span class="op">=</span><span class="va">count.data</span>,dots<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../../reference/runsTest.html">runsTest</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/residuals.html" class="external-link">residuals</a></span><span class="op">(</span><span class="va">salsa2dOutput</span><span class="op">$</span><span class="va">bestModel</span>, type<span class="op">=</span><span class="st">'pearson'</span><span class="op">)</span>,emp.distribution<span class="op">=</span><span class="va">empdist</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Runs Test - Two sided; Empirical Distribution</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; data:  residuals(salsa2dOutput$bestModel, type = "pearson")</span></span>
<span><span class="co">#&gt; Standardized Runs Statistic = -67.57, p-value &lt; 2.2e-16</span></span></code></pre></div>
<ol start="13" style="list-style-type: decimal">
<li>Model selection</li>
</ol>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="co"># 2D model</span></span>
<span><span class="fu"><a href="../../reference/cv.gamMRSea.html">cv.gamMRSea</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">count.data</span>, modelobject <span class="op">=</span> <span class="va">salsa2dOutput</span><span class="op">$</span><span class="va">bestModel</span>, K<span class="op">=</span><span class="fl">10</span><span class="op">)</span><span class="op">$</span><span class="va">delta</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span>
<span><span class="co">#&gt; [1] 5.734568</span></span>
<span><span class="co"># salsa2dOutput$fitStat # alternatively</span></span>
<span></span>
<span><span class="co"># 1D model</span></span>
<span><span class="fu"><a href="../../reference/cv.gamMRSea.html">cv.gamMRSea</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">count.data</span>, modelobject <span class="op">=</span> <span class="va">salsa1dOutput</span><span class="op">$</span><span class="va">bestModel</span>, K<span class="op">=</span><span class="fl">10</span><span class="op">)</span><span class="op">$</span><span class="va">delta</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span>
<span><span class="co">#&gt; [1] 6.11639</span></span>
<span></span>
<span><span class="co"># intitial model</span></span>
<span><span class="fu"><a href="../../reference/cv.gamMRSea.html">cv.gamMRSea</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">count.data</span>, modelobject <span class="op">=</span> <span class="va">initialModel</span>, K<span class="op">=</span><span class="fl">10</span><span class="op">)</span><span class="op">$</span><span class="va">delta</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span>
<span><span class="co">#&gt; [1] 6.443183</span></span></code></pre></div>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/anova.html" class="external-link">anova</a></span><span class="op">(</span><span class="va">salsa2dOutput</span><span class="op">$</span><span class="va">bestModel</span><span class="op">)</span></span>
<span><span class="co">#&gt; Analysis of 'Wald statistic' Table</span></span>
<span><span class="co">#&gt; Model: quasipoisson, link: log</span></span>
<span><span class="co">#&gt; Response: response</span></span>
<span><span class="co">#&gt; Marginal Testing</span></span>
<span><span class="co">#&gt; Max Panel Size = 1 (independence assumed); Number of panels = 9232</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;                                   Df     X2 P(&gt;|Chi|)    </span></span>
<span><span class="co">#&gt; as.factor(season)                  3 199.57 &lt; 2.2e-16 ***</span></span>
<span><span class="co">#&gt; as.factor(impact)                  1  11.42 0.0007276 ***</span></span>
<span><span class="co">#&gt; s(depth)                           3 326.63 &lt; 2.2e-16 ***</span></span>
<span><span class="co">#&gt; s(x.pos, y.pos)                    4 160.93 &lt; 2.2e-16 ***</span></span>
<span><span class="co">#&gt; s(x.pos, y.pos):as.factor(impact)  4  34.43 6.094e-07 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span></code></pre></div>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../../reference/runPartialPlots.html">runPartialPlots</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">salsa2dOutput</span><span class="op">$</span><span class="va">bestModel</span>, data <span class="op">=</span> <span class="va">count.data</span>, </span>
<span>                factorlist.in <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'season'</span>, <span class="st">'impact'</span><span class="op">)</span>, </span>
<span>                varlist.in <span class="op">=</span> <span class="st">'depth'</span>, showKnots <span class="op">=</span> <span class="cn">T</span>, </span>
<span>                includeB0 <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Making partial plots"</span></span></code></pre></div>
<p><img src="RenewablesCaseStudy_MRSea_v1.3_files/figure-html/unnamed-chunk-23-1.png" width="576" style="display: block; margin: auto;"><img src="RenewablesCaseStudy_MRSea_v1.3_files/figure-html/unnamed-chunk-23-2.png" width="576" style="display: block; margin: auto;"><img src="RenewablesCaseStudy_MRSea_v1.3_files/figure-html/unnamed-chunk-23-3.png" width="576" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../../reference/runPartialPlots.html">runPartialPlots</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">salsa2dOutput</span><span class="op">$</span><span class="va">bestModel</span>, data <span class="op">=</span> <span class="va">count.data</span>, </span>
<span>                factorlist <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'season'</span>, <span class="st">'impact'</span><span class="op">)</span>, varlist <span class="op">=</span> <span class="st">'depth'</span>, </span>
<span>                showKnots <span class="op">=</span> <span class="cn">T</span>, type<span class="op">=</span><span class="st">'link'</span>, </span>
<span>                includeB0 <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Making partial plots"</span></span></code></pre></div>
<p><img src="RenewablesCaseStudy_MRSea_v1.3_files/figure-html/unnamed-chunk-24-1.png" width="576" style="display: block; margin: auto;"><img src="RenewablesCaseStudy_MRSea_v1.3_files/figure-html/unnamed-chunk-24-2.png" width="576" style="display: block; margin: auto;"><img src="RenewablesCaseStudy_MRSea_v1.3_files/figure-html/unnamed-chunk-24-3.png" width="576" style="display: block; margin: auto;"></p>
</div>
<div class="section level2">
<h2 id="making-predictions">Making Predictions<a class="anchor" aria-label="anchor" href="#making-predictions"></a>
</h2>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">preddist</span><span class="op">&lt;-</span><span class="fu"><a href="../../reference/makeDists.html">makeDists</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">predictData</span><span class="op">$</span><span class="va">x.pos</span>, <span class="va">predictData</span><span class="op">$</span><span class="va">y.pos</span><span class="op">)</span>, </span>
<span>                 <span class="va">knotgrid</span>, knotmat<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span><span class="op">$</span><span class="va">dataDist</span></span>
<span></span>
<span></span>
<span><span class="co"># make predictions on response scale</span></span>
<span><span class="va">preds</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span>newdata <span class="op">=</span> <span class="va">predictData</span>, </span>
<span>               g2k <span class="op">=</span> <span class="va">preddist</span>, </span>
<span>               object <span class="op">=</span> <span class="va">salsa2dOutput</span><span class="op">$</span><span class="va">bestModel</span><span class="op">)</span></span></code></pre></div>
<p>Plotting the predictions pre and post impact:</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="va">RColorBrewer</span><span class="op">)</span></span>
<span><span class="va">imp.labs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Pre-Construction"</span>, <span class="st">"Post-Construction"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">imp.labs</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"0"</span>, <span class="st">"1"</span><span class="op">)</span></span>
<span><span class="va">predictData</span><span class="op">$</span><span class="va">preds</span><span class="op">&lt;-</span><span class="va">preds</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span></span></code></pre></div>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_tile</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">predictData</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">x.pos</span>, <span class="va">y.pos</span>, fill<span class="op">=</span><span class="va">preds</span><span class="op">)</span>, height<span class="op">=</span><span class="fl">0.5</span>, width<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html" class="external-link">facet_grid</a></span><span class="op">(</span><span class="va">season</span><span class="op">~</span><span class="va">impact</span> , labeller <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labeller.html" class="external-link">labeller</a></span><span class="op">(</span>impact<span class="op">=</span><span class="va">imp.labs</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html" class="external-link">coord_equal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html" class="external-link">scale_fill_distiller</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Spectral"</span>,name<span class="op">=</span><span class="st">"Animal Counts"</span><span class="op">)</span></span></code></pre></div>
<p><img src="RenewablesCaseStudy_MRSea_v1.3_files/figure-html/unnamed-chunk-27-1.png" width="768" style="display: block; margin: auto;"></p>
</div>
<div class="section level2">
<h2 id="bootstrapped-confidence-intervals-and-difference-surfaces">Bootstrapped Confidence Intervals and Difference Surfaces<a class="anchor" aria-label="anchor" href="#bootstrapped-confidence-intervals-and-difference-surfaces"></a>
</h2>
<p>Note that the coding in this section has changed slightly from the
original user guide.</p>
<ol start="14" style="list-style-type: decimal">
<li>Bootstrap to include parameter estimation uncertainty in the
detection function and parameter estimation in the spatial model. (Note:
If no detection function estimated, then the bootstrap is just on the
parameters of the spatial model.)</li>
</ol>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dis.data</span><span class="op">$</span><span class="va">seasonimpact</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="va">dis.data</span><span class="op">$</span><span class="va">season</span>, <span class="va">dis.data</span><span class="op">$</span><span class="va">impact</span><span class="op">)</span></span>
<span></span>
<span><span class="va">bootPreds</span><span class="op">&lt;-</span><span class="fu"><a href="../../reference/do.bootstrap.cress.robust.html">do.bootstrap.cress.robust</a></span><span class="op">(</span>model.obj <span class="op">=</span> <span class="va">salsa2dOutput</span><span class="op">$</span><span class="va">bestModel</span>, </span>
<span>                                     predictionGrid <span class="op">=</span> <span class="va">predictData</span>,</span>
<span>                                     g2k<span class="op">=</span><span class="va">preddist</span>,</span>
<span>                                     B <span class="op">=</span> <span class="fl">100</span>, </span>
<span>                                     robust<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#load('predictionboot.RData')</span></span>
<span><span class="va">cis</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/makeBootCIs.html">makeBootCIs</a></span><span class="op">(</span><span class="va">bootPreds</span><span class="op">)</span></span></code></pre></div>
<ol start="15" style="list-style-type: decimal">
<li>Calculate the differences before and after across all
bootstraps</li>
</ol>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">differences</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/getDifferences.html">getDifferences</a></span><span class="op">(</span>beforePreds <span class="op">=</span> </span>
<span>                      <span class="va">bootPreds</span><span class="op">[</span><span class="va">predictData</span><span class="op">$</span><span class="va">impact</span> <span class="op">==</span> <span class="fl">0</span>, <span class="op">]</span>,</span>
<span>                      afterPreds <span class="op">=</span> <span class="va">bootPreds</span><span class="op">[</span><span class="va">predictData</span><span class="op">$</span><span class="va">impact</span> <span class="op">==</span> <span class="fl">1</span>, <span class="op">]</span><span class="op">)</span></span></code></pre></div>
<ol start="16" style="list-style-type: decimal">
<li>Plot differences and indicate where significant positive/negative
differences lie. The grey circles indicate a significant negative
difference (abundance after impact is less than the abundance before
impact) and the grey crosses indicate a significant positive difference.
The colour of the cell indicates the size of the difference.</li>
</ol>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mediandiff</span> <span class="op">&lt;-</span> <span class="va">differences</span><span class="op">$</span><span class="va">mediandiff</span></span>
<span><span class="co"># The marker for each after - before difference:</span></span>
<span><span class="co"># positive ('1') and negative ('-') significant differences</span></span>
<span><span class="va">marker</span> <span class="op">&lt;-</span> <span class="va">differences</span><span class="op">$</span><span class="va">significanceMarker</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">quilt.plot</span><span class="op">(</span><span class="va">predictData</span><span class="op">$</span><span class="va">x.pos</span><span class="op">[</span><span class="va">predictData</span><span class="op">$</span><span class="va">impact</span> <span class="op">==</span> <span class="fl">0</span><span class="op">]</span>, </span>
<span>           <span class="va">predictData</span><span class="op">$</span><span class="va">y.pos</span><span class="op">[</span><span class="va">predictData</span><span class="op">$</span><span class="va">impact</span> <span class="op">==</span> <span class="fl">0</span><span class="op">]</span>,</span>
<span>           <span class="va">mediandiff</span>, asp <span class="op">=</span> <span class="fl">1</span>, nrow <span class="op">=</span> <span class="fl">104</span>, ncol <span class="op">=</span> <span class="fl">55</span><span class="op">)</span></span>
<span><span class="co"># add + or - depending on significance of cells. Just</span></span>
<span><span class="co"># requires one significance out of all to be allocated</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="va">predictData</span><span class="op">$</span><span class="va">x.pos</span><span class="op">[</span><span class="va">predictData</span><span class="op">$</span><span class="va">impact</span> <span class="op">==</span> <span class="fl">0</span><span class="op">]</span><span class="op">[</span><span class="va">marker</span> <span class="op">==</span> <span class="fl">1</span><span class="op">]</span>,</span>
<span>       <span class="va">predictData</span><span class="op">$</span><span class="va">y.pos</span><span class="op">[</span><span class="va">predictData</span><span class="op">$</span><span class="va">impact</span> <span class="op">==</span> <span class="fl">0</span><span class="op">]</span><span class="op">[</span><span class="va">marker</span> <span class="op">==</span> <span class="fl">1</span><span class="op">]</span>,</span>
<span>       pch <span class="op">=</span> <span class="st">"+"</span>, col <span class="op">=</span> <span class="st">"darkgrey"</span>, cex <span class="op">=</span> <span class="fl">0.75</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="va">predictData</span><span class="op">$</span><span class="va">x.pos</span><span class="op">[</span><span class="va">predictData</span><span class="op">$</span><span class="va">impact</span> <span class="op">==</span> <span class="fl">0</span><span class="op">]</span><span class="op">[</span><span class="va">marker</span> <span class="op">==</span> <span class="op">(</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">]</span>,</span>
<span>       <span class="va">predictData</span><span class="op">$</span><span class="va">y.pos</span><span class="op">[</span><span class="va">predictData</span><span class="op">$</span><span class="va">impact</span> <span class="op">==</span> <span class="fl">0</span><span class="op">]</span><span class="op">[</span><span class="va">marker</span> <span class="op">==</span> <span class="op">(</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">]</span>,</span>
<span>       col <span class="op">=</span> <span class="st">"darkgrey"</span>, cex <span class="op">=</span> <span class="fl">0.75</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="fl">681417.3</span><span class="op">/</span><span class="fl">1000</span>, <span class="fl">6046910</span><span class="op">/</span><span class="fl">1000</span>, cex <span class="op">=</span> <span class="fl">3</span>, pch <span class="op">=</span> <span class="st">"*"</span>, lwd <span class="op">=</span> <span class="fl">1</span>, col <span class="op">=</span> <span class="st">"grey"</span><span class="op">)</span></span></code></pre></div>
<p><img src="RenewablesCaseStudy_MRSea_v1.3_files/figure-html/unnamed-chunk-30-1.png" width="864" style="display: block; margin: auto;"></p>
<p>Select a single season to plot (here I have chosen season 1):</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="va">diffdata</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">predictData</span><span class="op">[</span><span class="va">predictData</span><span class="op">$</span><span class="va">impact</span><span class="op">==</span><span class="fl">0</span>,<span class="op">]</span>, <span class="va">mediandiff</span>, <span class="va">marker</span><span class="op">)</span></span>
<span><span class="va">diffdata_s1</span><span class="op">&lt;-</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">diffdata</span>, <span class="va">season</span><span class="op">==</span><span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="va">wf</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>x<span class="op">=</span><span class="op">(</span><span class="fl">681417.3</span><span class="op">/</span><span class="fl">1000</span><span class="op">)</span>, y<span class="op">=</span> <span class="op">(</span><span class="fl">6046910</span><span class="op">/</span><span class="fl">1000</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_tile</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">diffdata_s1</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">x.pos</span>, y<span class="op">=</span><span class="va">y.pos</span>, fill<span class="op">=</span><span class="va">mediandiff</span><span class="op">)</span>, </span>
<span>                     height<span class="op">=</span><span class="fl">0.5</span>, width<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data<span class="op">=</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">diffdata_s1</span>, <span class="va">marker</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">x.pos</span>, y<span class="op">=</span><span class="va">y.pos</span><span class="op">)</span>, </span>
<span>             shape<span class="op">=</span><span class="fl">3</span>, colour<span class="op">=</span><span class="st">'darkgrey'</span>, size<span class="op">=</span><span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data<span class="op">=</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">diffdata_s1</span>, <span class="va">marker</span> <span class="op">==</span> <span class="op">-</span><span class="fl">1</span><span class="op">)</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">x.pos</span>, y<span class="op">=</span><span class="va">y.pos</span><span class="op">)</span>, </span>
<span>             shape<span class="op">=</span><span class="fl">1</span>, colour<span class="op">=</span><span class="st">'darkgrey'</span>, size<span class="op">=</span><span class="fl">1.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html" class="external-link">coord_equal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>  </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html" class="external-link">scale_fill_distiller</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Spectral"</span>,name<span class="op">=</span><span class="st">"Difference"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">wf</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span>, shape<span class="op">=</span><span class="fl">8</span>, size<span class="op">=</span><span class="fl">4</span><span class="op">)</span></span></code></pre></div>
<p><img src="RenewablesCaseStudy_MRSea_v1.3_files/figure-html/unnamed-chunk-31-1.png" width="864"></p>
<p>Or, all seasons (remember season is only in as a factor variable so
there will be no change in spatial distribution between seasons, only an
increase or decrease in numbers):</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_tile</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">diffdata</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">x.pos</span>, y<span class="op">=</span><span class="va">y.pos</span>, fill<span class="op">=</span><span class="va">mediandiff</span><span class="op">)</span>, </span>
<span>                     height<span class="op">=</span><span class="fl">0.5</span>, width<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data<span class="op">=</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">diffdata</span>, <span class="va">marker</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">x.pos</span>, y<span class="op">=</span><span class="va">y.pos</span><span class="op">)</span>, </span>
<span>             shape<span class="op">=</span><span class="fl">3</span>, colour<span class="op">=</span><span class="st">'darkgrey'</span>, size<span class="op">=</span><span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data<span class="op">=</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">diffdata</span>, <span class="va">marker</span> <span class="op">==</span> <span class="op">-</span><span class="fl">1</span><span class="op">)</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">x.pos</span>, y<span class="op">=</span><span class="va">y.pos</span><span class="op">)</span>, </span>
<span>             shape<span class="op">=</span><span class="fl">1</span>, colour<span class="op">=</span><span class="st">'darkgrey'</span>, size<span class="op">=</span><span class="fl">1.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html" class="external-link">coord_equal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">season</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html" class="external-link">scale_fill_distiller</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Spectral"</span>,name<span class="op">=</span><span class="st">"Difference"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">wf</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span>, shape<span class="op">=</span><span class="fl">8</span>, size<span class="op">=</span><span class="fl">4</span><span class="op">)</span></span></code></pre></div>
<p><img src="RenewablesCaseStudy_MRSea_v1.3_files/figure-html/unnamed-chunk-32-1.png" width="864"></p>
</div>
<div class="section level2">
<h2 id="diagnostic-functions-in-the-mrsea-package">Diagnostic functions in the MRSea package<a class="anchor" aria-label="anchor" href="#diagnostic-functions-in-the-mrsea-package"></a>
</h2>
<p>I will use the best model above to run some additional
diagnostics.</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">finalmod</span><span class="op">&lt;-</span><span class="va">salsa2dOutput</span><span class="op">$</span><span class="va">bestModel</span></span></code></pre></div>
<div class="section level3">
<h3 id="autocorrelation-check">Autocorrelation check<a class="anchor" aria-label="anchor" href="#autocorrelation-check"></a>
</h3>
<p>These are already shown above so are not re-run here but included for
completeness.</p>
<p>Autocorrelation function plot:</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../../reference/runACF.html">runACF</a></span><span class="op">(</span>block <span class="op">=</span> <span class="va">count.data</span><span class="op">$</span><span class="va">blockid</span>, model <span class="op">=</span> <span class="va">salsa2dOutput</span><span class="op">$</span><span class="va">bestModel</span>,</span>
<span>       suppress.printout<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>Empirical runs test calculation:</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">simData</span><span class="op">&lt;-</span><span class="fu"><a href="../../reference/generateNoise.html">generateNoise</a></span><span class="op">(</span>n<span class="op">=</span><span class="fl">500</span>, </span>
<span>                       response<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/fitted.values.html" class="external-link">fitted</a></span><span class="op">(</span><span class="va">salsa2dOutput</span><span class="op">$</span><span class="va">bestModel</span><span class="op">)</span>, </span>
<span>                       family<span class="op">=</span><span class="st">'poisson'</span>, </span>
<span>                       d<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">salsa2dOutput</span><span class="op">$</span><span class="va">bestModel</span><span class="op">)</span><span class="op">$</span><span class="va">dispersion</span><span class="op">)</span></span>
<span><span class="va">empdist</span><span class="op">&lt;-</span><span class="fu"><a href="../../reference/getEmpDistribution.html">getEmpDistribution</a></span><span class="op">(</span><span class="fl">500</span>, <span class="va">simData</span>, <span class="va">salsa2dOutput</span><span class="op">$</span><span class="va">bestModel</span>, data<span class="op">=</span><span class="va">count.data</span>,dots<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../../reference/runsTest.html">runsTest</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/residuals.html" class="external-link">residuals</a></span><span class="op">(</span><span class="va">salsa2dOutput</span><span class="op">$</span><span class="va">bestModel</span>, type<span class="op">=</span><span class="st">'pearson'</span><span class="op">)</span>, emp.distribution<span class="op">=</span><span class="va">empdist</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="rundiagnostics">
<code>runDiagnostics</code><a class="anchor" aria-label="anchor" href="#rundiagnostics"></a>
</h3>
<p>This function creates observed vs fitted and fitted vs scaled
pearsons residual plots.</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../../reference/runDiagnostics.html">runDiagnostics</a></span><span class="op">(</span><span class="va">finalmod</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Assessing predictive power"</span></span></code></pre></div>
<p><img src="RenewablesCaseStudy_MRSea_v1.3_files/figure-html/unnamed-chunk-37-1.png" width="864"><img src="RenewablesCaseStudy_MRSea_v1.3_files/figure-html/unnamed-chunk-37-2.png" width="864"></p>
</div>
<div class="section level3">
<h3 id="influence-diagnostics">Influence diagnostics<a class="anchor" aria-label="anchor" href="#influence-diagnostics"></a>
</h3>
<p>These functions assess the influence of different blocks on the
data.</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../../reference/timeInfluenceCheck.html">timeInfluenceCheck</a></span><span class="op">(</span><span class="va">finalmod</span>, id <span class="op">=</span> <span class="va">count.data</span><span class="op">$</span><span class="va">blockid</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Calculating the influence measures will take approximately 2 minutes"</span></span></code></pre></div>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">inflpoints</span><span class="op">&lt;-</span><span class="fu"><a href="../../reference/runInfluence.html">runInfluence</a></span><span class="op">(</span><span class="va">finalmod</span>, id <span class="op">=</span> <span class="va">count.data</span><span class="op">$</span><span class="va">blockid</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Calculating COVRATIO and PRESS Statistics"</span></span></code></pre></div>
<p><img src="RenewablesCaseStudy_MRSea_v1.3_files/figure-html/unnamed-chunk-39-1.png" width="864"><img src="RenewablesCaseStudy_MRSea_v1.3_files/figure-html/unnamed-chunk-39-2.png" width="864"></p>
</div>
<div class="section level3">
<h3 id="cumulative-residual-plots">Cumulative residual plots<a class="anchor" aria-label="anchor" href="#cumulative-residual-plots"></a>
</h3>
<p>Cumulative residual plots are returned for residuals ordered by each
covariate in <code>varlist</code>, predicted value and index of
observations (temporally). The blue dots are the residuals and the black
line is the line of cumulative residual. On the covariate plots (those
in <code>varlist</code>) the grey line indicates what we would expect
from a well fitted covariate. i.e. one that is fitted with excessive
knots.</p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../../reference/plotCumRes.html">plotCumRes</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">finalmod</span>, varlist <span class="op">=</span> <span class="st">'depth'</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Calculating cumulative residuals"</span></span></code></pre></div>
<p><img src="RenewablesCaseStudy_MRSea_v1.3_files/figure-html/unnamed-chunk-40-1.png" width="864"><img src="RenewablesCaseStudy_MRSea_v1.3_files/figure-html/unnamed-chunk-40-2.png" width="864"><img src="RenewablesCaseStudy_MRSea_v1.3_files/figure-html/unnamed-chunk-40-3.png" width="864"></p>
</div>
<div class="section level3">
<h3 id="mean-variance-check">Mean-variance check<a class="anchor" aria-label="anchor" href="#mean-variance-check"></a>
</h3>
<p>Not a function in MRSea but an essential component to model
assessment is the mean variance relationship. In the plot below, the
dots are the observed mean and variance for several bins of the fitted
data. The red line is the assumed mean-variance relationship.</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cutpts</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/fitted.values.html" class="external-link">fitted</a></span><span class="op">(</span><span class="va">finalmod</span><span class="op">)</span>, prob<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span>, by<span class="op">=</span><span class="fl">0.05</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">mycuts</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/cut.html" class="external-link">cut</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/fitted.values.html" class="external-link">fitted</a></span><span class="op">(</span><span class="va">finalmod</span><span class="op">)</span>, breaks<span class="op">=</span> <span class="va">cutpts</span><span class="op">)</span></span>
<span><span class="va">meanfits</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/tapply.html" class="external-link">tapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/fitted.values.html" class="external-link">fitted</a></span><span class="op">(</span><span class="va">finalmod</span><span class="op">)</span>, <span class="va">mycuts</span>, <span class="va">mean</span><span class="op">)</span></span>
<span><span class="va">varresid</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/tapply.html" class="external-link">tapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/residuals.html" class="external-link">residuals</a></span><span class="op">(</span><span class="va">finalmod</span>, type<span class="op">=</span><span class="st">'response'</span><span class="op">)</span>, <span class="va">mycuts</span>, <span class="va">var</span><span class="op">)</span></span>
<span>  </span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">meanfits</span>, <span class="va">varresid</span>, xlab<span class="op">=</span><span class="st">'Fitted Values'</span>, ylab<span class="op">=</span><span class="st">'V(residuals)'</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">meanfits</span>, <span class="va">meanfits</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">finalmod</span><span class="op">)</span><span class="op">$</span><span class="va">dispersion</span>, col<span class="op">=</span><span class="st">'red'</span><span class="op">)</span></span></code></pre></div>
<p><img src="RenewablesCaseStudy_MRSea_v1.3_files/figure-html/unnamed-chunk-41-1.png" width="700"></p>
</div>
</div>
<div class="section level2">
<h2 id="other-useful-functions-in-the-mrsea-package">Other useful functions in the MRSea package<a class="anchor" aria-label="anchor" href="#other-useful-functions-in-the-mrsea-package"></a>
</h2>
<div class="section level3">
<h3 id="making-any-glm-model-into-an-gammrsea-object">Making any <code>glm</code> model into an <code>gamMRSea</code>
object<a class="anchor" aria-label="anchor" href="#making-any-glm-model-into-an-gammrsea-object"></a>
</h3>
<p>This can be done using the <code>make.gamMRSea</code> function. Here
we use the <code>fullmodel</code> which is a <code>glm</code> model with
<code>family='poisson'</code></p>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fullModel</span><span class="op">$</span><span class="va">call</span></span>
<span><span class="co">#&gt; glm(formula = response ~ as.factor(season) + as.factor(impact) + </span></span>
<span><span class="co">#&gt;     bs(depth, knots = mean(depth)) + x.pos + y.pos, family = poisson, </span></span>
<span><span class="co">#&gt;     data = count.data)</span></span></code></pre></div>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fullModel.gamMRSea</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/make.gamMRSea.html">make.gamMRSea</a></span><span class="op">(</span><span class="va">fullModel</span>,  </span>
<span>                                    gamMRSea <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>                                    </span></code></pre></div>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fullModel.gamMRSea</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; gamMRSea(formula = response ~ as.factor(season) + as.factor(impact) + </span></span>
<span><span class="co">#&gt;     bs(depth, knots = mean(depth)) + x.pos + y.pos, family = poisson, </span></span>
<span><span class="co">#&gt;     data = count.data, splineParams = splineParams)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Deviance Residuals: </span></span>
<span><span class="co">#&gt;     Min       1Q   Median       3Q      Max  </span></span>
<span><span class="co">#&gt; -4.1480  -0.9190  -0.3740  -0.0923  19.3475  </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients:</span></span>
<span><span class="co">#&gt;                                   Estimate Std. Error Robust S.E. z value</span></span>
<span><span class="co">#&gt; (Intercept)                      1.212e+03  3.636e+01   3.636e+01  33.337</span></span>
<span><span class="co">#&gt; as.factor(season)2              -1.239e+00  4.568e-02   4.568e-02 -27.117</span></span>
<span><span class="co">#&gt; as.factor(season)3              -1.202e+00  4.504e-02   4.504e-02 -26.691</span></span>
<span><span class="co">#&gt; as.factor(season)4              -8.562e-01  3.966e-02   3.966e-02 -21.592</span></span>
<span><span class="co">#&gt; as.factor(impact)1              -7.542e-02  3.053e-02   3.053e-02  -2.470</span></span>
<span><span class="co">#&gt; bs(depth, knots = mean(depth))1 -4.505e+00  2.150e+00   2.150e+00  -2.095</span></span>
<span><span class="co">#&gt; bs(depth, knots = mean(depth))2  6.498e+00  1.681e+00   1.681e+00   3.865</span></span>
<span><span class="co">#&gt; bs(depth, knots = mean(depth))3  7.989e+00  1.847e+00   1.847e+00   4.325</span></span>
<span><span class="co">#&gt; bs(depth, knots = mean(depth))4  6.011e+00  1.787e+00   1.787e+00   3.363</span></span>
<span><span class="co">#&gt; x.pos                            1.554e-02  1.571e-03   1.571e-03   9.892</span></span>
<span><span class="co">#&gt; y.pos                           -2.031e-01  5.993e-03   5.993e-03 -33.892</span></span>
<span><span class="co">#&gt;                                 Pr(&gt;|z|)    </span></span>
<span><span class="co">#&gt; (Intercept)                      &lt; 2e-16 ***</span></span>
<span><span class="co">#&gt; as.factor(season)2               &lt; 2e-16 ***</span></span>
<span><span class="co">#&gt; as.factor(season)3               &lt; 2e-16 ***</span></span>
<span><span class="co">#&gt; as.factor(season)4               &lt; 2e-16 ***</span></span>
<span><span class="co">#&gt; as.factor(impact)1              0.013494 *  </span></span>
<span><span class="co">#&gt; bs(depth, knots = mean(depth))1 0.036187 *  </span></span>
<span><span class="co">#&gt; bs(depth, knots = mean(depth))2 0.000111 ***</span></span>
<span><span class="co">#&gt; bs(depth, knots = mean(depth))3 1.52e-05 ***</span></span>
<span><span class="co">#&gt; bs(depth, knots = mean(depth))4 0.000770 ***</span></span>
<span><span class="co">#&gt; x.pos                            &lt; 2e-16 ***</span></span>
<span><span class="co">#&gt; y.pos                            &lt; 2e-16 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; (Dispersion parameter for poisson family taken to be 1)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     Null deviance: 26118  on 9231  degrees of freedom</span></span>
<span><span class="co">#&gt; Residual deviance: 17592  on 9221  degrees of freedom</span></span>
<span><span class="co">#&gt; AIC:  19844</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Max Panel Size = 1 (independence assumed); Number of panels = 9232</span></span>
<span><span class="co">#&gt; Number of Fisher Scoring iterations: 8</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="adding-a-panel-structure-to-a-model">Adding a panel structure to a model<a class="anchor" aria-label="anchor" href="#adding-a-panel-structure-to-a-model"></a>
</h3>
<p>Additionally, if you choose to fit the SALSA or GLM models without a
panel structure, the <code>make.gamMRSea</code> function can be used to
add a panel structure afterwards.</p>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">finalmod.robustse</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/make.gamMRSea.html">make.gamMRSea</a></span><span class="op">(</span><span class="va">finalmod</span>,  </span>
<span>                                    gamMRSea <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                                    panelid <span class="op">=</span> <span class="va">count.data</span><span class="op">$</span><span class="va">blockid</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">finalmod.robustse</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; gamMRSea(formula = response ~ as.factor(season) + as.factor(impact) + </span></span>
<span><span class="co">#&gt;     bs(depth, knots = splineParams[[2]]$knots, degree = splineParams[[2]]$degree, </span></span>
<span><span class="co">#&gt;         Boundary.knots = splineParams[[2]]$bd) + LRF.g(radiusIndices, </span></span>
<span><span class="co">#&gt;     dists, radii, aR) + as.factor(impact):LRF.g(radiusIndices, </span></span>
<span><span class="co">#&gt;     dists, radii, aR) + offset(log(area)), family = quasipoisson(link = log), </span></span>
<span><span class="co">#&gt;     data = count.data, splineParams = splineParams)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Deviance Residuals: </span></span>
<span><span class="co">#&gt;     Min       1Q   Median       3Q      Max  </span></span>
<span><span class="co">#&gt; -6.3376  -0.8712  -0.3043  -0.0740  17.3870  </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients:</span></span>
<span><span class="co">#&gt;                                      Estimate Std. Error Robust S.E. t value</span></span>
<span><span class="co">#&gt; (Intercept)                           -2.7573     2.1741      1.4517  -1.899</span></span>
<span><span class="co">#&gt; as.factor(season)2                    -1.2388     0.1164      0.1458  -8.494</span></span>
<span><span class="co">#&gt; as.factor(season)3                    -1.2023     0.1148      0.1795  -6.698</span></span>
<span><span class="co">#&gt; as.factor(season)4                    -0.8562     0.1010      0.1409  -6.077</span></span>
<span><span class="co">#&gt; as.factor(impact)1                    -1.1990     0.3548      0.4993  -2.401</span></span>
<span><span class="co">#&gt; s(depth)1                             -4.9351     2.3752      1.7610  -2.802</span></span>
<span><span class="co">#&gt; s(depth)2                              6.1591     2.1412      1.2427   4.956</span></span>
<span><span class="co">#&gt; s(depth)3                              3.3670     2.2280      1.6001   2.104</span></span>
<span><span class="co">#&gt; s(x.pos, y.pos)b1                     22.2769     2.5685      3.5175   6.333</span></span>
<span><span class="co">#&gt; s(x.pos, y.pos)b2                     -3.0978     0.8160      1.0037  -3.086</span></span>
<span><span class="co">#&gt; s(x.pos, y.pos)b3                    -23.6421     2.7692      3.7425  -6.317</span></span>
<span><span class="co">#&gt; s(x.pos, y.pos)b4                      4.0162     0.3829      0.3920  10.245</span></span>
<span><span class="co">#&gt; as.factor(impact)1:s(x.pos, y.pos)b1  -1.5312     3.1923      3.9253  -0.390</span></span>
<span><span class="co">#&gt; as.factor(impact)1:s(x.pos, y.pos)b2   0.9768     1.0946      1.3636   0.716</span></span>
<span><span class="co">#&gt; as.factor(impact)1:s(x.pos, y.pos)b3   3.1379     3.3474      4.0246   0.780</span></span>
<span><span class="co">#&gt; as.factor(impact)1:s(x.pos, y.pos)b4   1.6753     0.4845      0.6508   2.574</span></span>
<span><span class="co">#&gt;                                      Pr(&gt;|t|)    </span></span>
<span><span class="co">#&gt; (Intercept)                           0.05755 .  </span></span>
<span><span class="co">#&gt; as.factor(season)2                    &lt; 2e-16 ***</span></span>
<span><span class="co">#&gt; as.factor(season)3                   2.23e-11 ***</span></span>
<span><span class="co">#&gt; as.factor(season)4                   1.27e-09 ***</span></span>
<span><span class="co">#&gt; as.factor(impact)1                    0.01635 *  </span></span>
<span><span class="co">#&gt; s(depth)1                             0.00508 ** </span></span>
<span><span class="co">#&gt; s(depth)2                            7.31e-07 ***</span></span>
<span><span class="co">#&gt; s(depth)3                             0.03539 *  </span></span>
<span><span class="co">#&gt; s(x.pos, y.pos)b1                    2.51e-10 ***</span></span>
<span><span class="co">#&gt; s(x.pos, y.pos)b2                     0.00203 ** </span></span>
<span><span class="co">#&gt; s(x.pos, y.pos)b3                    2.79e-10 ***</span></span>
<span><span class="co">#&gt; s(x.pos, y.pos)b4                     &lt; 2e-16 ***</span></span>
<span><span class="co">#&gt; as.factor(impact)1:s(x.pos, y.pos)b1  0.69648    </span></span>
<span><span class="co">#&gt; as.factor(impact)1:s(x.pos, y.pos)b2  0.47381    </span></span>
<span><span class="co">#&gt; as.factor(impact)1:s(x.pos, y.pos)b3  0.43560    </span></span>
<span><span class="co">#&gt; as.factor(impact)1:s(x.pos, y.pos)b4  0.01006 *  </span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; (Dispersion parameter for quasipoisson family taken to be 6.491257)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     Null deviance: 26054  on 9231  degrees of freedom</span></span>
<span><span class="co">#&gt; Residual deviance: 16308  on 9216  degrees of freedom</span></span>
<span><span class="co">#&gt; AIC:  NA</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Max Panel Size = 54; Number of panels = 208</span></span>
<span><span class="co">#&gt; Number of Fisher Scoring iterations: 7</span></span></code></pre></div>
<!-- ```{r, eval=FALSE, echo=FALSE, include=FALSE} -->
<!-- save.image(file='mrseavignetteworkspace.RData', compress="bzip2") -->
<!-- ``` -->
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-Mac2013" class="csl-entry">
Mackenzie, M. L, L. A. S. Scott-Hayward, C. S., Oedekoven, H., Skov, E.,
Humphreys, and E. Rexstad. 2013. <span>“Statistical Modelling of Seabird
and Cetacean Data: Guidance Document. University of St. Andrews Contract
for Marine Scotland; SB9 (CR/2012/05).”</span> University of St Andrews.
</div>
<div id="ref-ScottH2013" class="csl-entry">
Scott-Hayward, L. A. S., M. L. Mackenzie, C. R. Donovan, C. G. Walker,
and E. Ashe. 2013. <span>“Complex Region Spatial Smoother
(CReSS).”</span> <em>Journal of Computational and Graphical
Statistics</em>. <a href="https://doi.org/10.1080/10618600.2012.762920" class="external-link">https://doi.org/10.1080/10618600.2012.762920</a>.
</div>
<div id="ref-ScottH2022" class="csl-entry">
Scott-Hayward, L. A. S., M. L. Mackenzie, C. G. Walker, G. Shatumbu, W.
Kilian, and P. du Preez. 2022. <span>“Automated Surface Feature
Selection Using SALSA2D: An Illustration Using Elephant Mortality Data
in Etosha National Park.”</span> <em>arXiv e-Prints</em>,
arXiv:2202.07977. <a href="https://doi.org/10.48550/arXiv.2202.07977" class="external-link">https://doi.org/10.48550/arXiv.2202.07977</a>.
</div>
<div id="ref-ScottH2013a" class="csl-entry">
Scott-Hayward, L. A. S., C. S. Oedekoven, M. L. Mackenzie, C. G. Walker,
and E. Rexstad. 2013. <span>“User Guide for the MRSea Package V0.1.2:
Statistical Modelling of Bird and Cetacean Distributions in Offshore
Renewables Development Areas. University of St. Andrews Contract for
Marine Scotland; SB9 (CR/2012/05).”</span> University of St Andrews.
</div>
<div id="ref-Walker2010" class="csl-entry">
Walker, C. G., M. L. Mackenzie, C. R. Donovan, and M. J. O’Sullivan.
2010. <span>“SALSA - a Spatially Adaptive Local Smoothing
Algorithm.”</span> <em>Journal of Statistical Computation and
Simulation</em> 81 (2): 179–91.
</div>
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Lindesay Scott-Hayward, Cameron Walker, Monique Mackenzie.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
