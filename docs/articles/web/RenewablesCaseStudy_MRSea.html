<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="MRSea">
<title>Example Baseline Characterisation Analysis for an Offshore Renewables Development Area • MRSea</title>
<script src="../../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../../pkgdown.js"></script><meta property="og:title" content="Example Baseline Characterisation Analysis for an Offshore Renewables Development Area">
<meta property="og:description" content="MRSea">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../../index.html">MRSea</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.5</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../../articles/web/IntroductiontoMRSea.html">Introduction to the package</a>
    <h6 class="dropdown-header" data-toc-skip>Basic examples</h6>
    <a class="dropdown-item" href="../../articles/GettingStarted_1Dsmoothing.html">One-dimensional smooths</a>
    <a class="dropdown-item" href="../../articles/GettingStarted_2Dsmoothing.html">Two-dimensional smooths</a>
    <div class="dropdown-divider"></div>
    <a class="dropdown-item" href="../../articles/web/FittingDifferentSplines_MRSea.html">Using Different Splines</a>
    <a class="dropdown-item" href="../../articles/web/Interactions_salsa2d_MRSea.html">Interactions for 2D smooths</a>
    <a class="dropdown-item" href="../../articles/web/ModelDiagnostics_MRSea.html">Model Diagnostics</a>
    <a class="dropdown-item" href="../../articles/web/TheTweedieDistribution_MRSea.html">Using the Tweedie Distribution</a>
    <div class="dropdown-divider"></div>
    <a class="dropdown-item" href="../../articles/web/Publications.html">Publications</a>
    <div class="dropdown-divider"></div>
    <a class="dropdown-item" href="../../articles/web/DistanceSampling.html">Brief Intro to Distance Sampling</a>
    <a class="dropdown-item" href="../../articles/web/RenewablesCaseStudy_MRSea.html">Renewables Case Study</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>More advanced Usage</h6>
    <a class="dropdown-item" href="../../articles/web/Geodesic_2dsmoothing_MRSea.html">Geodesic smoothing</a>
    <a class="dropdown-item" href="../../articles/web/UserRadiiChoice_MRSea.html">Basis radii selection</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/lindesaysh/MRSea/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Example Baseline Characterisation Analysis for an Offshore Renewables Development Area</h1>
                        <h4 data-toc-skip class="author">LAS
Scott-Hayward and ML Mackenzie</h4>
            
            <h4 data-toc-skip class="date">2023-12-12</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/lindesaysh/MRSea/blob/HEAD/vignettes/web/RenewablesCaseStudy_MRSea.Rmd" class="external-link"><code>vignettes/web/RenewablesCaseStudy_MRSea.Rmd</code></a></small>
      <div class="d-none name"><code>RenewablesCaseStudy_MRSea.Rmd</code></div>
    </div>

    
    
<!-- **Please reference this document as:** -->
<!-- Scott-Hayward, L.A.S., Mackenzie, M.L. and Walker, C.G. (2021). Vignette for the MRSea Package v1.3: Statistical Modelling of bird and cetacean distributions in offshore renewables development areas. Centre for Research into Ecological and Environmental Modelling, University of St Andrews. -->
<hr>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://creem2.st-and.ac.uk/software.aspx" class="external-link">MRSea</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">count.data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="st">"data/nystedphaseA.rds"</span><span class="op">)</span></span></code></pre></div>
<p>The data are visual aerial transect data from the Nysted windfarm
area in Denmark provided to the University of St Andrews by Aarhus
University. There are two years of data (2001 and 2002) with surveys
undertaken in January, February and March. The response is counts of
long tailed ducks that have been distance corrected. Each transect has
been segmented into 500m pieces and the strip width is approximately
2km.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ptheme</span> <span class="op">&lt;-</span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.text<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">10</span><span class="op">)</span>,</span>
<span>          plot.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">14</span>, face<span class="op">=</span><span class="st">"bold"</span><span class="op">)</span>,</span>
<span>          axis.text<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">12</span><span class="op">)</span>,</span>
<span>          axis.title<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">12</span>,face<span class="op">=</span><span class="st">"bold"</span><span class="op">)</span>,</span>
<span>          panel.grid.major <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>          panel.grid.minor <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html" class="external-link">coord_equal</a></span><span class="op">(</span><span class="op">)</span> </span>
<span>  </span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plotbreaks</span><span class="op">&lt;-</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/waiver.html" class="external-link">waiver</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">p</span><span class="op">&lt;-</span><span class="va">ptheme</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data<span class="op">=</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">count.data</span>, <span class="va">Count</span><span class="op">==</span><span class="fl">0</span><span class="op">)</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x.pos</span>, y <span class="op">=</span> <span class="va">y.pos</span><span class="op">)</span>,shape<span class="op">=</span><span class="fl">16</span>, colour<span class="op">=</span><span class="st">'thistle'</span>, alpha<span class="op">=</span><span class="fl">0.8</span>, size<span class="op">=</span><span class="fl">1</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data<span class="op">=</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">count.data</span>, <span class="va">Count</span><span class="op">&gt;</span><span class="fl">0</span><span class="op">)</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x.pos</span>, y <span class="op">=</span> <span class="va">y.pos</span>, size <span class="op">=</span> <span class="va">Count</span><span class="op">)</span>, alpha<span class="op">=</span><span class="fl">0.45</span>, colour<span class="op">=</span><span class="st">'red'</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_size.html" class="external-link">scale_size_area</a></span><span class="op">(</span>breaks<span class="op">=</span><span class="va">plotbreaks</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Easting"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Northing"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">YearMonth</span>, ncol<span class="op">=</span><span class="fl">3</span><span class="op">)</span></span>
<span><span class="va">p</span></span></code></pre></div>
<p><img src="RenewablesCaseStudy_MRSea_files/figure-html/unnamed-chunk-5-1.png" width="1152"></p>
</div>
<div class="section level2">
<h2 id="analysis">Analysis<a class="anchor" aria-label="anchor" href="#analysis"></a>
</h2>
<p>Since the response data are adjusted counts and so we would expect a
quasi-Poisson or Tweedie distribution to be most appropriate for the
data. The variables available are depth and x and y coordinates (in
UTMs). There is also an area associated with each segment so an offset
is preferred.</p>
<div class="section level3">
<h3 id="co-linearity-check">Co-linearity check<a class="anchor" aria-label="anchor" href="#co-linearity-check"></a>
</h3>
<ul>
<li>Fit a simple model and assess variables for co-linearity. For this
assessment the <code>family</code> is not important so for simplicity we
choose the quasi-Poisson.</li>
</ul>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">simpleModel</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">Count</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">YearMonth</span><span class="op">)</span> <span class="op">+</span></span>
<span>                   <span class="va">Depth</span> <span class="op">+</span> <span class="va">x.pos</span> <span class="op">+</span> <span class="va">y.pos</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/offset.html" class="external-link">offset</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">Area</span><span class="op">)</span><span class="op">)</span>, family <span class="op">=</span> <span class="va">quasipoisson</span>, data <span class="op">=</span> <span class="va">count.data</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">car</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/car/man/vif.html" class="external-link">vif</a></span><span class="op">(</span><span class="va">simpleModel</span><span class="op">)</span></span>
<span><span class="co">#&gt;                          GVIF Df GVIF^(1/(2*Df))</span></span>
<span><span class="co">#&gt; as.factor(YearMonth) 1.001860  5        1.000186</span></span>
<span><span class="co">#&gt; Depth                4.666708  1        2.160256</span></span>
<span><span class="co">#&gt; x.pos                1.585197  1        1.259046</span></span>
<span><span class="co">#&gt; y.pos                5.386125  1        2.320803</span></span></code></pre></div>
<ul>
<li>The GVIFs suggest that there are no co-linearity issues so we may
use all available variables.</li>
</ul>
</div>
<div class="section level3">
<h3 id="selection-of-1d-covariates">Selection of 1D Covariates<a class="anchor" aria-label="anchor" href="#selection-of-1d-covariates"></a>
</h3>
<p>We use the function <code>runSALSA1D</code> to select what covariates
are included and whether or not they are smooth. SALSA selects the
smoothness of each term (number and location of knots) and by default,
10-fold cross-validation (CV) is used to choose between the best smooth
term, a linear term or no term at all. To not allow the removal process
the user may set <code>removal = FALSE</code> as a parameter in the
function <code>runSALSA1D</code>.</p>
<p>If you wish to make predictions once the model is fitted, then a
prediction grid should be created and specified. This is because the
splines fitted here (B-splines) are unable to make predictions outside
of the range they were created. For example, if the data range for depth
is smaller than the range of depths in the prediction data, predictions
cannot be made.</p>
<p>For our prediction grid, we must ensure that the depth and area
columns are named the same as the data and the depth values are all
positive. Additionally, as this grid has been used for other means, we
reduce it down to one single layer and select one season and one impact
level.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"nysted.predictdata"</span><span class="op">)</span>  <span class="co"># contains predict.data</span></span>
<span><span class="co"># This is a spatial grid for making predictions.  All covariates in</span></span>
<span><span class="co"># final model must be in this data frame and the naming must be the</span></span>
<span><span class="co"># same as for the data</span></span>
<span></span>
<span><span class="va">nysted.predictdata</span> <span class="op">&lt;-</span> <span class="va">nysted.predictdata</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>Depth <span class="op">=</span> <span class="va">depth</span>,</span>
<span>         Area <span class="op">=</span> <span class="va">area</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Depth <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">Depth</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">impact</span><span class="op">==</span><span class="fl">0</span>, <span class="va">season</span><span class="op">==</span><span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">"truth"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="va">count.data</span><span class="op">$</span><span class="va">Depth</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1]  0.35 28.63</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="va">nysted.predictdata</span><span class="op">$</span><span class="va">Depth</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1]  0.200 28.608</span></span></code></pre></div>
<ul>
<li>Here the range of the predictions is slightly wider than the range
of the data, so we will specify <code>nysted.predictdata</code> when
running SALSA.</li>
</ul>
<p>A brief check of a quasi-Poisson model with a smooth for depth
indicated there might be merit in checking the use of the Tweedie
distribution. For more information on using the Tweedie distribution,
see the vignette <a href="http://lindesaysh.github.io/MRSea/articles/web/TheTweedieDistribution_MRSea.html">Using
the Tweedie Distribution</a></p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">statmod</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">tweedie</span><span class="op">)</span></span>
<span><span class="va">profout</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/tweedie/man/tweedie.profile.html" class="external-link">tweedie.profile</a></span><span class="op">(</span><span class="va">Count</span> <span class="op">~</span> <span class="va">x.pos</span> <span class="op">+</span> <span class="va">y.pos</span> <span class="op">+</span> <span class="va">YearMonth</span> <span class="op">+</span> <span class="va">Depth</span>,</span>
<span>                           data<span class="op">=</span><span class="va">count.data</span>,</span>
<span>                           xi.vec <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1.01</span>, <span class="fl">1.99</span>, by<span class="op">=</span><span class="fl">0.05</span><span class="op">)</span>, do.plot<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; 1.01 1.06 1.11 1.16 1.21 1.26 1.31 1.36 1.41 1.46 1.51 1.56 1.61 1.66 1.71 1.76 1.81 1.86 1.91 1.96 </span></span>
<span><span class="co">#&gt; ....................Done.</span></span></code></pre></div>
<p><img src="RenewablesCaseStudy_MRSea_files/figure-html/tweedie-profile-1.png" width="700"></p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">profout</span><span class="op">$</span><span class="va">xi.max</span></span>
<span><span class="co">#&gt; [1] 1.427347</span></span></code></pre></div>
<p>Now that we have an estimate for the Tweedie variance power parameter
we can start fitting models.</p>
<p>Since we intend to use the spatial coordinates in a 2D smooth later,
we will ignore the X and Y coordinates for now. To fit the 1D smooths,
we set up the initial model with factor covariates and the offset term
and specify the parameters required for SALSA1D:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">count.data</span><span class="op">$</span><span class="va">response</span> <span class="op">&lt;-</span> <span class="va">count.data</span><span class="op">$</span><span class="va">Count</span></span>
<span><span class="va">initialModel</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">response</span> <span class="op">~</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">YearMonth</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/offset.html" class="external-link">offset</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">Area</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                    family<span class="op">=</span><span class="fu"><a href="https://rdrr.io/pkg/statmod/man/tweedie.html" class="external-link">tweedie</a></span><span class="op">(</span>var.power<span class="op">=</span><span class="va">profout</span><span class="op">$</span><span class="va">xi.max</span>, link.power <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>,</span>
<span>                    data <span class="op">=</span> <span class="va">count.data</span><span class="op">)</span></span></code></pre></div>
<p>Our preference would be to use k-fold cross-validation as the fitness
measure where possible. However, it can take a long time to fit models
and for speed we have chosen to use a BIC for this vignette (a version
suitable for the Tweedie distribution). For the depth term we will try
both a degree 2 (quadratic) B-spline and a natural spline.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">varlist</span> <span class="op">=</span> <span class="st">"Depth"</span></span>
<span><span class="va">salsa1dlist</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>fitnessMeasure <span class="op">=</span> <span class="st">"BICtweedie"</span>,</span>
<span>                    minKnots_1d <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                    maxKnots_1d <span class="op">=</span> <span class="fl">3</span>,</span>
<span>                    startKnots_1d <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                    degree <span class="op">=</span> <span class="fl">2</span>,</span>
<span>                    gaps <span class="op">=</span> <span class="fl">0</span>,</span>
<span>                    splines <span class="op">=</span> <span class="st">"bs"</span><span class="op">)</span></span></code></pre></div>
<p>Note that if you want to use k-fold cross-validation as a fitness
measure, you will need an additional parameter in the list;
<code>cv.opts</code>. The code to use 10-fold cross-validation is shown
below but not run for this example.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">salsa1dlist</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>fitnessMeasure <span class="op">=</span> <span class="st">"cv.gamMRSea"</span>,</span>
<span>                    minKnots_1d <span class="op">=</span> <span class="fl">2</span>,</span>
<span>                    maxKnots_1d <span class="op">=</span> <span class="fl">3</span>,</span>
<span>                    startKnots_1d <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                    degree <span class="op">=</span> <span class="fl">2</span>,</span>
<span>                    gaps <span class="op">=</span> <span class="fl">0</span>,</span>
<span>                    cv.opts<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>cv.gamMRSea.seed<span class="op">=</span><span class="fl">1</span>, K<span class="op">=</span><span class="fl">10</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>It is likely that the data will be correlated along transect so we
will add a panel variable to calculate robust standard errors. Later we
will check the residuals for residual correlation to confirm this
choice. The panel variable is each unique survey-transect. There are
approximately 23 transects per survey leading to 153 panels.</p>
<p><strong>Note: the data must be ordered by time along each
transect</strong></p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># run SALSA</span></span>
<span><span class="va">salsa1dOutput.bs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/runSALSA1D.html">runSALSA1D</a></span><span class="op">(</span>initialModel <span class="op">=</span> <span class="va">initialModel</span>,</span>
<span>                            salsa1dlist <span class="op">=</span> <span class="va">salsa1dlist</span>,</span>
<span>                            varlist <span class="op">=</span> <span class="va">varlist</span>,</span>
<span>                            factorlist <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"YearMonth"</span><span class="op">)</span>,</span>
<span>                            predictionData <span class="op">=</span> <span class="va">nysted.predictdata</span>,</span>
<span>                            datain <span class="op">=</span> <span class="va">count.data</span>,</span>
<span>                            panelid <span class="op">=</span> <span class="va">count.data</span><span class="op">$</span><span class="va">TransectID</span>,</span>
<span>                            removal <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                            suppress.printout <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<ul>
<li>now try a natural spline:</li>
</ul>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">salsa1dlist</span><span class="op">$</span><span class="va">splines</span> <span class="op">=</span> <span class="st">"ns"</span></span>
<span><span class="va">salsa1dOutput.ns</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/runSALSA1D.html">runSALSA1D</a></span><span class="op">(</span>initialModel <span class="op">=</span> <span class="va">initialModel</span>,</span>
<span>                            salsa1dlist <span class="op">=</span> <span class="va">salsa1dlist</span>,</span>
<span>                            varlist <span class="op">=</span> <span class="va">varlist</span>,</span>
<span>                            factorlist <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"YearMonth"</span><span class="op">)</span>,</span>
<span>                            predictionData <span class="op">=</span> <span class="va">nysted.predictdata</span>,</span>
<span>                            datain <span class="op">=</span> <span class="va">count.data</span>,</span>
<span>                            panelid <span class="op">=</span> <span class="va">count.data</span><span class="op">$</span><span class="va">TransectID</span>,</span>
<span>                            removal <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                            suppress.printout <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">salsa1dOutput.bs</span><span class="op">$</span><span class="va">fitStat</span></span>
<span><span class="co">#&gt; $fitStat</span></span>
<span><span class="co">#&gt; [1] 13823.87</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $CV</span></span>
<span><span class="co">#&gt; [1] 860.4657</span></span>
<span><span class="va">salsa1dOutput.ns</span><span class="op">$</span><span class="va">fitStat</span></span>
<span><span class="co">#&gt; $fitStat</span></span>
<span><span class="co">#&gt; [1] 13898.11</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $CV</span></span>
<span><span class="co">#&gt; [1] 861.3047</span></span></code></pre></div>
<ul>
<li>Using either the BIC score or the CV score, the B spline is
preferred so we continue with this model.</li>
</ul>
<p>To look at the model output you can use the built in summary function
(<code>summary.gamMRSea</code>) to look at the summary of the model.
Note that robust standard errors are given alongside the raw standard
errors and information regarding panels is at the bottom of the output.
If each data point is a panel, then independence is assumed.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">best1dmodel</span> <span class="op">&lt;-</span> <span class="va">salsa1dOutput.bs</span><span class="op">$</span><span class="va">bestModel</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">best1dmodel</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; gamMRSea(formula = response ~ as.factor(YearMonth) + bs(Depth, </span></span>
<span><span class="co">#&gt;     knots = splineParams[[2]]$knots, degree = splineParams[[2]]$degree, </span></span>
<span><span class="co">#&gt;     Boundary.knots = splineParams[[2]]$bd) + offset(log(Area)), </span></span>
<span><span class="co">#&gt;     family = tweedie(var.power = 1.42734693877551, link.power = 0), </span></span>
<span><span class="co">#&gt;     data = count.data, splineParams = splineParams)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Deviance Residuals: </span></span>
<span><span class="co">#&gt;    Min      1Q  Median      3Q     Max  </span></span>
<span><span class="co">#&gt; -4.817  -2.681  -1.469  -0.725  37.328  </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients:</span></span>
<span><span class="co">#&gt;                            Estimate Std. Error Robust S.E. t value Pr(&gt;|t|)    </span></span>
<span><span class="co">#&gt; (Intercept)                -1.53203    0.33810     0.39133  -3.915 9.14e-05 ***</span></span>
<span><span class="co">#&gt; as.factor(YearMonth)2001/2  1.19234    0.25485     0.31378   3.800 0.000146 ***</span></span>
<span><span class="co">#&gt; as.factor(YearMonth)2001/3  0.83462    0.26410     0.22628   3.688 0.000227 ***</span></span>
<span><span class="co">#&gt; as.factor(YearMonth)2002/1 -0.03775    0.29410     0.24726  -0.153 0.878657    </span></span>
<span><span class="co">#&gt; as.factor(YearMonth)2002/2 -0.14827    0.29896     0.23371  -0.634 0.525834    </span></span>
<span><span class="co">#&gt; as.factor(YearMonth)2002/3  1.74682    0.24359     0.30277   5.770 8.31e-09 ***</span></span>
<span><span class="co">#&gt; s(Depth)1                   6.02467    0.50369     0.58465  10.305  &lt; 2e-16 ***</span></span>
<span><span class="co">#&gt; s(Depth)2                  -4.44245    0.47682     0.61936  -7.173 8.18e-13 ***</span></span>
<span><span class="co">#&gt; s(Depth)3                  -1.52203    1.34437     1.10032  -1.383 0.166630    </span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; (Dispersion parameter for Tweedie family taken to be 50.53919)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     Null deviance: 77202  on 6499  degrees of freedom</span></span>
<span><span class="co">#&gt; Residual deviance: 49063  on 6491  degrees of freedom</span></span>
<span><span class="co">#&gt; AIC:  NA</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Max Panel Size = 53; Number of panels = 153</span></span>
<span><span class="co">#&gt; Number of Fisher Scoring iterations: 6</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="some-diagnostics">Some diagnostics<a class="anchor" aria-label="anchor" href="#some-diagnostics"></a>
</h3>
<ul>
<li>Now that we have used the Tweedie distribution, check the assumed
mean-variance relationship is appropriate.</li>
</ul>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../../reference/plotMeanVar.html">plotMeanVar</a></span><span class="op">(</span><span class="va">best1dmodel</span><span class="op">)</span></span></code></pre></div>
<p><img src="RenewablesCaseStudy_MRSea_files/figure-html/unnamed-chunk-18-1.png" width="700"></p>
<p>The Tweedie distribution looks to be a better choice than the
Quasi-Poisson so we continue with this.</p>
<div class="section level4">
<h4 id="partial-plots">Partial Plots<a class="anchor" aria-label="anchor" href="#partial-plots"></a>
</h4>
<p>Now that we have a smooth term selected for the depth variable, let’s
look at the estimated relationship on both the link scale and the
response scale. We can also assess if there is likely to be differences
between the surveys.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../../reference/runPartialPlots.html">runPartialPlots</a></span><span class="op">(</span><span class="va">best1dmodel</span>,</span>
<span>                data<span class="op">=</span><span class="va">count.data</span>,</span>
<span>                factorlist.in <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"YearMonth"</span><span class="op">)</span>,</span>
<span>                varlist.in <span class="op">=</span> <span class="va">varlist</span>,</span>
<span>                showKnots <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                type <span class="op">=</span> <span class="st">"link"</span>,</span>
<span>                includeB0 <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Making partial plots"</span></span></code></pre></div>
<p><img src="RenewablesCaseStudy_MRSea_files/figure-html/unnamed-chunk-19-1.png" width="960"><img src="RenewablesCaseStudy_MRSea_files/figure-html/unnamed-chunk-19-2.png" width="960"></p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../../reference/runPartialPlots.html">runPartialPlots</a></span><span class="op">(</span><span class="va">best1dmodel</span>,</span>
<span>                data<span class="op">=</span><span class="va">count.data</span>,</span>
<span>                factorlist.in <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"YearMonth"</span><span class="op">)</span>,</span>
<span>                varlist.in <span class="op">=</span> <span class="va">varlist</span>,</span>
<span>                showKnots <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                type <span class="op">=</span> <span class="st">"response"</span>,</span>
<span>                includeB0 <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Making partial plots"</span></span></code></pre></div>
<p><img src="RenewablesCaseStudy_MRSea_files/figure-html/unnamed-chunk-20-1.png" width="960"><img src="RenewablesCaseStudy_MRSea_files/figure-html/unnamed-chunk-20-2.png" width="960"></p>
</div>
<div class="section level4">
<h4 id="cumulative-residual-plots">Cumulative residual plots<a class="anchor" aria-label="anchor" href="#cumulative-residual-plots"></a>
</h4>
<p>We can use a cumulative residual plot to indicate if our spline terms
are suitable. The blue dots are the residuals and the black line is the
line of cumulative residuals. On the covariate plots (those in
<code>varlist</code>) the grey line indicates what we would expect from
an over fitted covariate. i.e. one that is fitted with excessive knots
and the grey dots are the residuals from this over fitted model.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../../reference/plotCumRes.html">plotCumRes</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">best1dmodel</span>, varlist <span class="op">=</span> <span class="st">'Depth'</span>, variableonly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Calculating cumulative residuals"</span></span></code></pre></div>
<p><img src="RenewablesCaseStudy_MRSea_files/figure-html/unnamed-chunk-21-1.png" width="960"></p>
<p>There is slight under prediction at shallow depths but on the whole
it looks a decent fit so We are happy with functional form of the depth
relationship.</p>
<p>To show what happens when the functional form is inappropriate, we
can use a model with depth as a linear term and re-assess the partial
plot and the cumulative residual plot. Now you can see that the
cumulative residuals get more and more negative indicating that there is
systematic under prediction to depths of about 5m and then over
prediction to about 12m and under prediction at the higher depth
values.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">badcovar</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/update.html" class="external-link">update</a></span><span class="op">(</span><span class="va">initialModel</span>, <span class="va">.</span> <span class="op">~</span> <span class="va">.</span> <span class="op">+</span> <span class="va">Depth</span><span class="op">)</span></span>
<span><span class="fu"><a href="../../reference/runPartialPlots.html">runPartialPlots</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">badcovar</span>, data<span class="op">=</span><span class="va">count.data</span>, varlist.in <span class="op">=</span> <span class="st">"Depth"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Making partial plots"</span></span></code></pre></div>
<p><img src="RenewablesCaseStudy_MRSea_files/figure-html/unnamed-chunk-22-1.png" width="960"></p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../../reference/plotCumRes.html">plotCumRes</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">badcovar</span>, varlist <span class="op">=</span> <span class="st">'Depth'</span>, variableonly <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Calculating cumulative residuals"</span></span></code></pre></div>
<p><img src="RenewablesCaseStudy_MRSea_files/figure-html/unnamed-chunk-22-2.png" width="960"></p>
</div>
</div>
<div class="section level3">
<h3 id="selection-of-flexibility-for-2d-smooth-term">Selection of flexibility for 2D smooth term<a class="anchor" aria-label="anchor" href="#selection-of-flexibility-for-2d-smooth-term"></a>
</h3>
<p>We have several options for interaction terms depending on how we
might think the spatial distribution changes over time. On the basis of
the figure in the introduction, it looks like there will be different
distributions in different surveys. We have three options:</p>
<ol style="list-style-type: decimal">
<li>Fixed knot locations, replicated for every survey with different
coefficients allowed (specified using
<code>interactionTerm = YearMonth</code> in the list of SALSA2D
parameters). So, during the model fitting, if a knot moves it moves for
all surfaces.</li>
<li>Differing knot locations for every survey (detailed in the <a href="http://lindesaysh.github.io/MRSea/articles/web/Interactions_salsa2d_MRSea.html">Interaction
vignette</a>. This is set up so that each knot location only acts on one
of the density surfaces. This method takes much longer to fit and may
become impractical for large numbers of surveys however it is very
useful if there is differing geographic coverage in the different
surveys.</li>
<li>The last option is to fit separate models to each of the
surveys.</li>
</ol>
<p>Here we choose option 2 as there is a slight difference in coverage
between the surveys and not so many surveys as to make this
impractical.</p>
<p>First we must create a grid of knots that will be used as candidate
knot locations. This may take while and could be different every time
you run it so I suggest saving the knotgrid as a file and/or setting a
seed. As we have 6 factor levels, we choose 150 candidate knot locations
for each survey giving us a total of 900 options.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">myknots</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/selectFctrKnots.html">selectFctrKnots</a></span><span class="op">(</span><span class="va">count.data</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x.pos"</span>, <span class="st">"y.pos"</span>, <span class="st">"YearMonth"</span><span class="op">)</span><span class="op">]</span>, </span>
<span>                           nk<span class="op">=</span><span class="fl">150</span>, </span>
<span>                           s.eed<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">#</span></span>
<span><span class="co"># write.csv(myknots, file='knotgrid_fullanalysis.csv', row.names=F)</span></span>
<span><span class="co"># ~~~~~~~~~~~~~~~~~~~~~~~</span></span></code></pre></div>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">count.data</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">x.pos</span>, <span class="va">y.pos</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">myknots</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">x.pos</span>, <span class="va">y.pos</span><span class="op">)</span>, colour<span class="op">=</span><span class="st">'red'</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">YearMonth</span>, nrow<span class="op">=</span><span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">'Easting (Km)'</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">'Northing (Km)'</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html" class="external-link">coord_equal</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="RenewablesCaseStudy_MRSea_files/figure-html/selknots-1.png" alt="Figure showing the candidate knot locations for each of the interaction levels" width="1152"><p class="caption">
Figure showing the candidate knot locations for each of the interaction
levels
</p>
</div>
<p>To create the distance matrices that ensure the distance between data
in survey 1 and knots from survey 1 is computed but the distance between
these knots and data from other surveys is infinity we specify three
columns for the <code>datacoords</code> and <code>knotcoords</code>
parameters of <code>makeDists</code>.</p>
<p><strong>Note: to ensure that this method works, the data must be
ordered by <code>YearMonth</code> and have the same order as
<code>myknots</code></strong></p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dists</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/makeDists.html">makeDists</a></span><span class="op">(</span>datacoords <span class="op">=</span> <span class="va">count.data</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'x.pos'</span>, <span class="st">'y.pos'</span>, <span class="st">'YearMonth'</span><span class="op">)</span><span class="op">]</span>, </span>
<span>                   knotcoords <span class="op">=</span> <span class="va">myknots</span>, </span>
<span>                   knotmat <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">k2k</span> <span class="op">&lt;-</span> <span class="va">dists</span><span class="op">$</span><span class="va">knotDist</span></span>
<span><span class="va">d2k</span> <span class="op">&lt;-</span> <span class="va">dists</span><span class="op">$</span><span class="va">dataDist</span></span></code></pre></div>
<p>To see what we mean, let’s look at the distances between the last
three knots in the first survey (<code>YearMonth = 2001/1</code>) and
the first three of the second survey. We selected 150 knots for each
survey so this is where we’ll find the change. As you can see, the
distance between knots within the same survey is computed, but between
surveys it is infinity.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">k2k</span><span class="op">[</span><span class="fl">148</span><span class="op">:</span><span class="fl">153</span>, <span class="fl">148</span><span class="op">:</span><span class="fl">153</span><span class="op">]</span></span>
<span><span class="co">#&gt;           148       149      150      151      152      153</span></span>
<span><span class="co">#&gt; 148  0.000000  6.545602 19.90365      Inf      Inf      Inf</span></span>
<span><span class="co">#&gt; 149  6.545602  0.000000 14.50510      Inf      Inf      Inf</span></span>
<span><span class="co">#&gt; 150 19.903649 14.505103  0.00000      Inf      Inf      Inf</span></span>
<span><span class="co">#&gt; 151       Inf       Inf      Inf  0.00000 17.31904 16.15195</span></span>
<span><span class="co">#&gt; 152       Inf       Inf      Inf 17.31904  0.00000 13.26928</span></span>
<span><span class="co">#&gt; 153       Inf       Inf      Inf 16.15195 13.26928  0.00000</span></span></code></pre></div>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">startknotlocs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/selectFctrStartk.html">selectFctrStartk</a></span><span class="op">(</span><span class="va">myknots</span>, <span class="fl">5</span>, s.eed <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span></code></pre></div>
<p>The set up of the model is a little different and I have included
<code>##</code> below to indicate which lines have been
changed/added.</p>
<p><strong>Note: no interaction term is specified in the list of SALSA2D
parameters but the factor level should be in the model as a main
effect.</strong></p>
<div class="section level4">
<h4 id="model-fitting">Model fitting<a class="anchor" aria-label="anchor" href="#model-fitting"></a>
</h4>
<p>Set up the parameters for SALSA2D: distance matrices (data to knots
and knot to knots), a fit statistic and min, max and start knots.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># make parameter set for running salsa2d --&gt;</span></span>
<span> <span class="va">salsa2dlist</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>fitnessMeasure <span class="op">=</span> <span class="st">'BICtweedie'</span>, </span>
<span>                   knotgrid <span class="op">=</span> <span class="va">myknots</span>,</span>
<span>                   startKnots <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">startknotlocs</span><span class="op">)</span>, <span class="co">##</span></span>
<span>                   minKnots<span class="op">=</span><span class="fl">4</span>,  </span>
<span>                   maxKnots<span class="op">=</span><span class="fl">100</span>, </span>
<span>                   gap<span class="op">=</span><span class="fl">0</span><span class="op">)</span> </span></code></pre></div>
<p>Run SALSA2D to find the appropriate number and location of knots for
the 2D smooth term of <code>x.pos</code> and <code>y.pos</code>. The
model inputted to the SALSA algorithm is the model output from the 1D
SALSA run.</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">salsa2dOutput</span><span class="op">&lt;-</span><span class="fu"><a href="../../reference/runSALSA2D.html">runSALSA2D</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">best1dmodel</span>,</span>
<span>                          salsa2dlist <span class="op">=</span> <span class="va">salsa2dlist</span>,</span>
<span>                          d2k <span class="op">=</span> <span class="va">d2k</span>,</span>
<span>                          k2k <span class="op">=</span> <span class="va">k2k</span>,</span>
<span>                          initialise<span class="op">=</span><span class="cn">FALSE</span>,  <span class="co">##</span></span>
<span>                          initialKnPos <span class="op">=</span> <span class="va">startknotlocs</span>, <span class="co">##</span></span>
<span>                          suppress.printout <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/anova.html" class="external-link">anova</a></span><span class="op">(</span><span class="va">salsa2dOutput</span><span class="op">$</span><span class="va">bestModel</span><span class="op">)</span></span>
<span><span class="co">#&gt; Analysis of 'Wald statistic' Table</span></span>
<span><span class="co">#&gt; Model: Tweedie, link: mu^0</span></span>
<span><span class="co">#&gt; Response: response</span></span>
<span><span class="co">#&gt; Marginal Testing</span></span>
<span><span class="co">#&gt; Max Panel Size = 53; Number of panels = 153</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;                      Df      X2 P(&gt;|Chi|)    </span></span>
<span><span class="co">#&gt; as.factor(YearMonth)  5  59.575 1.488e-11 ***</span></span>
<span><span class="co">#&gt; s(Depth)              3 249.217 &lt; 2.2e-16 ***</span></span>
<span><span class="co">#&gt; s(x.pos, y.pos)      18 109.359 4.108e-15 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span></code></pre></div>
<p>The model has chosen a total of 18 knots for the 2D smooth. If we
want to know how many knots per surface we need to see which knots were
selected. These are found in the <code>splineParams</code> object which
is part of the model object.</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">chosenknots</span> <span class="op">&lt;-</span> <span class="va">myknots</span><span class="op">[</span><span class="va">salsa2dOutput</span><span class="op">$</span><span class="va">bestModel</span><span class="op">$</span><span class="va">splineParams</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">knotPos</span>,<span class="op">]</span></span></code></pre></div>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">count</a></span><span class="op">(</span><span class="va">chosenknots</span>, <span class="va">YearMonth</span><span class="op">)</span></span>
<span><span class="co">#&gt;   YearMonth n</span></span>
<span><span class="co">#&gt; 1    2001/2 4</span></span>
<span><span class="co">#&gt; 2    2001/3 4</span></span>
<span><span class="co">#&gt; 3    2002/1 3</span></span>
<span><span class="co">#&gt; 4    2002/2 2</span></span>
<span><span class="co">#&gt; 5    2002/3 5</span></span></code></pre></div>
<p>As we have a global depth term in the model, which describes some of
the distribution of the birds, the 2D smooth can change this for each
survey by judiciously placing knots. In this case, we have between 0 and
5 knots chosen for each survey.</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># quick look to see what was chosen</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">myknots</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">x.pos</span>, y<span class="op">=</span><span class="va">y.pos</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">x.pos</span>, y<span class="op">=</span><span class="va">y.pos</span>, size<span class="op">=</span><span class="fl">2</span><span class="op">)</span>, data<span class="op">=</span><span class="va">chosenknots</span>, alpha<span class="op">=</span><span class="fl">4</span><span class="op">/</span><span class="fl">5</span>, </span>
<span>             show.legend <span class="op">=</span> <span class="cn">FALSE</span>, shape<span class="op">=</span><span class="fl">5</span>, colour<span class="op">=</span><span class="st">"darkred"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">'Easting (Km)'</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">'Northing (Km)'</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html" class="external-link">coord_equal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">YearMonth</span>, ncol<span class="op">=</span><span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<p><img src="RenewablesCaseStudy_MRSea_files/figure-html/unnamed-chunk-31-1.png" width="1152"></p>
<p>We now have several models that we have fitted:</p>
<ol style="list-style-type: decimal">
<li>the initial intercept only model</li>
<li>the 1D smooth model</li>
<li>the 1 and 2D smooth model</li>
</ol>
<p>For completeness, we also fit a 2D smooth only model. For this we can
use the same set up as before but replace the starting model with
<code>initialModel</code></p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">salsa2dOutput2donly</span><span class="op">&lt;-</span><span class="fu"><a href="../../reference/runSALSA2D.html">runSALSA2D</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">initialModel</span>,</span>
<span>                                salsa2dlist <span class="op">=</span> <span class="va">salsa2dlist</span>,</span>
<span>                                d2k <span class="op">=</span> <span class="va">d2k</span>,</span>
<span>                                k2k <span class="op">=</span> <span class="va">k2k</span>,</span>
<span>                                initialise<span class="op">=</span><span class="cn">FALSE</span>,  </span>
<span>                                initialKnPos <span class="op">=</span> <span class="va">startknotlocs</span>, </span>
<span>                                suppress.printout <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/anova.html" class="external-link">anova</a></span><span class="op">(</span><span class="va">salsa2dOutput2donly</span><span class="op">$</span><span class="va">bestModel</span><span class="op">)</span></span>
<span><span class="co">#&gt; Analysis of 'Wald statistic' Table</span></span>
<span><span class="co">#&gt; Model: Tweedie, link: mu^0</span></span>
<span><span class="co">#&gt; Response: response</span></span>
<span><span class="co">#&gt; Marginal Testing</span></span>
<span><span class="co">#&gt; Max Panel Size = 1 (independence assumed); Number of panels = 6500</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;                      Df     X2 P(&gt;|Chi|)    </span></span>
<span><span class="co">#&gt; as.factor(YearMonth)  5 204.87 &lt; 2.2e-16 ***</span></span>
<span><span class="co">#&gt; s(x.pos, y.pos)      23 427.89 &lt; 2.2e-16 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span></code></pre></div>
<p>As might be expected, the model has chosen more knots or the 2D
smooth (22) and each surface has between 1 and 5 knots.</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">chosenknots</span> <span class="op">&lt;-</span> <span class="va">myknots</span><span class="op">[</span><span class="va">salsa2dOutput2donly</span><span class="op">$</span><span class="va">bestModel</span><span class="op">$</span><span class="va">splineParams</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">knotPos</span>,<span class="op">]</span></span></code></pre></div>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/count.html" class="external-link">count</a></span><span class="op">(</span><span class="va">chosenknots</span>, <span class="va">YearMonth</span><span class="op">)</span></span>
<span><span class="co">#&gt;   YearMonth n</span></span>
<span><span class="co">#&gt; 1    2001/1 3</span></span>
<span><span class="co">#&gt; 2    2001/2 4</span></span>
<span><span class="co">#&gt; 3    2001/3 5</span></span>
<span><span class="co">#&gt; 4    2002/1 1</span></span>
<span><span class="co">#&gt; 5    2002/2 5</span></span>
<span><span class="co">#&gt; 6    2002/3 5</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="model-selection">Model Selection<a class="anchor" aria-label="anchor" href="#model-selection"></a>
</h3>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cv_2d</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/cv.gamMRSea.html">cv.gamMRSea</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">count.data</span>, modelobject <span class="op">=</span> <span class="va">salsa2dOutput2donly</span><span class="op">$</span><span class="va">bestModel</span>, K<span class="op">=</span><span class="fl">10</span>, s.eed<span class="op">=</span><span class="fl">1</span><span class="op">)</span><span class="op">$</span><span class="va">delta</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span>
<span><span class="va">cv_1d2d</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/cv.gamMRSea.html">cv.gamMRSea</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">count.data</span>, modelobject <span class="op">=</span> <span class="va">salsa2dOutput</span><span class="op">$</span><span class="va">bestModel</span>, K<span class="op">=</span><span class="fl">10</span>, s.eed<span class="op">=</span><span class="fl">1</span><span class="op">)</span><span class="op">$</span><span class="va">delta</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span>
<span><span class="va">cv_1d</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/cv.gamMRSea.html">cv.gamMRSea</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">count.data</span>, modelobject <span class="op">=</span> <span class="va">best1dmodel</span>, K<span class="op">=</span><span class="fl">10</span>, s.eed<span class="op">=</span><span class="fl">1</span><span class="op">)</span><span class="op">$</span><span class="va">delta</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span>
<span><span class="va">cv_initial</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/cv.gamMRSea.html">cv.gamMRSea</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">count.data</span>, modelobject <span class="op">=</span> <span class="va">initialModel</span>, K<span class="op">=</span><span class="fl">10</span>, s.eed<span class="op">=</span><span class="fl">1</span><span class="op">)</span><span class="op">$</span><span class="va">delta</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th>Model</th>
<th>CV score</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>Initial</td>
<td>879.76</td>
</tr>
<tr class="even">
<td>1D only</td>
<td>860.466</td>
</tr>
<tr class="odd">
<td>1D and 2D</td>
<td>814.433</td>
</tr>
<tr class="even">
<td>2D only</td>
<td>767.363</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">finalmod</span><span class="op">&lt;-</span><span class="va">salsa2dOutput2donly</span><span class="op">$</span><span class="va">bestModel</span></span></code></pre></div>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/anova.html" class="external-link">anova</a></span><span class="op">(</span><span class="va">finalmod</span><span class="op">)</span></span>
<span><span class="co">#&gt; Analysis of 'Wald statistic' Table</span></span>
<span><span class="co">#&gt; Model: Tweedie, link: mu^0</span></span>
<span><span class="co">#&gt; Response: response</span></span>
<span><span class="co">#&gt; Marginal Testing</span></span>
<span><span class="co">#&gt; Max Panel Size = 1 (independence assumed); Number of panels = 6500</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;                      Df     X2 P(&gt;|Chi|)    </span></span>
<span><span class="co">#&gt; as.factor(YearMonth)  5 204.87 &lt; 2.2e-16 ***</span></span>
<span><span class="co">#&gt; s(x.pos, y.pos)      23 427.89 &lt; 2.2e-16 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="making-predictions">Making Predictions<a class="anchor" aria-label="anchor" href="#making-predictions"></a>
</h3>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># repeat predictiongrid for each yearmonth</span></span>
<span><span class="va">preddata</span> <span class="op">&lt;-</span> <span class="cn">NULL</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">ym</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">count.data</span><span class="op">$</span><span class="va">YearMonth</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">tdat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">nysted.predictdata</span>, YearMonth <span class="op">=</span> <span class="va">ym</span><span class="op">)</span></span>
<span>  <span class="va">preddata</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="va">preddata</span>, <span class="va">tdat</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">datacoords</span><span class="op">&lt;-</span><span class="va">preddata</span><span class="op">[</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'x.pos'</span>, <span class="st">'y.pos'</span>, <span class="st">'YearMonth'</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">dists</span><span class="op">&lt;-</span><span class="fu"><a href="../../reference/makeDists.html">makeDists</a></span><span class="op">(</span>datacoords <span class="op">=</span> <span class="va">datacoords</span>, knotcoords <span class="op">=</span> <span class="va">myknots</span>, knotmat <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="va">g2k</span> <span class="op">=</span> <span class="va">dists</span><span class="op">$</span><span class="va">dataDist</span></span></code></pre></div>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># make predictions on response scale</span></span>
<span><span class="va">preds</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span>newdata <span class="op">=</span> <span class="va">preddata</span>,</span>
<span>               g2k <span class="op">=</span> <span class="va">g2k</span>,</span>
<span>               object <span class="op">=</span> <span class="va">finalmod</span><span class="op">)</span></span></code></pre></div>
<p>Plotting the predictions for each survey.</p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="va">RColorBrewer</span><span class="op">)</span></span>
<span><span class="va">preddata</span><span class="op">$</span><span class="va">preds</span><span class="op">&lt;-</span><span class="va">preds</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span></span></code></pre></div>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p</span> <span class="op">&lt;-</span> <span class="va">ptheme</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_tile</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">preddata</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">x.pos</span>, <span class="va">y.pos</span>, fill<span class="op">=</span><span class="va">preds</span><span class="op">)</span>, height<span class="op">=</span><span class="fl">0.5</span>, width<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">YearMonth</span>, ncol <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html" class="external-link">scale_fill_distiller</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Spectral"</span>,name<span class="op">=</span><span class="st">"Animal Counts"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Easting"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Northing"</span><span class="op">)</span></span>
<span><span class="va">p</span></span></code></pre></div>
<p><img src="RenewablesCaseStudy_MRSea_files/figure-html/unnamed-chunk-43-1.png" width="1152" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_size.html" class="external-link">scale_size_area</a></span><span class="op">(</span>name<span class="op">=</span><span class="st">'Raw Count'</span>, </span>
<span>                    breaks<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">5</span>, <span class="fl">10</span>, <span class="fl">50</span><span class="op">)</span>, </span>
<span>                    labels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'10'</span>, <span class="st">'50'</span>, <span class="st">'100'</span>, <span class="st">'500'</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data<span class="op">=</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">count.data</span>, <span class="va">response</span><span class="op">&gt;</span><span class="fl">0</span><span class="op">)</span>, </span>
<span>               <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">x.pos</span>, <span class="va">y.pos</span>, size<span class="op">=</span><span class="va">response</span><span class="op">)</span>, colour<span class="op">=</span><span class="st">"black"</span>, shape<span class="op">=</span><span class="fl">1</span>, alpha<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span></span></code></pre></div>
<p><img src="RenewablesCaseStudy_MRSea_files/figure-html/unnamed-chunk-44-1.png" width="1152"></p>
</div>
<div class="section level3">
<h3 id="diagnostic-functions-in-the-mrsea-package">Diagnostic functions in the MRSea package<a class="anchor" aria-label="anchor" href="#diagnostic-functions-in-the-mrsea-package"></a>
</h3>
<p>The following sections assess the model assumptions and some
diagnostics to assess the performance of our model. There is more
detailed information on diagnostics in the <a href="http://lindesaysh.github.io/MRSea/articles/web/ModelDiagnostics_MRSea.html">Model
Diagnostics Vignette</a></p>
<div class="section level4">
<h4 id="residual-independence-assumption-check">Residual Independence Assumption Check<a class="anchor" aria-label="anchor" href="#residual-independence-assumption-check"></a>
</h4>
<p>Are the residuals correlated? Make a suitable blocking structure,
within which residuals are expected to be correlated but between which
they are independent. Use <code>runACF</code> to assess the blocking
structure.</p>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../../reference/runACF.html">runACF</a></span><span class="op">(</span>block <span class="op">=</span> <span class="va">count.data</span><span class="op">$</span><span class="va">TransectID</span>, model <span class="op">=</span> <span class="va">finalmod</span>,</span>
<span>       suppress.printout<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="RenewablesCaseStudy_MRSea_files/figure-html/acfplot-1.png" alt="ACF plot showing correlation in each block (grey lines), and the mean correlation by lag across blocks (red line)." width="960"><p class="caption">
ACF plot showing correlation in each block (grey lines), and the mean
correlation by lag across blocks (red line).
</p>
</div>
<p>As anticipated, we have some transects with very high lag one
correlation and so we must use robust standard errors for inference.</p>
<p>Alongside the ACF plot, we can also perform a runs test to assess for
correlation in the model residuals. Since our data are over-dispersed,
we must use the empirical distribution for assessment:</p>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">simData</span><span class="op">&lt;-</span><span class="fu"><a href="../../reference/generateNoise.html">generateNoise</a></span><span class="op">(</span>n<span class="op">=</span><span class="fl">500</span>, response<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/fitted.values.html" class="external-link">fitted</a></span><span class="op">(</span><span class="va">finalmod</span><span class="op">)</span>, family<span class="op">=</span><span class="st">'tweedie'</span>, phi<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">finalmod</span><span class="op">)</span><span class="op">$</span><span class="va">dispersion</span>, xi <span class="op">=</span> <span class="va">profout</span><span class="op">$</span><span class="va">xi.max</span><span class="op">)</span></span>
<span><span class="va">empdist</span><span class="op">&lt;-</span><span class="fu"><a href="../../reference/getEmpDistribution.html">getEmpDistribution</a></span><span class="op">(</span><span class="fl">500</span>, <span class="va">simData</span>, <span class="va">finalmod</span>, data<span class="op">=</span><span class="va">count.data</span>,dots<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../../reference/runsTest.html">runsTest</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/residuals.html" class="external-link">residuals</a></span><span class="op">(</span><span class="va">finalmod</span>, type<span class="op">=</span><span class="st">'pearson'</span><span class="op">)</span>,emp.distribution<span class="op">=</span><span class="va">empdist</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;  Runs Test - Two sided; Empirical Distribution</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; data:  residuals(finalmod, type = "pearson")</span></span>
<span><span class="co">#&gt; Standardized Runs Statistic = -53.091, p-value &lt; 2.2e-16</span></span></code></pre></div>
<p>The null hypothesis for the runs test is that the residuals are
independent. Here we have a very small <span class="math inline">\(p\)</span>-value which indicates we have very
strong evidence against the null. This confirms our results from the ACF
plot.</p>
</div>
<div class="section level4">
<h4 id="mean-variance-assumption-check">Mean-variance Assumption check<a class="anchor" aria-label="anchor" href="#mean-variance-assumption-check"></a>
</h4>
<p>An essential component to model assessment is the mean variance
relationship. In the plot below, the dots are the observed mean and
variance for several bins of the fitted data. The blue dotted line is
the assumed mean-variance relationship under the Tweedie distribution
and the red line is what would be assumed under the Quasi Poisson.</p>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../../reference/plotMeanVar.html">plotMeanVar</a></span><span class="op">(</span><span class="va">finalmod</span><span class="op">)</span></span></code></pre></div>
<p><img src="RenewablesCaseStudy_MRSea_files/figure-html/unnamed-chunk-47-1.png" width="672"></p>
</div>
<div class="section level4">
<h4 id="rundiagnostics">
<code>runDiagnostics</code><a class="anchor" aria-label="anchor" href="#rundiagnostics"></a>
</h4>
<p>This function assesses model fit and returns two plots:</p>
<ul>
<li>observed vs fitted and</li>
<li>fitted vs scaled Pearsons residual plots</li>
</ul>
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../../reference/runDiagnostics.html">runDiagnostics</a></span><span class="op">(</span><span class="va">finalmod</span><span class="op">)</span></span></code></pre></div>
<p><img src="RenewablesCaseStudy_MRSea_files/figure-html/unnamed-chunk-48-1.png" width="960"><img src="RenewablesCaseStudy_MRSea_files/figure-html/unnamed-chunk-48-2.png" width="960"></p>
</div>
<div class="section level4">
<h4 id="influence-diagnostics">Influence diagnostics<a class="anchor" aria-label="anchor" href="#influence-diagnostics"></a>
</h4>
<p>These functions assess the influence of different blocks on the data.
In our case, a block is a survey-transect. The <code>runInfluence</code>
function may take a long time to run so its worth a check to see roughly
how long it might take.</p>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../../reference/timeInfluenceCheck.html">timeInfluenceCheck</a></span><span class="op">(</span><span class="va">finalmod</span>, id <span class="op">=</span> <span class="va">count.data</span><span class="op">$</span><span class="va">TransectID</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Calculating the influence measures will take approximately 1 minutes"</span></span></code></pre></div>
<p>The function produces two plots; one using the COVRATIO statistic and
one the PRESS statistic. COVRATIO assesses the change in the precision
of the parameter estimates when each block is omitted whereas PRESS
assesses the sensitivity of the model predictions to the removal of each
block.</p>
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">inflpoints</span><span class="op">&lt;-</span><span class="fu"><a href="../../reference/runInfluence.html">runInfluence</a></span><span class="op">(</span><span class="va">finalmod</span>, id <span class="op">=</span> <span class="va">count.data</span><span class="op">$</span><span class="va">TransectID</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Calculating COVRATIO and PRESS Statistics"</span></span></code></pre></div>
<p><img src="RenewablesCaseStudy_MRSea_files/figure-html/unnamed-chunk-50-1.png" width="864"><img src="RenewablesCaseStudy_MRSea_files/figure-html/unnamed-chunk-50-2.png" width="864"></p>
<ul>
<li><p>There are some outlying blocks in the COVRATIO plot but there are
no values greater than 1 indicating none of the blocks have a large
influence on the precision of the estimates.</p></li>
<li><p>There is one block that is strongly influencing the abundance
estimates for the model.</p></li>
</ul>
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">inflpoints</span><span class="op">$</span><span class="va">influenceData</span><span class="op">[</span><span class="va">inflpoints</span><span class="op">$</span><span class="va">influencePoints</span><span class="op">$</span><span class="va">press</span>,<span class="op">]</span></span>
<span><span class="co">#&gt;           blocks num.block     covratio   press</span></span>
<span><span class="co">#&gt; 48  20010210.t25        41 5.718957e-09  648005</span></span>
<span><span class="co">#&gt; 74  20010316.t25        67 8.226645e-08  162556</span></span>
<span><span class="co">#&gt; 133  20020326.t6       150 1.370737e-08  119260</span></span>
<span><span class="co">#&gt; 135  20020326.t8       152 2.761644e-08   79763</span></span>
<span><span class="co">#&gt; 138 20020326.t11       130 3.326942e-08   73480</span></span>
<span><span class="co">#&gt; 139 20020326.t12       131 4.583203e-08  107760</span></span>
<span><span class="co">#&gt; 148 20020326.t21       141 2.879663e-08   90215</span></span>
<span><span class="co">#&gt; 149 20020326.t22       142 1.423051e-09 3597801</span></span></code></pre></div>
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p</span><span class="op">&lt;-</span><span class="va">ptheme</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data<span class="op">=</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">count.data</span>, <span class="va">Count</span><span class="op">==</span><span class="fl">0</span><span class="op">)</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x.pos</span>, y <span class="op">=</span> <span class="va">y.pos</span><span class="op">)</span>, shape<span class="op">=</span><span class="fl">16</span>, colour<span class="op">=</span><span class="st">'thistle'</span>, alpha<span class="op">=</span><span class="fl">0.8</span>, size<span class="op">=</span><span class="fl">1</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data<span class="op">=</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">count.data</span>, <span class="va">Count</span><span class="op">&gt;</span><span class="fl">0</span><span class="op">)</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x.pos</span>, y <span class="op">=</span> <span class="va">y.pos</span>, size <span class="op">=</span> <span class="va">Count</span><span class="op">)</span>, alpha<span class="op">=</span><span class="fl">0.45</span>, colour<span class="op">=</span><span class="st">'red'</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data<span class="op">=</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">count.data</span>, <span class="va">Count</span><span class="op">==</span><span class="fl">0</span>, <span class="va">TransectID</span> <span class="op">==</span> <span class="st">'20020326.t22'</span><span class="op">)</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x.pos</span>, y <span class="op">=</span> <span class="va">y.pos</span><span class="op">)</span>, shape<span class="op">=</span><span class="fl">16</span>, colour<span class="op">=</span><span class="st">'blue'</span>, alpha<span class="op">=</span><span class="fl">0.8</span>, size<span class="op">=</span><span class="fl">1</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data<span class="op">=</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">count.data</span>, <span class="va">Count</span><span class="op">&gt;</span><span class="fl">0</span>, <span class="va">TransectID</span> <span class="op">==</span> <span class="st">'20020326.t22'</span><span class="op">)</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x.pos</span>, y <span class="op">=</span> <span class="va">y.pos</span>, size <span class="op">=</span> <span class="va">Count</span><span class="op">)</span>, alpha<span class="op">=</span><span class="fl">0.45</span>, colour<span class="op">=</span><span class="st">'blue'</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_size.html" class="external-link">scale_size_area</a></span><span class="op">(</span>breaks<span class="op">=</span><span class="va">plotbreaks</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Easting"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Northing"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">YearMonth</span>, ncol<span class="op">=</span><span class="fl">3</span><span class="op">)</span></span>
<span><span class="va">p</span></span></code></pre></div>
<p><img src="RenewablesCaseStudy_MRSea_files/figure-html/unnamed-chunk-52-1.png" width="1152"></p>
<p>Unsurprisingly, this is the transect with the largest observations on
it so not including it makes a big difference to the estimates. After
assessing the most influential points we see no issues for concern.</p>
</div>
<div class="section level4">
<h4 id="spatial-residual-plots">Spatial Residual plots<a class="anchor" aria-label="anchor" href="#spatial-residual-plots"></a>
</h4>
<div class="sourceCode" id="cb57"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p</span> <span class="op">&lt;-</span> <span class="va">ptheme</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_tile</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">count.data</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">x.pos</span>, <span class="va">y.pos</span>, fill<span class="op">=</span><span class="va">response</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/stats/fitted.values.html" class="external-link">fitted</a></span><span class="op">(</span><span class="va">finalmod</span><span class="op">)</span><span class="op">)</span>, height<span class="op">=</span><span class="fl">0.5</span>, width<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">YearMonth</span>, ncol <span class="op">=</span> <span class="fl">3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html" class="external-link">scale_fill_distiller</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Spectral"</span>,name<span class="op">=</span><span class="st">"Animal Counts"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Easting"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Northing"</span><span class="op">)</span></span>
<span><span class="va">p</span></span></code></pre></div>
<p><img src="RenewablesCaseStudy_MRSea_files/figure-html/unnamed-chunk-53-1.png" width="1152"></p>
<p>The largest residuals occur in the last survey when very large
abundances were recorded. The model is likely to struggle to reproduce
these and since we see no regions of systematic positive or negative
bias we are happy to continue with inference from this model.</p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="model-inference">Model Inference<a class="anchor" aria-label="anchor" href="#model-inference"></a>
</h2>
<div class="section level3">
<h3 id="bootstrapped-confidence-intervals">Bootstrapped Confidence Intervals<a class="anchor" aria-label="anchor" href="#bootstrapped-confidence-intervals"></a>
</h3>
<p>Next we perform a parametric bootstrap to estimate uncertainty in the
spatial model. (Note: If a detection function estimated, then the
bootstrap can use the detection function too.)</p>
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bootPreds</span><span class="op">&lt;-</span><span class="fu"><a href="../../reference/do.bootstrap.cress.robust.html">do.bootstrap.cress.robust</a></span><span class="op">(</span>model.obj <span class="op">=</span> <span class="va">finalmod</span>,</span>
<span>                                     predictionGrid <span class="op">=</span> <span class="va">preddata</span>,</span>
<span>                                     g2k<span class="op">=</span><span class="va">g2k</span>,</span>
<span>                                     B <span class="op">=</span> <span class="fl">500</span>,</span>
<span>                                     robust<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>From the bootstraps we can calculate 95-percentile based confidence
intervals and the coefficient of variation for each grid cell.</p>
<div class="sourceCode" id="cb59"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#load('predictionboot.RData')</span></span>
<span><span class="va">cis</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/makeBootCIs.html">makeBootCIs</a></span><span class="op">(</span><span class="va">bootPreds</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb60"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span> <span class="va">preddata</span> <span class="op">&lt;-</span> <span class="va">preddata</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Lower2.5 <span class="op">=</span> <span class="va">cis</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>, </span>
<span>           Upper97.5 <span class="op">=</span> <span class="va">cis</span><span class="op">[</span>,<span class="fl">2</span><span class="op">]</span>, </span>
<span>           bootsd <span class="op">=</span>  <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">bootPreds</span>, <span class="fl">1</span>, <span class="va">sd</span><span class="op">)</span>,</span>
<span>           bootmean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">bootPreds</span>, <span class="fl">1</span>, <span class="va">mean</span><span class="op">)</span>,</span>
<span>           bootmedian <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">bootPreds</span>, <span class="fl">1</span>, <span class="va">median</span><span class="op">)</span>,</span>
<span>           cv <span class="op">=</span> <span class="va">bootsd</span> <span class="op">/</span> <span class="va">bootmean</span>,</span>
<span>           <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">bootPreds</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb61"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p</span> <span class="op">&lt;-</span> <span class="va">ptheme</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_tile</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">preddata</span>, </span>
<span>              <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">x.pos</span>, y<span class="op">=</span><span class="va">y.pos</span>, fill<span class="op">=</span><span class="va">cv</span>, height<span class="op">=</span><span class="fl">0.5</span>, width<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">'Easting (km)'</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">'Northing (km)'</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html" class="external-link">scale_fill_gradient</a></span><span class="op">(</span>name<span class="op">=</span><span class="st">'Coefficient of\nVariation'</span>,low <span class="op">=</span> <span class="st">'white'</span>, high<span class="op">=</span><span class="st">'red'</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_size.html" class="external-link">scale_size_area</a></span><span class="op">(</span>name<span class="op">=</span><span class="st">'Raw Count'</span>, </span>
<span>                    breaks<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">5</span>, <span class="fl">10</span>, <span class="fl">50</span><span class="op">)</span>, </span>
<span>                    labels<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'10'</span>, <span class="st">'50'</span>, <span class="st">'100'</span>, <span class="st">'500'</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data<span class="op">=</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">count.data</span>, <span class="va">response</span><span class="op">==</span><span class="fl">0</span><span class="op">)</span>, </span>
<span>               <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">x.pos</span>, <span class="va">y.pos</span><span class="op">)</span>, colour<span class="op">=</span><span class="st">"grey"</span>, size<span class="op">=</span><span class="fl">0.1</span><span class="op">)</span> <span class="op">+</span> </span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data<span class="op">=</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">count.data</span>, <span class="va">response</span><span class="op">&gt;</span><span class="fl">0</span><span class="op">)</span>, </span>
<span>               <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">x.pos</span>, <span class="va">y.pos</span>, size<span class="op">=</span><span class="va">response</span><span class="op">)</span>, colour<span class="op">=</span><span class="st">"black"</span>, shape<span class="op">=</span><span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">YearMonth</span><span class="op">)</span></span>
<span><span class="va">p</span></span></code></pre></div>
<p><img src="RenewablesCaseStudy_MRSea_files/figure-html/unnamed-chunk-56-1.png" width="1152"></p>
</div>
<div class="section level3">
<h3 id="abundance-estimates">Abundance Estimates<a class="anchor" aria-label="anchor" href="#abundance-estimates"></a>
</h3>
<div class="sourceCode" id="cb62"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">surveyests</span> <span class="op">&lt;-</span> <span class="va">preddata</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">YearMonth</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>areakm <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">Area</span><span class="op">)</span>,</span>
<span>            count<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">preds</span><span class="op">)</span>, </span>
<span>            count.lower<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">Lower2.5</span><span class="op">)</span>,  </span>
<span>            count.upper<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">Upper97.5</span><span class="op">)</span>,</span>
<span>            density <span class="op">=</span> <span class="va">count</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">Area</span><span class="op">)</span>,</span>
<span>            density.lower<span class="op">=</span><span class="va">count.lower</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">Area</span><span class="op">)</span>,  </span>
<span>            density.upper<span class="op">=</span><span class="va">count.upper</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">Area</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span> <span class="co"># mutate(date = factor(date, levels=unique(countdata$date))) %&gt;%</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">YearMonth</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb63"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">surveyinfo</span> <span class="op">&lt;-</span> <span class="va">count.data</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">YearMonth</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>year<span class="op">=</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/nth.html" class="external-link">first</a></span><span class="op">(</span><span class="va">Year</span><span class="op">)</span>, month<span class="op">=</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/nth.html" class="external-link">first</a></span><span class="op">(</span><span class="va">Month</span><span class="op">)</span>, day<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="va">surveyests</span><span class="op">&lt;-</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">surveyests</span>, <span class="va">surveyinfo</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb64"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ptheme</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">surveyests</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">YearMonth</span>, <span class="va">density</span>, colour<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_segment.html" class="external-link">geom_segment</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">surveyests</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">YearMonth</span>, y<span class="op">=</span><span class="va">density.lower</span>, xend<span class="op">=</span><span class="va">YearMonth</span>, yend<span class="op">=</span><span class="va">density.upper</span>, colour<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">year</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Estimated Density"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Date"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>axis.text.x <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>angle<span class="op">=</span><span class="fl">45</span>, vjust<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_colour_discrete.html" class="external-link">scale_color_discrete</a></span><span class="op">(</span>name<span class="op">=</span><span class="st">"Year"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html" class="external-link">coord_cartesian</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="RenewablesCaseStudy_MRSea_files/figure-html/unnamed-chunk-59-1.png" width="672"></p>
</div>
<div class="section level3">
<h3 id="difference-surfaces">Difference Surfaces<a class="anchor" aria-label="anchor" href="#difference-surfaces"></a>
</h3>
<p>Calculate the differences between two surfaces. As an example, we can
assess March 2001 and 2002.</p>
<div class="sourceCode" id="cb65"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">differences</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/getDifferences.html">getDifferences</a></span><span class="op">(</span>beforePreds <span class="op">=</span></span>
<span>                      <span class="va">bootPreds</span><span class="op">[</span><span class="va">preddata</span><span class="op">$</span><span class="va">YearMonth</span> <span class="op">==</span> <span class="st">"2001/3"</span>, <span class="op">]</span>,</span>
<span>                      afterPreds <span class="op">=</span> <span class="va">bootPreds</span><span class="op">[</span><span class="va">preddata</span><span class="op">$</span><span class="va">YearMonth</span> <span class="op">==</span> <span class="st">"2002/3"</span>, <span class="op">]</span><span class="op">)</span></span></code></pre></div>
<p>Plot differences and indicate where significant positive/negative
differences lie. The blue circles indicate a significant negative
difference (abundance after is less than the abundance before) and the
red crosses indicate a significant positive difference. The colour of
the cell indicates the size of the difference.</p>
<div class="sourceCode" id="cb66"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">diffpreds1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">preddata</span><span class="op">[</span><span class="va">preddata</span><span class="op">$</span><span class="va">YearMonth</span> <span class="op">==</span> <span class="st">"2001/3"</span>, <span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">differences</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb67"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># The marker for each after - before difference:</span></span>
<span><span class="co"># positive ('1') and negative ('-') significant differences</span></span>
<span><span class="va">diffplot1</span> <span class="op">&lt;-</span> <span class="va">ptheme</span> <span class="op">+</span>  </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_tile</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">diffpreds1</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">x.pos</span>, y<span class="op">=</span><span class="va">y.pos</span>,fill<span class="op">=</span><span class="va">mediandiff</span>, height<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">Area</span><span class="op">)</span>, width<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">Area</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">'Easting (Km)'</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">'Northing (Km)'</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html" class="external-link">scale_fill_gradient2</a></span><span class="op">(</span>low <span class="op">=</span> <span class="st">'blue4'</span>, mid <span class="op">=</span> <span class="st">'white'</span>, high <span class="op">=</span> <span class="st">'red4'</span>, guide<span class="op">=</span><span class="st">'colourbar'</span>,na.value<span class="op">=</span><span class="st">"grey50"</span>, name<span class="op">=</span><span class="st">'Differences \nin Count'</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_colour_manual</a></span><span class="op">(</span>values<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'darkblue'</span>, <span class="st">'darkred'</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data<span class="op">=</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">diffpreds1</span>, <span class="va">significanceMarker</span><span class="op">!=</span><span class="fl">0</span><span class="op">)</span>, </span>
<span>             <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">x.pos</span>, y<span class="op">=</span><span class="va">y.pos</span>, </span>
<span>                 shape<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">significanceMarker</span><span class="op">)</span>, </span>
<span>                 colour<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">significanceMarker</span><span class="op">)</span><span class="op">)</span>,</span>
<span>             alpha<span class="op">=</span><span class="fl">0.2</span>, show.legend<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_shape_manual</a></span><span class="op">(</span>values<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">3</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_size_manual</a></span><span class="op">(</span>values<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">0.5</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"2002/3 - 2001/3"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">diffplot1</span></span></code></pre></div>
<p><img src="RenewablesCaseStudy_MRSea_files/figure-html/unnamed-chunk-62-1.png" width="864" style="display: block; margin: auto;"></p>
<p>In general, there were more birds in March 2002 than in March 2001,
with the biggest distributional difference in the central and south east
of the study site.</p>
<p>Alternatively, we could look at the differences between January and
March 2001.</p>
<div class="sourceCode" id="cb68"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">differences</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/getDifferences.html">getDifferences</a></span><span class="op">(</span>beforePreds <span class="op">=</span></span>
<span>                      <span class="va">bootPreds</span><span class="op">[</span><span class="va">preddata</span><span class="op">$</span><span class="va">YearMonth</span> <span class="op">==</span> <span class="st">"2001/1"</span>, <span class="op">]</span>,</span>
<span>                      afterPreds <span class="op">=</span> <span class="va">bootPreds</span><span class="op">[</span><span class="va">preddata</span><span class="op">$</span><span class="va">YearMonth</span> <span class="op">==</span> <span class="st">"2001/3"</span>, <span class="op">]</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb69"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">diffpreds2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">preddata</span><span class="op">[</span><span class="va">preddata</span><span class="op">$</span><span class="va">YearMonth</span> <span class="op">==</span> <span class="st">"2001/3"</span>,<span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">differences</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb70"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># The marker for each after - before difference:</span></span>
<span><span class="co"># positive ('1') and negative ('-') significant differences</span></span>
<span></span>
<span><span class="va">diffplot2</span> <span class="op">&lt;-</span> <span class="va">ptheme</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_tile</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">diffpreds2</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">x.pos</span>, y<span class="op">=</span><span class="va">y.pos</span>,fill<span class="op">=</span><span class="va">mediandiff</span>, height<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">Area</span><span class="op">)</span>, width<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">Area</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">'Easting (Km)'</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">'Northing (Km)'</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html" class="external-link">scale_fill_gradient2</a></span><span class="op">(</span>low <span class="op">=</span> <span class="st">'blue4'</span>, mid <span class="op">=</span> <span class="st">'white'</span>, high <span class="op">=</span> <span class="st">'red4'</span>, guide<span class="op">=</span><span class="st">'colourbar'</span>,na.value<span class="op">=</span><span class="st">"grey50"</span>, name<span class="op">=</span><span class="st">'Differences \nin Count'</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_colour_manual</a></span><span class="op">(</span>values<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'darkblue'</span>, <span class="st">'darkred'</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data<span class="op">=</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">diffpreds2</span>, <span class="va">significanceMarker</span><span class="op">!=</span><span class="fl">0</span><span class="op">)</span>, </span>
<span>             <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">x.pos</span>, y<span class="op">=</span><span class="va">y.pos</span>, </span>
<span>                 shape<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">significanceMarker</span><span class="op">)</span>, </span>
<span>                 colour<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">significanceMarker</span><span class="op">)</span><span class="op">)</span>,</span>
<span>             alpha<span class="op">=</span><span class="fl">0.2</span>, show.legend<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_shape_manual</a></span><span class="op">(</span>values<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">3</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_size_manual</a></span><span class="op">(</span>values<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">0.5</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"2001/3 - 2001/1"</span><span class="op">)</span></span>
<span><span class="va">diffplot2</span></span></code></pre></div>
<p><img src="RenewablesCaseStudy_MRSea_files/figure-html/unnamed-chunk-65-1.png" width="864" style="display: block; margin: auto;"></p>
</div>
<div class="section level3">
<h3 id="persistence-plots">Persistence Plots<a class="anchor" aria-label="anchor" href="#persistence-plots"></a>
</h3>
<p>Lastly, we might want to know which areas of the study region are
persistently high for bird abundances.</p>
<p>A persistence score of 1 indicates that the grid cell is above the
mean abundance in every bootstrap in every survey.</p>
<div class="sourceCode" id="cb71"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">boots</span><span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">preddata</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">"X"</span>, ignore.case <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">nboots</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">boots</span><span class="op">)</span></span>
<span></span>
<span><span class="va">meandens</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">preddata</span><span class="op">$</span><span class="va">preds</span><span class="op">)</span></span>
<span></span>
<span><span class="va">persistfun</span><span class="op">&lt;-</span><span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">meandens</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">x</span><span class="op">&gt;</span><span class="va">meandens</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">test</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">boots</span>, <span class="fl">2</span>, <span class="va">persistfun</span>, meandens<span class="op">=</span><span class="va">meandens</span><span class="op">)</span></span>
<span><span class="va">preddata</span><span class="op">$</span><span class="va">persist</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">test</span>, <span class="fl">1</span>, <span class="va">sum</span><span class="op">)</span></span>
<span></span>
<span><span class="va">persistdata</span><span class="op">&lt;-</span><span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html" class="external-link">pivot_wider</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">preddata</span>,</span>
<span>                                id_cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">Area</span>, <span class="va">x.pos</span>, <span class="va">y.pos</span><span class="op">)</span>,</span>
<span>                                names_from <span class="op">=</span> <span class="va">YearMonth</span>,</span>
<span>                                names_prefix <span class="op">=</span> <span class="st">"Persist_"</span>,</span>
<span>                                values_from <span class="op">=</span> <span class="va">persist</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rowwise.html" class="external-link">rowwise</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>Persistence<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/c_across.html" class="external-link">c_across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">"Persist_"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">/</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">preddata</span><span class="op">$</span><span class="va">YearMonth</span><span class="op">)</span><span class="op">)</span> <span class="op">*</span> <span class="va">nboots</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb72"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">persistplot</span> <span class="op">&lt;-</span><span class="va">ptheme</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_tile</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">persistdata</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">x.pos</span>, y<span class="op">=</span><span class="va">y.pos</span>,fill<span class="op">=</span><span class="va">Persistence</span>, height<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">Area</span><span class="op">)</span>, width<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">Area</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>  <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">'Easting (Km)'</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">'Northing (Km)'</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html" class="external-link">scale_fill_distiller</a></span><span class="op">(</span>palette<span class="op">=</span><span class="st">'Spectral'</span>, name<span class="op">=</span><span class="st">'Persistence'</span>,limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">persistplot</span></span></code></pre></div>
<p><img src="RenewablesCaseStudy_MRSea_files/figure-html/unnamed-chunk-67-1.png" width="864"></p>
<p>The plot shows that even though the highest abundances were recorded
in the south east in one survey, the central area is where there is a
persistently high abundance regardless of survey.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Lindesay Scott-Hayward, Cameron Walker, Monique Mackenzie.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.9000.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
