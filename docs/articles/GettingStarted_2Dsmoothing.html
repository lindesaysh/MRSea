<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="MRSea">
<title>Getting Started with MRSea: Two dimensional smoothing • MRSea</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Getting Started with MRSea: Two dimensional smoothing">
<meta property="og:description" content="MRSea">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">MRSea</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.5</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/web/IntroductiontoMRSea.html">Introduction to the package</a>
    <h6 class="dropdown-header" data-toc-skip>Basic examples</h6>
    <a class="dropdown-item" href="../articles/GettingStarted_1Dsmoothing.html">One-dimensional smooths</a>
    <a class="dropdown-item" href="../articles/GettingStarted_2Dsmoothing.html">Two-dimensional smooths</a>
    <div class="dropdown-divider"></div>
    <a class="dropdown-item" href="../articles/web/FittingDifferentSplines_MRSea.html">Using Different Splines</a>
    <a class="dropdown-item" href="../articles/web/Interactions_salsa2d_MRSea.html">Interactions for 2D smooths</a>
    <a class="dropdown-item" href="../articles/web/ModelDiagnostics_MRSea.html">Model Diagnostics</a>
    <a class="dropdown-item" href="../articles/web/TheTweedieDistribution_MRSea.html">Using the Tweedie Distribution</a>
    <div class="dropdown-divider"></div>
    <a class="dropdown-item" href="../articles/web/Publications.html">Publications</a>
    <div class="dropdown-divider"></div>
    <a class="dropdown-item" href="../articles/web/DistanceSampling.html">Brief Intro to Distance Sampling</a>
    <a class="dropdown-item" href="../articles/web/RenewablesCaseStudy_MRSea.html">Renewables Case Study</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>More advanced Usage</h6>
    <a class="dropdown-item" href="../articles/web/Geodesic_2dsmoothing_MRSea.html">Geodesic smoothing</a>
    <a class="dropdown-item" href="../articles/web/UserRadiiChoice_MRSea.html">Basis radii selection</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/lindesaysh/MRSea/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Getting Started with MRSea: Two dimensional smoothing</h1>
                        <h4 data-toc-skip class="author">LAS
Scott-Hayward</h4>
            
            <h4 data-toc-skip class="date">2023-12-12</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/lindesaysh/MRSea/blob/HEAD/vignettes/GettingStarted_2Dsmoothing.Rmd" class="external-link"><code>vignettes/GettingStarted_2Dsmoothing.Rmd</code></a></small>
      <div class="d-none name"><code>GettingStarted_2Dsmoothing.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>The <code>MRSea</code> package was developed for analysing data that
was collected for assessing potential impacts of renewable developments
on marine wildlife, although the methods are applicable to many other
studies as well. For example, these methods have been used for more
general spatial distribution modelling and to analyse GPS tagging data
for home ranges.</p>
<p>The <code>MRSea</code> package primarily fits Generalised Additive
Models (GAMs) using a spatially adaptive model selection framework for
both one and two dimensional covariates using the functions
<code>runSALSA1D</code> and <code>runSALSA2D</code>. These functions
implement the methods of implement the methods of <span class="citation">Walker et al. (2010)</span>, <span class="citation">Scott-Hayward et al. (2013)</span> and <span class="citation">Scott-Hayward et al. (2022)</span>. In addition,
options are available for a variety of different splines and the
estimation of robust standard errors if residual correlation is
present.</p>
<p>A class of model <code>gamMRSea</code> is created when running either
SALSA 1D or 2D. This retains within the model object information
regarding fitting, such as the <code>splineParam</code> object and the
panel structure (if present). The use of the <code>summary</code>
function on these models returns both raw and robust standard errors,
with the <em>p</em>-values from the models hypothesis test using the
robust standard errors. The robust standard errors are obtained using
the panel structure given (independence is one panel per data point and
is the default if no structure is given).</p>
<p>In addition to the functions required to run the models (which we
shall go through below) there are also a variety of associated functions
for:</p>
<p><strong>Covariate Checking/Selection:</strong></p>
<ul>
<li>
<code>summary.gamMRSea</code> (summary function for models)</li>
<li>
<code>runPartialPlots</code> (to plot 1D partial smooth
relationships),</li>
<li>
<code>anova.gamMRSea</code> (for model selection; (ANOVA) for robust
standard errors) and</li>
</ul>
<p><strong>Diagnostics:</strong></p>
<ul>
<li>
<code>runACF</code> (to assess residual correlation),</li>
<li>
<code>runsTest</code> (to assess residual correlation)</li>
<li>
<code>plotMeanVar</code> (to assess the mean-variance
relationship)</li>
<li>
<code>runDiagnostics</code> (plots of observed vs fitted and fitted
vs scaled Pearsons residuals),</li>
<li>
<code>timeInfluenceCheck</code>/<code>runInfluence</code> (assessing
the influence of data on precision and predictions),</li>
<li>
<code>plotCumRes</code> (plots of cumulative residuals)</li>
</ul>
<p><strong>Inference:</strong></p>
<ul>
<li>
<code>do.bootstrap.cress.robust</code> (percentile based confidence
intervals).</li>
<li>
<code>getDifferences</code> (identifying differences between two
prediction surfaces)</li>
</ul>
</div>
<div class="section level2">
<h2 id="fitting-a-simple-2d-model">Fitting a Simple 2D Model<a class="anchor" aria-label="anchor" href="#fitting-a-simple-2d-model"></a>
</h2>
<p>The data we shall use for this example is from a Danish offshore
windfarm and is part of the MRSea package. The data are counts of birds
collected along transects over a number of surveys and years. In this
first example, we will use all of the data together and assess if there
is a relationship between number of birds and sea depth.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://creem2.st-and.ac.uk/software.aspx" class="external-link">MRSea</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># load the data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"nysted.analysisdata"</span><span class="op">)</span></span>
<span><span class="va">wfdata</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">nysted.analysisdata</span>, <span class="va">impact</span><span class="op">==</span><span class="fl">0</span>, <span class="va">season</span><span class="op">==</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="co"># load the prediction grid</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"nysted.predictdata"</span><span class="op">)</span></span>
<span><span class="va">preddata</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">nysted.predictdata</span>, <span class="va">impact</span><span class="op">==</span><span class="fl">0</span>, <span class="va">season</span><span class="op">==</span><span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">wfdata</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_tile</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">x.pos</span>, y<span class="op">=</span><span class="va">y.pos</span>, fill<span class="op">=</span><span class="va">response</span>, height<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">area</span><span class="op">)</span>, width<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">area</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html" class="external-link">scale_fill_distiller</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Spectral"</span>,name<span class="op">=</span><span class="st">"No. Birds"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Easting (km)"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Northing (km)"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="GettingStarted_2Dsmoothing_files/figure-html/unnamed-chunk-4-1.png" width="700"></p>
<div class="section level3">
<h3 id="fitting-a-2d-smooth">Fitting a 2D smooth<a class="anchor" aria-label="anchor" href="#fitting-a-2d-smooth"></a>
</h3>
<p>Set up the initial model with the offset term (if required) and
specify the parameters required. Here we add an offset to be the size of
the segment associated with the bird counts. In reality, our bird counts
are over a particular area so we have counts per unit area.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">initialModel</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">response</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/offset.html" class="external-link">offset</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">area</span><span class="op">)</span><span class="op">)</span>, family <span class="op">=</span> <span class="st">"quasipoisson"</span>, </span>
<span>                    data <span class="op">=</span> <span class="va">wfdata</span><span class="op">)</span></span></code></pre></div>
<p>First up we must create a grid of knots that will be used as
candidate knot locations. The locations are a subset of the data
locations and are space-filled to have good coverage across the
two-dimensional space.</p>
<p>Depending on the size of your data set this could take while and be
slightly different every time you run it so I suggest using a seed and
perhaps saving the knotgrid as a file.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">knotgrid</span><span class="op">&lt;-</span> <span class="fu"><a href="../reference/getKnotgrid.html">getKnotgrid</a></span><span class="op">(</span>coordData <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">wfdata</span><span class="op">$</span><span class="va">x.pos</span>, <span class="va">wfdata</span><span class="op">$</span><span class="va">y.pos</span><span class="op">)</span>,</span>
<span>                       numKnots <span class="op">=</span> <span class="fl">300</span>,</span>
<span>                       plot <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="GettingStarted_2Dsmoothing_files/figure-html/knotgrid-1.png" alt="Plot showing the candidate knot locations in red and the raw data locations in black." width="864"><p class="caption">
Plot showing the candidate knot locations in red and the raw data
locations in black.
</p>
</div>
<p>The <code>makeDists</code> function creates two matrices. One for the
distances between each data point and knot point (<code>dataDist</code>)
and one for the distances between each knot point and all other knot
points (<code>knotDist</code>).</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">distMats</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/makeDists.html">makeDists</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">wfdata</span><span class="op">$</span><span class="va">x.pos</span>, <span class="va">wfdata</span><span class="op">$</span><span class="va">y.pos</span><span class="op">)</span>, <span class="va">knotgrid</span><span class="op">)</span></span></code></pre></div>
<p>Next we specify the parameters needed to run the SALSA2D algorithm
which will select the number and location of knots for the smooth of x
and y coordinates. Distance matrices (data to knots and knot to knots),
a fit statistic and min, max and start knots.</p>
<p>The fitness measure can be one of several options (AIC, BIC, QAIC,
QBIC, CV). Here we use QBIC as we have a quasi model and information
criterion fitting is faster than cross-validation.</p>
<ul>
<li>
<code>knotgrid</code> is the grid of candidate knot locations we
created.</li>
<li>
<code>startKnots</code> specifies the number of knots the SALSA2D
algorithm uses to initialise the process. The starting number depends a
bit on the size/heterogeneity of the surface. I’d suggest starting with
10 knots to get a feel for the outputs.</li>
<li>
<code>minKnots</code> specifies the minimum number of knots to be
selected. This must be the same or smaller than
<code>startKnots</code>
</li>
<li>
<code>maxKnots</code> specifies the maximum number of knots to be
selected. This must be the same or larger than
<code>startKnots</code>.</li>
<li>
<code>gap</code> specifies the minimum gap between knots. Usually
this is fine to be set at zero but occasionally there can be estimation
problems and so a gap can be set (in the units of the covariate).</li>
</ul>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># make parameter set for running salsa2d</span></span>
<span><span class="va">salsa2dlist</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>fitnessMeasure <span class="op">=</span> <span class="st">'QBIC'</span>,</span>
<span>                  knotgrid <span class="op">=</span> <span class="va">knotgrid</span>,</span>
<span>                  startKnots<span class="op">=</span><span class="fl">10</span>,</span>
<span>                  minKnots<span class="op">=</span><span class="fl">4</span>,</span>
<span>                  maxKnots<span class="op">=</span><span class="fl">15</span>,</span>
<span>                  gap<span class="op">=</span><span class="fl">0</span><span class="op">)</span></span></code></pre></div>
<ol start="11" style="list-style-type: decimal">
<li>Run SALSA2D to find the appropriate number and location of knots for
the 2D smooth term of <code>x.pos</code> and <code>y.pos</code>. The
model inputted to the SALSA2D algorithm is the initial model. If you
have a model with univariate smooth terms, you can put in the output
best model from the SALSA1D algorithm in this step.The default basis
function is the <code>gaussian</code> but you can also use the
<code>exponential</code> by specifying the <code>basis</code>
parameter.</li>
</ol>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">salsa2dOutput</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/runSALSA2D.html">runSALSA2D</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">initialModel</span>,</span>
<span>                          salsa2dlist <span class="op">=</span> <span class="va">salsa2dlist</span>,</span>
<span>                          d2k<span class="op">=</span><span class="va">distMats</span><span class="op">$</span><span class="va">dataDist</span>,</span>
<span>                          k2k<span class="op">=</span><span class="va">distMats</span><span class="op">$</span><span class="va">knotDist</span>,</span>
<span>                          suppress.printout <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>Note that <code>suppress.printout</code> will not print the progress
of <code>runSALSA2D</code> into your workspace but will save the output
to a log file (<em>salsa2d.log</em>) in your working directory. You may
find it helpful to not suppress the print out to begin with so you can
see what is happening.</p>
<p>Use the built in summary function (<code>summary.gamMRSea</code>) to
look at the summary of the model. Note that robust standard errors are
given alongside the raw standard errors and information regarding panels
is at the bottom of the output. If each data point is a panel, then
independence is assumed and the two standard error columns will be
identical.</p>
</div>
<div class="section level3">
<h3 id="model-summary">Model Summary<a class="anchor" aria-label="anchor" href="#model-summary"></a>
</h3>
<p>The object <code>salsa2dOutput</code> has two components:</p>
<ul>
<li>
<code>bestModel</code>: the final model</li>
<li>
<code>fitStat</code>: The fitness measure of the best model using
the fitness measure specified.</li>
</ul>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">salsa2dOutput</span><span class="op">$</span><span class="va">bestModel</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; gamMRSea(formula = response ~ LRF.g(radiusIndices, dists, radii, </span></span>
<span><span class="co">#&gt;     aR) + offset(log(area)), family = "quasipoisson", data = wfdata, </span></span>
<span><span class="co">#&gt;     splineParams = splineParams)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Deviance Residuals: </span></span>
<span><span class="co">#&gt;     Min       1Q   Median       3Q      Max  </span></span>
<span><span class="co">#&gt; -3.7456  -1.1390  -0.2942  -0.0308  15.5232  </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients:</span></span>
<span><span class="co">#&gt;                                          Estimate Std. Error Robust S.E.</span></span>
<span><span class="co">#&gt; (Intercept)                               -12.068      1.662       1.662</span></span>
<span><span class="co">#&gt; LRF.g(radiusIndices, dists, radii, aR)b1   11.675      1.290       1.290</span></span>
<span><span class="co">#&gt; LRF.g(radiusIndices, dists, radii, aR)b2  -35.043      6.107       6.107</span></span>
<span><span class="co">#&gt; LRF.g(radiusIndices, dists, radii, aR)b3   20.495      2.604       2.604</span></span>
<span><span class="co">#&gt; LRF.g(radiusIndices, dists, radii, aR)b4   12.587      1.602       1.602</span></span>
<span><span class="co">#&gt; LRF.g(radiusIndices, dists, radii, aR)b5   52.913      7.905       7.905</span></span>
<span><span class="co">#&gt; LRF.g(radiusIndices, dists, radii, aR)b6  -28.821      4.581       4.581</span></span>
<span><span class="co">#&gt;                                          t value Pr(&gt;|t|)    </span></span>
<span><span class="co">#&gt; (Intercept)                               -7.261 7.05e-13 ***</span></span>
<span><span class="co">#&gt; LRF.g(radiusIndices, dists, radii, aR)b1   9.048  &lt; 2e-16 ***</span></span>
<span><span class="co">#&gt; LRF.g(radiusIndices, dists, radii, aR)b2  -5.738 1.23e-08 ***</span></span>
<span><span class="co">#&gt; LRF.g(radiusIndices, dists, radii, aR)b3   7.871 8.08e-15 ***</span></span>
<span><span class="co">#&gt; LRF.g(radiusIndices, dists, radii, aR)b4   7.856 9.08e-15 ***</span></span>
<span><span class="co">#&gt; LRF.g(radiusIndices, dists, radii, aR)b5   6.694 3.40e-11 ***</span></span>
<span><span class="co">#&gt; LRF.g(radiusIndices, dists, radii, aR)b6  -6.291 4.48e-10 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; (Dispersion parameter for quasipoisson family taken to be 8.001567)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     Null deviance: 4987.6  on 1153  degrees of freedom</span></span>
<span><span class="co">#&gt; Residual deviance: 3037.2  on 1147  degrees of freedom</span></span>
<span><span class="co">#&gt; AIC:  NA</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Max Panel Size = 1 (independence assumed); Number of panels = 1154</span></span>
<span><span class="co">#&gt; Number of Fisher Scoring iterations: 7</span></span></code></pre></div>
<p>You can find the number of knots chosen for a variable by querying
the spline parameters list in the model object.The two dimensional
smooth is always in the first element of the spline parameters list. In
this case, 6 knots have been selected.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># How many knots were chosen for depth?</span></span>
<span><span class="va">salsa2dOutput</span><span class="op">$</span><span class="va">bestModel</span><span class="op">$</span><span class="va">splineParams</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">knotPos</span></span>
<span><span class="co">#&gt; [1]  54 136 275 111 299 102</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="fitted-surface">Fitted surface<a class="anchor" aria-label="anchor" href="#fitted-surface"></a>
</h3>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">wfdata</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_tile</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">x.pos</span>, y<span class="op">=</span><span class="va">y.pos</span>, fill<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/fitted.values.html" class="external-link">fitted</a></span><span class="op">(</span><span class="va">salsa2dOutput</span><span class="op">$</span><span class="va">bestModel</span><span class="op">)</span>, height<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">area</span><span class="op">)</span>, width<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">area</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html" class="external-link">scale_fill_distiller</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Spectral"</span>,name<span class="op">=</span><span class="st">"No. Birds"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Easting (km)"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Northing (km)"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="GettingStarted_2Dsmoothing_files/figure-html/unnamed-chunk-11-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="making-predictions">Making predictions<a class="anchor" aria-label="anchor" href="#making-predictions"></a>
</h3>
<p>To make predictions, we need to calculate the distances between each
prediction point and each knot point. We can use the
<code>makeDists</code> function again but this time we don’t need the
knot to knot matrix and therefore specify
<code>knotmat = FALSE</code>.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">preddist</span><span class="op">&lt;-</span><span class="fu"><a href="../reference/makeDists.html">makeDists</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">preddata</span><span class="op">$</span><span class="va">x.pos</span>, <span class="va">preddata</span><span class="op">$</span><span class="va">y.pos</span><span class="op">)</span>,</span>
<span>                 <span class="va">knotgrid</span>, knotmat<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span><span class="op">$</span><span class="va">dataDist</span></span>
<span></span>
<span></span>
<span><span class="co"># make predictions on response scale</span></span>
<span><span class="va">preds</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span>newdata <span class="op">=</span> <span class="va">preddata</span>,</span>
<span>               g2k <span class="op">=</span> <span class="va">preddist</span>,</span>
<span>               object <span class="op">=</span> <span class="va">salsa2dOutput</span><span class="op">$</span><span class="va">bestModel</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">preddata</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_tile</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">x.pos</span>, y<span class="op">=</span><span class="va">y.pos</span>, fill<span class="op">=</span><span class="va">preds</span>, height<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">area</span><span class="op">)</span>, width<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="va">area</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html" class="external-link">scale_fill_distiller</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Spectral"</span>,name<span class="op">=</span><span class="st">"No. Birds"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"Easting (km)"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Northing (km)"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="GettingStarted_2Dsmoothing_files/figure-html/unnamed-chunk-13-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="interaction-terms">Interaction terms:<a class="anchor" aria-label="anchor" href="#interaction-terms"></a>
</h3>
<p>The simplest way to specify an interaction term is to add this to the
<code>salsa2dlist</code> object.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">salsa2dlist</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>fitnessMeasure <span class="op">=</span> <span class="st">'QBIC'</span>, </span>
<span>                  knotgrid <span class="op">=</span> <span class="va">knotgrid</span>,</span>
<span>                  startKnots<span class="op">=</span><span class="fl">10</span>, </span>
<span>                  minKnots<span class="op">=</span><span class="fl">4</span>, </span>
<span>                  maxKnots<span class="op">=</span><span class="fl">15</span>, </span>
<span>                  gap<span class="op">=</span><span class="fl">0</span>, </span>
<span>                  interactionTerm<span class="op">=</span><span class="st">"as.factor(impact)"</span><span class="op">)</span></span></code></pre></div>
<p>There is an example of this in use in the <a href="https://lindesaysh.github.io/MRSea/article/RenewablesCaseStudy_MRSea_v1.3" class="external-link">case
study vignette</a>. The limitation to this method is that the knot
locations in the different levels (e.g. before and after impact) are in
the same locations and only the coefficients are permitted to change.
This may not always be a sensible option especially if the spatial range
of the different factor levels varies. In this case, there is an
alternative which allows the locations to differ. An example of this is
in the <a href="https://lindesaysh.github.io/MRSea/article/Interactions_salsa2d_MRSea_v1.3" class="external-link">interactions
vignette</a>.</p>
</div>
</div>
<div class="section level2">
<h2 id="further-information">Further information:<a class="anchor" aria-label="anchor" href="#further-information"></a>
</h2>
<p>For information on:</p>
<ol style="list-style-type: decimal">
<li><a href="https://lindesaysh.github.io/MRSea/article/FittingDifferentSplines_MRSea" class="external-link">Other
types of 2D spline</a></li>
<li><a href="https://lindesaysh.github.io/MRSea/article/ModelDiagnostics_MRSea" class="external-link">Model
Diagnostics</a></li>
<li><a href="https://lindesaysh.github.io/MRSea/article/DistanceSampling" class="external-link">Distance
Sampling</a></li>
<li>Marine Renewables baseline characterisataion <a href="https://lindesaysh.github.io/MRSea/article/RenewablesCaseStudy_MRSea" class="external-link">Case
Study</a>.</li>
<li>More complex <a href="https://lindesaysh.github.io/MRSea/article/Interactions_salsa2d_MRSea" class="external-link">interactions</a>.</li>
<li>Using non Euclidean distances to measure the similarity between
points. For example, using geodesic distances to represent “as the fish
swims” rather than “as the crow flies”. This takes into account
distances around exclusion areas such as coastlines or lakes. See <a href="(https://lindesaysh.github.io/MRSea/article/Geodesic_2dsmoothing_MRSea)" class="external-link">here</a>
</li>
</ol>
</div>
<div class="section level2">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-ScottH2013" class="csl-entry">
Scott-Hayward, L. A. S., M. L. Mackenzie, C. R. Donovan, C. G. Walker,
and E. Ashe. 2013. <span>“Complex Region Spatial Smoother
(CReSS).”</span> <em>Journal of Computational and Graphical
Statistics</em>. <a href="https://doi.org/10.1080/10618600.2012.762920" class="external-link">https://doi.org/10.1080/10618600.2012.762920</a>.
</div>
<div id="ref-ScottH2022" class="csl-entry">
Scott-Hayward, L. A. S., M. L. Mackenzie, C. G. Walker, G. Shatumbu, W.
Kilian, and P. du Preez. 2022. <span>“Automated Surface Feature
Selection Using SALSA2D: An Illustration Using Elephant Mortality Data
in Etosha National Park.”</span> <em>arXiv e-Prints</em>,
arXiv:2202.07977. <a href="https://doi.org/10.48550/arXiv.2202.07977" class="external-link">https://doi.org/10.48550/arXiv.2202.07977</a>.
</div>
<div id="ref-Walker2010" class="csl-entry">
Walker, C. G., M. L. Mackenzie, C. R. Donovan, and M. J. O’Sullivan.
2010. <span>“SALSA - a Spatially Adaptive Local Smoothing
Algorithm.”</span> <em>Journal of Statistical Computation and
Simulation</em> 81 (2): 179–91.
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Lindesay Scott-Hayward, Cameron Walker, Monique Mackenzie.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.9000.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
